<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics - Yanmar Quality Control</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .sidebar-collapsed {
            width: 64px;
        }

        .sidebar-expanded {
            width: 256px;
        }

        .sidebar-transition {
            transition: width 100ms linear;
        }

        .menu-icon {
            width: 20px;
            text-align: center;
        }

        .menu-text {
            white-space: nowrap;
        }

        .sidebar-collapsed .menu-text {
            display: none;
        }

        .sidebar-expanded .menu-text {
            display: inline;
        }

        .tooltip {
            display: none;
        }

        .group.show-tooltip .tooltip {
            display: block;
        }

        .menu-item-hover:hover {
            background-color: #f3f4f6;
        }

        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
        }

        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body class="bg-gray-50">
    <!-- Header -->
    <script src="components/header.js"></script>
    <script src="components/sidebar.js"></script>

    <!-- Main Content -->
    <main id="mainContent" class="ml-16 pt-16 transition-all duration-100">
        <div class="p-6">
            <!-- Page Header -->
            <div class="mb-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">NCR Analytics Dashboard</h2>
                        <p class="text-gray-600 mt-1">Monthly performance analysis of NCR activities</p>
                    </div>
                    <div class="flex items-center space-x-3">
                        <div class="bg-white px-4 py-2 rounded-lg shadow-sm border">
                            <span class="text-sm text-gray-500">Year:</span>
                            <span class="font-semibold text-blue-600 ml-2">2024</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Key Metrics Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <div class="w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-exclamation-triangle text-red-600 text-sm"></i>
                            </div>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm font-medium text-gray-500">Total Reported</p>
                            <p class="text-lg font-semibold text-gray-900" id="totalReported">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <div class="w-8 h-8 bg-yellow-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-reply text-yellow-600 text-sm"></i>
                            </div>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm font-medium text-gray-500">Total Replied</p>
                            <p class="text-lg font-semibold text-gray-900" id="totalReplied">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-check-circle text-green-600 text-sm"></i>
                            </div>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm font-medium text-gray-500">Total Completed</p>
                            <p class="text-lg font-semibold text-gray-900" id="totalCompleted">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-percentage text-purple-600 text-sm"></i>
                            </div>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm font-medium text-gray-500">Completion Rate</p>
                            <p class="text-lg font-semibold text-gray-900" id="completionRate">0%</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Chart Legend -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Chart Legend</h3>
                <div class="flex flex-wrap gap-6">
                    <div class="flex items-center">
                        <div class="w-4 h-4 bg-red-500 rounded mr-2"></div>
                        <span class="text-sm text-gray-700">NCR Reported</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-4 h-4 bg-yellow-500 rounded mr-2"></div>
                        <span class="text-sm text-gray-700">NCR Reply</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-4 h-4 bg-green-500 rounded mr-2"></div>
                        <span class="text-sm text-gray-700">NCR Done</span>
                    </div>
                </div>
            </div>

            <!-- Main Chart -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
                <div class="mb-4">
                    <h3 class="text-lg font-medium text-gray-900">Monthly NCR Performance</h3>
                    <p class="text-sm text-gray-600">Comparison of reported, replied, and completed NCR by month</p>
                </div>
                <div class="chart-container">
                    <canvas id="monthlyChart"></canvas>
                </div>
            </div>

            <!-- Monthly Details Table -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
                <div class="px-4 py-3 border-b border-gray-200 bg-gray-50">
                    <h3 class="text-lg font-medium text-gray-900">Monthly Breakdown</h3>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Month</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    <span class="flex items-center">
                                        <div class="w-3 h-3 bg-red-500 rounded mr-2"></div>
                                        Reported
                                    </span>
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    <span class="flex items-center">
                                        <div class="w-3 h-3 bg-yellow-500 rounded mr-2"></div>
                                        Reply
                                    </span>
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    <span class="flex items-center">
                                        <div class="w-3 h-3 bg-green-500 rounded mr-2"></div>
                                        Done
                                    </span>
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rate (%)</th>
                            </tr>
                        </thead>
                        <tbody id="monthlyTableBody" class="bg-white divide-y divide-gray-200">
                            <!-- Data will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Monthly NCR data for 2024
        const monthlyData = [
            { month: 'January', reported: 45, reply: 38, done: 35 },
            { month: 'February', reported: 52, reply: 44, done: 41 },
            { month: 'March', reported: 48, reply: 42, done: 38 },
            { month: 'April', reported: 58, reply: 50, done: 46 },
            { month: 'May', reported: 41, reply: 36, done: 33 },
            { month: 'June', reported: 55, reply: 48, done: 44 },
            { month: 'July', reported: 49, reply: 43, done: 39 },
            { month: 'August', reported: 53, reply: 46, done: 42 },
            { month: 'September', reported: 47, reply: 41, done: 37 },
            { month: 'October', reported: 56, reply: 49, done: 45 },
            { month: 'November', reported: 44, reply: 39, done: 36 },
            { month: 'December', reported: 50, reply: 44, done: 40 }
        ];

        let chart;

        // Initialize the chart
        function initChart() {
            const ctx = document.getElementById('monthlyChart').getContext('2d');

            chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: monthlyData.map(item => item.month),
                    datasets: [
                        {
                            label: 'NCR Reported',
                            data: monthlyData.map(item => item.reported),
                            backgroundColor: '#ef4444',
                            borderColor: '#dc2626',
                            borderWidth: 1,
                            borderRadius: 4,
                            borderSkipped: false,
                        },
                        {
                            label: 'NCR Reply',
                            data: monthlyData.map(item => item.reply),
                            backgroundColor: '#f59e0b',
                            borderColor: '#d97706',
                            borderWidth: 1,
                            borderRadius: 4,
                            borderSkipped: false,
                        },
                        {
                            label: 'NCR Done',
                            data: monthlyData.map(item => item.done),
                            backgroundColor: '#10b981',
                            borderColor: '#059669',
                            borderWidth: 1,
                            borderRadius: 4,
                            borderSkipped: false,
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false // We have our own legend above
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#fff',
                            bodyColor: '#fff',
                            borderColor: '#374151',
                            borderWidth: 1,
                            cornerRadius: 8,
                            displayColors: true,
                            callbacks: {
                                title: function(context) {
                                    return context[0].label + ' 2024';
                                },
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y + ' cases';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#6b7280',
                                font: {
                                    size: 12
                                }
                            }
                        },
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: '#f3f4f6'
                            },
                            ticks: {
                                color: '#6b7280',
                                font: {
                                    size: 12
                                },
                                callback: function(value) {
                                    return value + ' cases';
                                }
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    animation: {
                        duration: 1000,
                        easing: 'easeInOutQuart'
                    }
                }
            });
        }

        // Update summary statistics
        function updateStatistics() {
            const totalReported = monthlyData.reduce((sum, month) => sum + month.reported, 0);
            const totalReplied = monthlyData.reduce((sum, month) => sum + month.reply, 0);
            const totalCompleted = monthlyData.reduce((sum, month) => sum + month.done, 0);
            const completionRate = totalReported > 0 ? Math.round((totalCompleted / totalReported) * 100) : 0;

            document.getElementById('totalReported').textContent = totalReported;
            document.getElementById('totalReplied').textContent = totalReplied;
            document.getElementById('totalCompleted').textContent = totalCompleted;
            document.getElementById('completionRate').textContent = completionRate + '%';
        }

        // Populate monthly table
        function populateTable() {
            const tableBody = document.getElementById('monthlyTableBody');
            tableBody.innerHTML = monthlyData.map(month => {
                const rate = month.reported > 0 ? Math.round((month.done / month.reported) * 100) : 0;
                return `
                    <tr class="hover:bg-gray-50 fade-in">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${month.month}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-red-600 font-semibold">${month.reported}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-yellow-600 font-semibold">${month.reply}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-green-600 font-semibold">${month.done}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            <div class="flex items-center">
                                <span class="font-semibold">${rate}%</span>
                                <div class="ml-2 w-16 bg-gray-200 rounded-full h-2">
                                    <div class="bg-gradient-to-r from-red-400 to-green-400 h-2 rounded-full" style="width: ${rate}%"></div>
                                </div>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Initialize everything when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            updateStatistics();
            populateTable();

            // Small delay to ensure canvas is properly sized
            setTimeout(() => {
                initChart();
            }, 100);
        });

        // Handle window resize
        window.addEventListener('resize', function() {
            if (chart) {
                chart.resize();
            }
        });
    </script>
</body>

</html>