<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yanmar QC Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Flatpickr CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <!-- Flatpickr JS -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <style>
        /* Toggle section styling */
        .toggle-container {
            margin-bottom: 2rem !important;
        }

        .toggle-section {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .toggle-section.collapsed {
            margin-bottom: 0 !important;
        }

        /* Ensure proper spacing for collapsed state */
        .toggle-container:has(.collapsed) {
            margin-bottom: 2rem !important;
        }
    </style>
    <script src="components/header.js"></script>
    <script src="components/sidebar.js"></script>
</head>

<body class="bg-gray-50 font-sans">
    <!-- Main Content -->
    <main id="mainContent" class="ml-16 pt-16 transition-all duration-100">
        <div class="p-6">

            <!-- Page Header -->
            <div class="mb-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">NCR Vendor Reply</h2>
                    </div>
                    <div class="flex items-center space-x-3">
                        <div class="bg-white px-4 py-2 rounded-lg shadow-sm border">
                            <span class="text-base text-gray-500">Status:</span>
                            <span class="font-semibold text-orange-600 ml-2">Vendor Confirmation</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Company Information -->
            <div class="mb-6">
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4">
                    <div class="mb-3">
                        <h3 class="text-lg font-semibold text-gray-800 mb-3">PT. Besi Kuat Manufacturing</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="flex items-center space-x-2">
                                <i class="fas fa-user text-gray-500"></i>
                                <div>
                                    <span class="text-sm text-gray-500">PIC:</span>
                                    <span class="font-medium text-gray-800 ml-1">Ahmad Wijaya</span>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <i class="fas fa-phone text-gray-500"></i>
                                <div>
                                    <span class="text-sm text-gray-500">Phone:</span>
                                    <span class="font-medium text-gray-800 ml-1">021-5432167</span>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <i class="fas fa-envelope text-gray-500"></i>
                                <div>
                                    <span class="text-sm text-gray-500">Email:</span>
                                    <span class="font-medium text-gray-800 ml-1">ahmad@besikuat.co.id</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Report Form -->
            <div class="bg-white rounded-lg shadow border border-gray-200 overflow-hidden">
                <form class="p-6 space-y-6" method="post" id="reportForm">

                    <!-- Report Info Section (Read-only) -->
                    <div class="mb-8">
                        <h4 class="text-base font-semibold text-gray-800 mb-6 flex items-center">
                            <svg class="w-5 h-5 text-gray-600 mr-2" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            Report Information
                        </h4>

                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 lg:gap-6">
                            <!-- NO NCR -->
                            <div>
                                <label class="block text-base font-medium text-gray-700 mb-2">No. NCR</label>
                                <div
                                    class="w-full px-4 py-4 bg-gray-100 border border-slate-300 rounded-lg text-gray-600 text-base">
                                    NCR-20250928-1425
                                </div>
                            </div>

                            <!-- Date -->
                            <div>
                                <label class="block text-base font-medium text-gray-700 mb-2">Date</label>
                                <div
                                    class="w-full px-4 py-4 bg-gray-100 border border-slate-300 rounded-lg text-gray-600 text-base">
                                    Saturday, September 28, 2025
                                </div>
                            </div>

                            <!-- Sender Department -->
                            <div>
                                <label class="block text-base font-medium text-gray-700 mb-2">Sender Department</label>
                                <div
                                    class="w-full px-4 py-4 bg-gray-100 border border-slate-300 rounded-lg text-gray-600 text-base">
                                    Machine Shop
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Report Title Section -->
                    <div class="mb-8">
                        <div>
                            <label class="block text-base font-medium text-gray-700 mb-2">Report Title</label>
                            <div
                                class="w-full px-4 py-4 bg-gray-100 border border-slate-300 rounded-lg text-gray-600 text-base">
                                Defect on Engine Mount Bracket - Crack in Welding Area
                            </div>
                        </div>
                    </div>

                    <!-- Data Parts Section -->
                    <div class="mb-8">
                        <h4 class="text-base font-semibold text-gray-800 mb-6 flex items-center">
                            <svg class="w-5 h-5 text-gray-600 mr-2" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                            </svg>
                            Data Parts
                        </h4>

                        <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4 lg:gap-6">
                            <!-- Part No -->
                            <div>
                                <label class="block text-base font-medium text-gray-700 mb-2">Part No.</label>
                                <div
                                    class="w-full px-4 py-4 bg-gray-100 border border-slate-300 rounded-lg text-gray-600 text-base">
                                    EMB-4TNV98-001
                                </div>
                            </div>

                            <!-- Part Name -->
                            <div>
                                <label class="block text-base font-medium text-gray-700 mb-2">Part Name</label>
                                <div
                                    class="w-full px-4 py-4 bg-gray-100 border border-slate-300 rounded-lg text-gray-600 text-base">
                                    Engine Mount Bracket
                                </div>
                            </div>

                            <!-- Model -->
                            <div>
                                <label class="block text-base font-medium text-gray-700 mb-2">Model</label>
                                <div
                                    class="w-full px-4 py-4 bg-gray-100 border border-slate-300 rounded-lg text-gray-600 text-base">
                                    4TNV98-ZNSA
                                </div>
                            </div>

                            <!-- Engine NO -->
                            <div>
                                <label class="block text-base font-medium text-gray-700 mb-2">Engine No.</label>
                                <div
                                    class="w-full px-4 py-4 bg-gray-100 border border-slate-300 rounded-lg text-gray-600 text-base">
                                    4TNV98-523847
                                </div>
                            </div>

                            <!-- Quantity Defects -->
                            <div>
                                <label class="block text-base font-medium text-gray-700 mb-2">Quantity Defects</label>
                                <div
                                    class="w-full px-4 py-4 bg-gray-100 border border-slate-300 rounded-lg text-gray-600 text-base">
                                    3
                                </div>
                            </div>

                            <!-- Problem Definition -->
                            <div>
                                <label class="block text-base font-medium text-gray-700 mb-2">Problem Definition</label>
                                <div
                                    class="w-full px-4 py-4 bg-gray-100 border border-slate-300 rounded-lg text-gray-600 text-base">
                                    <span
                                        class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-orange-100 text-orange-800">
                                        Reoccurrence / Berulang
                                    </span>
                                </div>
                            </div>

                            <!-- Class Part -->
                            <div>
                                <label class="block text-base font-medium text-gray-700 mb-2">Class Part</label>
                                <div
                                    class="w-full px-4 py-4 bg-gray-100 border border-slate-300 rounded-lg text-gray-600 text-base">
                                    <span
                                        class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800">
                                        Safety
                                    </span>
                                </div>
                            </div>

                            <!-- Location -->
                            <div>
                                <label class="block text-base font-medium text-gray-700 mb-2">Location</label>
                                <div
                                    class="w-full px-4 py-4 bg-gray-100 border border-slate-300 rounded-lg text-gray-600 text-base">
                                    QC Incoming - Line 2
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Problem Section -->
                    <div class="mb-8">
                        <h4 class="text-base font-semibold text-gray-800 mb-6 flex items-center">
                            <svg class="w-5 h-5 text-gray-600 mr-2" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.082 16.5c-.77.833.192 2.5 1.732 2.5z" />
                            </svg>
                            Problem Statement
                        </h4>

                        <div class="mb-6">
                            <div
                                class="w-full px-4 py-4 bg-gray-100 border border-slate-300 rounded-lg text-gray-600 text-lg min-h-32">
                                Found crack in the welding area of engine mount bracket. Crack detected at the joint
                                between base plate and mounting hole. Crack size approximately 15mm with depth reaching
                                2-3mm. This condition has potential to cause failure during engine operation and may
                                endanger operator safety.
                            </div>
                        </div>
                    </div>

                    <!-- Media Section -->
                    <div class="mb-8">
                        <h4 class="text-base font-semibold text-gray-800 mb-6 flex items-center">
                            <svg class="w-5 h-5 text-gray-600 mr-2" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                            </svg>
                            Media Evidence
                        </h4>

                        <div class="space-y-6">
                            <!-- Voice Notes -->
                            <div>
                                <label class="block text-base font-medium text-gray-700 mb-2">Voice Notes</label>
                                <div class="relative p-4 bg-gray-50 border border-slate-200 rounded-lg overflow-hidden">
                                    <div class="flex items-center space-x-4">
                                        <!-- Play Button with Background Red -->
                                        <button type="button" id="voicePlayBtn"
                                            class="flex items-center justify-center w-12 h-12 bg-red-700 hover:bg-red-800 rounded-full transition-all duration-200 transform hover:scale-105 shadow-md group">
                                            <i id="voiceIcon"
                                                class="fas fa-play text-white text-lg transition-transform duration-200 group-hover:scale-110"></i>
                                        </button>

                                        <!-- Title and Duration -->
                                        <div class="flex-1">
                                            <span class="text-base text-gray-600 font-medium">Voice recording
                                                available</span>

                                        </div>

                                        <!-- Animated Lines (Right Side) -->
                                        <div id="animatedLines"
                                            class="flex items-center space-x-1 opacity-0 transition-opacity duration-300">
                                            <div class="w-1 h-8 bg-red-700 rounded-full animate-pulse"
                                                style="animation-delay: 0s; animation-duration: 0.8s;"></div>
                                            <div class="w-1 h-6 bg-red-700 rounded-full animate-pulse"
                                                style="animation-delay: 0.1s; animation-duration: 0.9s;"></div>
                                            <div class="w-1 h-10 bg-red-700 rounded-full animate-pulse"
                                                style="animation-delay: 0.2s; animation-duration: 0.7s;"></div>
                                            <div class="w-1 h-4 bg-red-700 rounded-full animate-pulse"
                                                style="animation-delay: 0.3s; animation-duration: 1s;"></div>
                                            <div class="w-1 h-7 bg-red-700 rounded-full animate-pulse"
                                                style="animation-delay: 0.4s; animation-duration: 0.6s;"></div>
                                        </div>
                                    </div>

                                    <!-- Progress Line (Moving from Left to Right) -->
                                    <div id="progressLine"
                                        class="absolute bottom-0 left-0 h-1 bg-gradient-to-r from-red-700 to-red-500 transition-all duration-100 ease-out opacity-0"
                                        style="width: 0%"></div>
                                </div>
                            </div>

                            <!-- Images and Videos -->
                            <div>
                                <label class="block text-base font-medium text-gray-700 mb-2">Images & Videos
                                    (3)</label>
                                <div class="grid grid-cols-3 gap-3">
                                    <!-- Image 1 -->
                                    <div class="aspect-square bg-gray-200 rounded-lg border-2 border-gray-300 overflow-hidden cursor-pointer hover:border-red-600 transition-colors group"
                                        onclick="openImageModal('images/baud.png', 'baud.png');">
                                        <img src="images/baud.png" alt="Evidence Image 1"
                                            class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-200">
                                    </div>

                                    <!-- Image 2 -->
                                    <div class="aspect-square bg-gray-200 rounded-lg border-2 border-gray-300 overflow-hidden cursor-pointer hover:border-red-600 transition-colors group"
                                        onclick="openImageModal('images/baud-2.png', 'baud-2.png');">
                                        <img src="images/baud-2.png" alt="Evidence Image 2"
                                            class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-200">
                                    </div>

                                    <!-- Video -->
                                    <div class="aspect-square bg-gray-200 rounded-lg border-2 border-gray-300 overflow-hidden cursor-pointer hover:border-red-600 transition-colors group relative"
                                        onclick="openVideoModal('images/videos.mp4');">
                                        <!-- Video Thumbnail -->
                                        <video class="w-full h-full object-cover" muted preload="metadata" poster="">
                                            <source src="images/videos.mp4#t=0.5" type="video/mp4">
                                        </video>

                                        <!-- Play overlay -->
                                        <div
                                            class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-40 group-hover:bg-opacity-30 transition-all duration-200">
                                            <div
                                                class="bg-white bg-opacity-95 rounded-full w-16 h-16 flex items-center justify-center group-hover:scale-110 transition-transform duration-200 shadow-lg">
                                                <i class="fas fa-play text-red-600 text-2xl ml-1"></i>
                                            </div>
                                        </div>

                                        <!-- Video Info Badge -->
                                        <div
                                            class="absolute top-2 left-2 bg-black bg-opacity-70 text-white px-2 py-1 rounded text-xs font-medium">
                                            <i class="fas fa-video mr-1"></i>VIDEO
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                </form>
            </div>

            <!-- Vendor Reply Title -->
            <div class="mb-6 mt-8">
                <h3 class="text-xl font-bold text-gray-800 mb-2">Vendor Reply</h3>
                <p class="text-gray-600">Please provide your response and corrective actions for this NCR.</p>
            </div>

            <!-- Temporary Action Box -->
            <div class="bg-white rounded-lg shadow border border-gray-200 overflow-hidden">
                <form class="p-6 space-y-6" method="post" id="vendorReplyForm">

                    <!-- Temporary Action Section -->
                    <div class="mb-8">
                        <h4 class="text-base font-semibold text-gray-800 mb-6 flex items-center">
                            <svg class="w-5 h-5 text-gray-600 mr-2" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
                            </svg>
                            Temporary Action
                        </h4>

                        <div class="space-y-6">
                            <!-- Temporary Action Description -->
                            <div>
                                <label class="block text-base font-medium text-gray-700 mb-2">Action Taken</label>
                                <textarea readonly
                                    class="w-full px-4 py-4 bg-gray-100 border border-gray-300 rounded-lg text-lg resize-none text-gray-700"
                                    rows="3">We have immediately stopped production of affected parts and segregated all inventory from lot EMB-2024-1201 to EMB-2024-1205. All welding equipment has been recalibrated and welding parameters have been adjusted. Additional QC inspection points have been implemented for welding quality check. New operator training session conducted for proper welding techniques. Production will resume only after approval from QC department.</textarea>
                            </div>

                            <!-- Upload Section -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Image Upload -->
                                <div>
                                    <label class="block text-base font-medium text-gray-700 mb-2">Images</label>
                                    <input type="file" id="tempImageUpload" accept="image/*" multiple class="hidden">
                                    <div id="tempImageUploadPrompt"
                                        class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-red-500 transition-colors cursor-pointer"
                                        onclick="document.getElementById('tempImageUpload').click()">
                                        <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none"
                                            viewBox="0 0 48 48">
                                            <path
                                                d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02"
                                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                        </svg>
                                        <p class="text-base text-gray-600">Click to upload images</p>
                                        <p class="text-sm text-gray-400">PNG, JPG max 10MB</p>
                                    </div>
                                    <!-- Image Thumbnails -->
                                    <div id="tempImageThumbnails" class="grid grid-cols-2 gap-3 hidden mt-4"></div>
                                    <!-- Add More Button -->
                                    <div id="tempAddMoreImages" class="hidden mt-2">
                                        <label for="tempImageUpload"
                                            class="cursor-pointer inline-flex items-center px-3 py-1 text-xs bg-red-600 text-white rounded-full hover:bg-red-700 transition-colors">
                                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor"
                                                viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M12 4v16m8-8H4" />
                                            </svg>
                                            Add More
                                        </label>
                                    </div>
                                </div>

                                <!-- Video Upload -->
                                <div>
                                    <label class="block text-base font-medium text-gray-700 mb-2">Videos</label>
                                    <input type="file" id="tempVideoUpload" accept="video/*" multiple class="hidden">
                                    <div id="tempVideoUploadPrompt"
                                        class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-red-500 transition-colors cursor-pointer"
                                        onclick="document.getElementById('tempVideoUpload').click()">
                                        <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor"
                                            viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
                                        </svg>
                                        <p class="text-base text-gray-600">Click to upload videos</p>
                                        <p class="text-sm text-gray-400">MP4, MOV max 50MB</p>
                                    </div>
                                    <!-- Video Thumbnails -->
                                    <div id="tempVideoThumbnails" class="grid grid-cols-2 gap-3 hidden mt-4"></div>
                                    <!-- Add More Button -->
                                    <div id="tempAddMoreVideos" class="hidden mt-2">
                                        <label for="tempVideoUpload"
                                            class="cursor-pointer inline-flex items-center px-3 py-1 text-xs bg-red-600 text-white rounded-full hover:bg-red-700 transition-colors">
                                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor"
                                                viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M12 4v16m8-8H4" />
                                            </svg>
                                            Add More
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Date Section -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Date Start -->
                                <div>
                                    <label class="block text-base font-medium text-gray-700 mb-2">Date Start</label>
                                    <input type="date" id="dateStart" value="2024-09-29" readonly
                                        class="w-full px-4 py-4 bg-gray-100 border border-gray-300 rounded-lg text-lg text-gray-700">
                                </div>

                                <!-- Date Good Lot -->
                                <div>
                                    <label class="block text-base font-medium text-gray-700 mb-2">Date Good Lot</label>
                                    <input type="date" id="dateGoodLot" value="2024-10-02" readonly
                                        class="w-full px-4 py-4 bg-gray-100 border border-gray-300 rounded-lg text-lg text-gray-700">
                                </div>
                            </div>
                        </div>
                    </div>

                </form>
            </div>


            <!-- Advanced Analysis Section -->
            <div id="advancedAnalysisSection" class="hidden">




            </div>

            <!-- Enable Detail Analysis Checkbox -->
            <div class="bg-white rounded-lg shadow border border-gray-200 overflow-hidden mt-8">
                <div class="p-6">
                    <label class="flex items-center space-x-3 cursor-pointer">
                        <input type="checkbox" id="enableDetailAnalysis"
                            class="w-5 h-5 text-red-600 border-gray-300 rounded focus:ring-red-500 focus:ring-2">
                        <span class="text-base text-gray-700">
                            Enable detailed analysis (Process Flow, Problem Analysis & Countermeasures)
                        </span>
                    </label>
                </div>
            </div>

            <!-- Admin Remarks Section -->
            <div class="bg-white rounded-lg shadow border border-gray-200 overflow-hidden mt-8">
                <div class="p-6 space-y-6">
                    <!-- Remarks Text Area -->
                    <div>
                        <label class="block text-base font-medium text-gray-700 mb-2">Admin Remarks</label>
                        <textarea
                            class="w-full px-4 py-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 text-lg resize-none"
                            rows="4" placeholder="Enter your remarks about the vendor's response..."></textarea>
                    </div>

                </div>
            </div>

            <!-- Admin Action Section -->
            <div class="mt-8 mb-8">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Request Revision Button -->
                    <button type="button" id="requestRevisionBtn" onclick="requestRevision()"
                        class="w-full bg-gray-400 text-white py-4 rounded-lg font-semibold text-lg flex items-center justify-center space-x-2 cursor-not-allowed"
                        disabled>
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>Request Analysis</span>
                    </button>

                    <!-- Closed Report Button -->
                    <button type="button" onclick="closedReport()"
                        class="w-full bg-green-600 text-white py-4 rounded-lg hover:bg-green-700 font-semibold text-lg flex items-center justify-center space-x-2">
                        <i class="fas fa-check-circle"></i>
                        <span>Submit For Approval</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Media Modal -->
        <div id="mediaModal"
            class="fixed inset-0 bg-black bg-opacity-75 z-50 hidden flex items-center justify-center p-4"
            onclick="closeModal()">
            <div class="relative max-w-4xl max-h-full w-full" onclick="event.stopPropagation()">
                <!-- Modal Content -->
                <div id="mediaContent" class="bg-white rounded-lg overflow-hidden shadow-2xl max-h-full relative">
                    <!-- Content will be dynamically inserted here -->
                </div>
            </div>
        </div>



        <!-- JavaScript -->
        <script>
            // Media Modal Functions - Global functions outside DOMContentLoaded
            function openImageModal(imageSrc, fileName) {
                console.log('Opening image modal:', imageSrc, fileName);
                const modal = document.getElementById('mediaModal');
                const content = document.getElementById('mediaContent');

                if (!modal || !content) {
                    console.error('Modal elements not found');
                    return;
                }

                content.innerHTML = `
                    <!-- Close Button -->
                    <button onclick="closeModal()" class="absolute top-3 right-3 text-gray-500 hover:text-gray-700 z-20 bg-white rounded-full w-8 h-8 flex items-center justify-center shadow-lg">
                        <i class="fas fa-times"></i>
                    </button>
                    <div class="p-6">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <h3 class="text-lg font-semibold text-gray-900">Image Preview</h3>
                                <p class="text-sm text-gray-500">${fileName}</p>
                            </div>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4 flex justify-center">
                            <img src="${imageSrc}" alt="${fileName}" class="max-w-full max-h-96 object-contain rounded-lg shadow-sm">
                        </div>
                    </div>
                `;

                modal.classList.remove('hidden');
            }

            function openVideoModal(videoSrc, title = 'Video Preview', filename = '') {
                console.log('Opening video modal:', videoSrc, title, filename);
                const modal = document.getElementById('mediaModal');
                const content = document.getElementById('mediaContent');

                if (!modal || !content) {
                    console.error('Modal elements not found');
                    return;
                }

                const displayTitle = title || 'Video Preview';
                const displayFilename = filename || videoSrc;

                content.innerHTML = `
                    <!-- Close Button -->
                    <button onclick="closeModal()" class="absolute top-3 right-3 text-gray-500 hover:text-gray-700 z-20 bg-white rounded-full w-8 h-8 flex items-center justify-center shadow-lg">
                        <i class="fas fa-times"></i>
                    </button>
                    <div class="p-6">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <h3 class="text-lg font-semibold text-gray-900">${displayTitle}</h3>
                                <p class="text-sm text-gray-500">${displayFilename}</p>
                            </div>
                        </div>
                        <div class="bg-gray-50 rounded-lg p-4 flex justify-center">
                            <video controls autoplay class="max-w-full max-h-96 rounded-lg shadow-sm">
                                <source src="${videoSrc}" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>
                        </div>
                    </div>
                `;

                modal.classList.remove('hidden');
            }

            // Close modal function - Global
            function closeModal() {
                const modal = document.getElementById('mediaModal');
                if (modal) {
                    modal.classList.add('hidden');
                }
            }

            // Admin Edit Mode Functionality
            let isEditMode = false;

            function enableEditMode() {
                console.log('Enabling edit mode for admin...');
                isEditMode = true;

                // Enable all form inputs
                const form = document.getElementById('reportForm');
                if (form) {
                    const inputs = form.querySelectorAll('input, textarea, select');
                    inputs.forEach(input => {
                        input.disabled = false;
                        input.style.backgroundColor = '#fff';
                        input.style.border = '2px solid #3b82f6';
                    });

                    // Enable radio buttons
                    const radioButtons = form.querySelectorAll('input[type="radio"]');
                    radioButtons.forEach(radio => {
                        radio.disabled = false;
                        const label = radio.closest('label');
                        if (label) {
                            label.style.opacity = '1';
                            label.style.pointerEvents = 'auto';
                        }
                    });

                    // Show save/cancel buttons
                    showEditButtons();

                    // Update status
                    updateStatusToEditing();

                    showNotification('Edit mode enabled. You can now modify the form.', 'info');
                } else {
                    console.error('Report form not found!');
                }
            }

            function disableEditMode() {
                console.log('Disabling edit mode...');
                isEditMode = false;

                // Disable all form inputs
                const form = document.getElementById('reportForm');
                if (form) {
                    const inputs = form.querySelectorAll('input, textarea, select');
                    inputs.forEach(input => {
                        input.disabled = true;
                        input.style.backgroundColor = '#f9fafb';
                        input.style.border = '1px solid #d1d5db';
                    });

                    // Disable radio buttons
                    const radioButtons = form.querySelectorAll('input[type="radio"]');
                    radioButtons.forEach(radio => {
                        radio.disabled = true;
                        const label = radio.closest('label');
                        if (label) {
                            label.style.opacity = '0.6';
                            label.style.pointerEvents = 'none';
                        }
                    });

                    // Hide save/cancel buttons
                    hideEditButtons();

                    // Restore status
                    updateStatusToPending();

                    showNotification('Edit mode disabled. Form is now read-only.', 'info');
                }
            }

            function saveEditChanges() {
                console.log('Saving edit changes...');

                // Here you would typically send data to server
                // For now, just disable edit mode
                disableEditMode();

                showNotification('Changes saved successfully!', 'success');
            }

            function cancelEditChanges() {
                console.log('Cancelling edit changes...');

                // Reload page to revert changes (or implement proper revert logic)
                if (confirm('Are you sure you want to cancel? All unsaved changes will be lost.')) {
                    window.location.reload();
                }
            }

            // Temporary Action Upload Functionality
            const tempImageUpload = document.getElementById('tempImageUpload');
            const tempImageThumbnails = document.getElementById('tempImageThumbnails');
            const tempImageUploadPrompt = document.getElementById('tempImageUploadPrompt');
            const tempAddMoreImages = document.getElementById('tempAddMoreImages');
            let tempUploadedImages = [];

            tempImageUpload.addEventListener('change', function (e) {
                const newFiles = Array.from(e.target.files);
                newFiles.forEach(file => {
                    if (file.type.startsWith('image/')) {
                        tempUploadedImages.push(file);
                    }
                });
                displayTempImageThumbnails();
            });

            function displayTempImageThumbnails() {
                tempImageThumbnails.innerHTML = '';
                if (tempUploadedImages.length > 0) {
                    tempImageUploadPrompt.classList.add('hidden');
                    tempImageThumbnails.classList.remove('hidden');
                    tempAddMoreImages.classList.remove('hidden');

                    tempUploadedImages.forEach((file, index) => {
                        const reader = new FileReader();
                        reader.onload = function (e) {
                            const thumbnailDiv = document.createElement('div');
                            thumbnailDiv.className = 'relative group cursor-pointer';
                            thumbnailDiv.innerHTML = `
                                <div class="aspect-square rounded-lg overflow-hidden hover:opacity-80 transition-opacity">
                                    <img src="${e.target.result}" alt="Temp Image ${index + 1}" class="w-full h-full object-cover rounded-lg" />
                                    <button class="absolute top-2 right-2 w-6 h-6 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-600 flex items-center justify-center shadow-lg" onclick="removeTempImage(${index})">
                                        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                        </svg>
                                    </button>
                                </div>
                            `;

                            // Add click event for modal
                            thumbnailDiv.addEventListener('click', function (event) {
                                if (!event.target.closest('button')) {
                                    openImageModal(e.target.result, `Temporary Action Image ${index + 1}`, file.name);
                                }
                            });
                            tempImageThumbnails.appendChild(thumbnailDiv);
                        };
                        reader.readAsDataURL(file);
                    });
                } else {
                    tempImageUploadPrompt.classList.remove('hidden');
                    tempImageThumbnails.classList.add('hidden');
                    tempAddMoreImages.classList.add('hidden');
                }
            }

            function removeTempImage(index) {
                tempUploadedImages.splice(index, 1);
                displayTempImageThumbnails();
                tempImageUpload.value = '';
            }

            // Temporary Video Upload
            const tempVideoUpload = document.getElementById('tempVideoUpload');
            const tempVideoThumbnails = document.getElementById('tempVideoThumbnails');
            const tempVideoUploadPrompt = document.getElementById('tempVideoUploadPrompt');
            const tempAddMoreVideos = document.getElementById('tempAddMoreVideos');
            let tempUploadedVideos = [];

            tempVideoUpload.addEventListener('change', function (e) {
                const newFiles = Array.from(e.target.files);
                newFiles.forEach(file => {
                    if (file.type.startsWith('video/')) {
                        tempUploadedVideos.push(file);
                    }
                });
                displayTempVideoThumbnails();
            });

            function displayTempVideoThumbnails() {
                tempVideoThumbnails.innerHTML = '';
                if (tempUploadedVideos.length > 0) {
                    tempVideoUploadPrompt.classList.add('hidden');
                    tempVideoThumbnails.classList.remove('hidden');
                    tempAddMoreVideos.classList.remove('hidden');

                    tempUploadedVideos.forEach((file, index) => {
                        const video = document.createElement('video');
                        video.src = URL.createObjectURL(file);
                        video.load();
                        video.onloadedmetadata = function () {
                            const canvas = document.createElement('canvas');
                            const ctx = canvas.getContext('2d');
                            canvas.width = 200;
                            canvas.height = 200;
                            video.currentTime = 1;
                            video.onseeked = function () {
                                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                                const thumbnailDiv = document.createElement('div');
                                thumbnailDiv.className = 'relative group cursor-pointer';
                                thumbnailDiv.innerHTML = `
                                    <div class="aspect-square rounded-lg overflow-hidden hover:opacity-80 transition-opacity relative">
                                        <video class="w-full h-full object-cover rounded-lg" muted>
                                            <source src="${video.src}" type="video/mp4">
                                        </video>
                                        <div class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-40 group-hover:bg-opacity-30 transition-all duration-200">
                                            <div class="bg-white bg-opacity-95 rounded-full w-16 h-16 flex items-center justify-center group-hover:scale-110 transition-transform duration-200 shadow-lg">
                                                <i class="fas fa-play text-red-600 text-2xl ml-1"></i>
                                            </div>
                                        </div>
                                        <div class="absolute top-2 left-2 bg-black bg-opacity-70 text-white px-2 py-1 rounded text-xs font-medium">
                                            <i class="fas fa-video mr-1"></i>VIDEO
                                        </div>
                                        <button class="absolute top-2 right-2 w-6 h-6 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-600 flex items-center justify-center shadow-lg" onclick="removeTempVideo(${index})">
                                            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                            </svg>
                                        </button>
                                    </div>
                                `;

                                // Add click event for video modal
                                thumbnailDiv.addEventListener('click', function (event) {
                                    if (!event.target.closest('button')) {
                                        openVideoModal(video.src, `Temporary Action Video ${index + 1}`, file.name);
                                    }
                                });

                                tempVideoThumbnails.appendChild(thumbnailDiv);
                            };
                        };
                    });
                } else {
                    tempVideoUploadPrompt.classList.remove('hidden');
                    tempVideoThumbnails.classList.add('hidden');
                    tempAddMoreVideos.classList.add('hidden');
                }
            }

            function removeTempVideo(index) {
                tempUploadedVideos.splice(index, 1);
                displayTempVideoThumbnails();
                tempVideoUpload.value = '';
            }

            // Initialize Flatpickr for date inputs and checkbox functionality
            document.addEventListener('DOMContentLoaded', function () {
                // Initialize date pickers
                flatpickr("#dateStart", {
                    dateFormat: "Y-m-d",
                    defaultDate: "today",
                    theme: "material_red"
                });

                flatpickr("#dateGoodLot", {
                    dateFormat: "Y-m-d",
                    defaultDate: "today",
                    theme: "material_red"
                });

                // Request Revision button toggle based on checkbox
                const enableDetailAnalysisCheckbox = document.getElementById('enableDetailAnalysis');
                const requestRevisionBtn = document.getElementById('requestRevisionBtn');

                if (enableDetailAnalysisCheckbox && requestRevisionBtn) {
                    enableDetailAnalysisCheckbox.addEventListener('change', function () {
                        console.log('Checkbox changed:', this.checked);

                        if (this.checked) {
                            // Enable Request Revision button
                            requestRevisionBtn.disabled = false;
                            requestRevisionBtn.classList.remove('bg-gray-400', 'cursor-not-allowed');
                            requestRevisionBtn.classList.add('bg-red-600', 'hover:bg-red-700', 'cursor-pointer');
                            console.log('Button enabled');
                        } else {
                            // Disable Request Revision button
                            requestRevisionBtn.disabled = true;
                            requestRevisionBtn.classList.remove('bg-red-600', 'hover:bg-red-700', 'cursor-pointer');
                            requestRevisionBtn.classList.add('bg-gray-400', 'cursor-not-allowed');
                            console.log('Button disabled');
                        }
                    });
                } else {
                    console.error('Elements not found:', {
                        checkbox: !!enableDetailAnalysisCheckbox,
                        button: !!requestRevisionBtn
                    });
                }
            });

            // Toggle section collapse/expand functionality
            function toggleSection(sectionId) {
                const section = document.getElementById(sectionId);
                const icon = document.getElementById(sectionId.replace('Section', 'Icon'));
                const container = section.parentElement;

                if (section.classList.contains('collapsed')) {
                    // Expand
                    section.classList.remove('collapsed');
                    section.style.maxHeight = section.scrollHeight + 'px';
                    section.style.paddingTop = '1.5rem';
                    section.style.paddingBottom = '1.5rem';
                    section.style.marginBottom = '0';
                    container.style.marginBottom = '2rem';
                    icon.classList.remove('fa-chevron-down');
                    icon.classList.add('fa-chevron-up');
                    icon.style.transform = 'rotate(0deg)';

                    // Reset maxHeight after animation
                    setTimeout(() => {
                        section.style.maxHeight = 'none';
                    }, 300);
                } else {
                    // Collapse
                    section.classList.add('collapsed');
                    section.style.maxHeight = section.scrollHeight + 'px';
                    // Force reflow
                    section.offsetHeight;
                    section.style.maxHeight = '0px';
                    section.style.paddingTop = '0';
                    section.style.paddingBottom = '0';
                    section.style.marginBottom = '0';
                    container.style.marginBottom = '2rem';
                    icon.classList.remove('fa-chevron-up');
                    icon.classList.add('fa-chevron-down');
                    icon.style.transform = 'rotate(180deg)';
                }
            }

            // Add text box functionality
            function addTextBox(containerId) {
                const container = document.getElementById(containerId);
                const textarea = document.createElement('textarea');
                textarea.className = 'w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500 focus:border-red-500 text-sm';
                textarea.rows = 3;
                textarea.placeholder = 'Additional analysis...';
                container.appendChild(textarea);
            }





            // Admin Action Functions
            function requestRevision() {
                const enableDetailAnalysisCheckbox = document.getElementById('enableDetailAnalysis');

                // Check if detailed analysis is enabled
                if (!enableDetailAnalysisCheckbox || !enableDetailAnalysisCheckbox.checked) {
                    alert('Please enable detailed analysis before requesting revision.');
                    return;
                }

                console.log('Requesting revision...');

                // Here you would typically:
                // 1. Update report status to "Revision Requested"
                // 2. Send notification to vendor
                // 3. Log the revision request

                alert('Revision request has been sent to vendor.');

                // Optionally redirect to dashboard
                // window.location.href = 'dashboard.html';
            }

            function closedReport() {
                if (confirm('Are you sure you want to close this NCR report? This action will mark the report as resolved.')) {
                    // Collect form data and close report
                    console.log('Closing NCR report...');

                    // Here you would typically:
                    // 1. Update report status to "Closed"
                    // 2. Send notification to vendor
                    // 3. Archive the report

                    alert('NCR Report has been closed successfully!');

                    // Optionally redirect to dashboard
                    // window.location.href = 'dashboard.html';
                }
            }


            // Simple Voice Player Functionality
            document.addEventListener('DOMContentLoaded', function () {
                const voicePlayBtn = document.getElementById('voicePlayBtn');
                const voiceIcon = document.getElementById('voiceIcon');
                const animatedLines = document.getElementById('animatedLines');
                const progressLine = document.getElementById('progressLine');

                let isPlaying = false;
                let playInterval = null;
                let currentSeconds = 0;
                const totalSeconds = 135; // 02:15 in seconds

                voicePlayBtn.addEventListener('click', function () {
                    if (!isPlaying) {
                        // Start playing
                        isPlaying = true;

                        // Change icon to pause
                        voiceIcon.classList.remove('fa-play');
                        voiceIcon.classList.add('fa-pause');

                        // Show animated lines and progress
                        animatedLines.style.opacity = '1';
                        progressLine.style.opacity = '1';

                        // Start progress animation
                        playInterval = setInterval(() => {
                            currentSeconds++;
                            const progress = (currentSeconds / totalSeconds) * 100;
                            progressLine.style.width = progress + '%';

                            // End of recording
                            if (currentSeconds >= totalSeconds) {
                                stopPlaying();
                            }
                        }, 80); // Smooth animation

                    } else {
                        // Pause playing
                        pausePlaying();
                    }
                });

                function pausePlaying() {
                    isPlaying = false;

                    // Change icon back to play
                    voiceIcon.classList.remove('fa-pause');
                    voiceIcon.classList.add('fa-play');

                    // Hide animated lines
                    animatedLines.style.opacity = '0';

                    if (playInterval) {
                        clearInterval(playInterval);
                        playInterval = null;
                    }
                }

                function stopPlaying() {
                    pausePlaying();

                    // Reset progress after delay
                    setTimeout(() => {
                        currentSeconds = 0;
                        progressLine.style.width = '0%';
                        progressLine.style.opacity = '0';
                    }, 1000);

                    // Add completion glow effect
                    voicePlayBtn.style.boxShadow = '0 0 20px rgba(34, 197, 94, 0.6)';
                    setTimeout(() => {
                        voicePlayBtn.style.boxShadow = '';
                    }, 1000);
                }
            });
        </script>
    </main>

</body>

</html>