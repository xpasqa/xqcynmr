<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yanmar QC Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'yanmar-red': '#DC2626',
                        'yanmar-light': '#FEF2F2',
                        'yanmar-dark': '#991B1B'
                    },
                    animation: {
                        'slide-in': 'slide-in 0.3s ease-out',
                        'slide-out': 'slide-out 0.3s ease-in',
                        'fade-in': 'fade-in 0.2s ease-out'
                    },
                    keyframes: {
                        'slide-in': {
                            '0%': { transform: 'translateX(-100%)' },
                            '100%': { transform: 'translateX(0)' }
                        },
                        'slide-out': {
                            '0%': { transform: 'translateX(0)' },
                            '100%': { transform: 'translateX(-100%)' }
                        },
                        'fade-in': {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        }
                    }
                }
            }
        }
    </script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .sidebar-collapsed {
            width: 4rem;
        }

        .sidebar-expanded {
            width: 16rem;
        }

        .sidebar-transition {
            transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .menu-item-hover:hover {
            background: linear-gradient(90deg, rgba(220, 38, 38, 0.1), transparent);
            border-right: 3px solid #DC2626;
        }

        .tooltip {
            transform: translateX(0.5rem);
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .show-tooltip .tooltip {
            transform: translateX(1rem);
            opacity: 1;
            visibility: visible;
        }

        .menu-text {
            opacity: 0;
            transform: translateX(-10px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .sidebar-expanded .menu-text {
            opacity: 1;
            transform: translateX(0);
        }

        .menu-icon {
            min-width: 1.25rem;
            text-align: center;
        }

        /* Improved icon alignment for collapsed sidebar */
        .sidebar-collapsed nav a {
            justify-content: center;
            /* center icon horizontally */
            padding-left: 0.5rem;
            /* reduce left padding when collapsed */
            padding-right: 0.5rem;
        }

        .sidebar-collapsed .menu-icon {
            margin-right: 0;
            /* remove right margin */
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            font-size: 1.15rem;
            /* slightly larger icon for visibility */
        }

        /* hide the text when collapsed (keeps space clean) */
        .sidebar-collapsed .menu-text {
            display: none !important;
        }

        /* position tooltips just outside the slim sidebar */
        .sidebar-collapsed .tooltip {
            left: 4rem;
            /* hover tooltip appears aligned to collapsed width */
        }

        /* Restore left-aligned layout when expanded */
        .sidebar-expanded nav a {
            justify-content: flex-start;
            /* icon + text aligned to left */
            padding-left: 0.75rem;
        }

        .sidebar-expanded .menu-icon {
            width: auto;
            margin-right: 0.75rem;
            font-size: 1rem;
        }

        .sidebar-expanded .menu-text {
            display: inline-block !important;
            opacity: 1;
            transform: translateX(0);
        }

        /* Attachment preview styling */
        .attachment-preview {
            transition: transform 0.2s ease;
        }

        .attachment-preview:hover {
            transform: scale(1.02);
        }

        /* Priority option styling */
        .priority-option {
            transition: all 0.2s ease;
        }

        .priority-option:hover {
            background-color: #f9fafb;
            border-color: #DC2626;
        }

        .priority-option.selected {
            background-color: #fef2f2;
            border-color: #DC2626;
        }

        /* Phase card animations */
        .phase-card {
            transition: all 0.3s ease;
        }

        .phase-card.active {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            border-color: #DC2626;
        }

        /* Modal animations */
        #mediaModal {
            backdrop-filter: blur(4px);
        }

        /* Smooth transitions for all interactive elements */
        button,
        input,
        select,
        .cursor-pointer {
            transition: all 0.2s ease;
        }

        /* Summary boxes styling */
        #actionSummary,
        #supplierSummary {
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Hover effects for form sections */
        .border:hover {
            border-color: #D1D5DB;
        }

        /* Enhanced focus styles */
        input:focus,
        select:focus,
        textarea:focus {
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
        }
    </style>
    <script src="components/header.js"></script>
    <script src="components/sidebar.js"></script>
</head>

<body class="bg-gray-50 font-sans">

    <!-- Main Content -->
    <main id="mainContent" class="ml-16 pt-16 transition-all duration-100">
        <div class="p-6">
            <!-- Breadcrumb Navigation -->
            <nav class="flex mb-6" aria-label="Breadcrumb">
                <ol class="inline-flex items-center space-x-1 md:space-x-3">
                    <li class="inline-flex items-center">
                        <a href="dashboard.html"
                            class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-yanmar-red">
                            <i class="fas fa-home w-4 h-4 mr-2"></i>
                            Dashboard
                        </a>
                    </li>
                    <li>
                        <div class="flex items-center">
                            <i class="fas fa-chevron-right text-gray-400 text-xs"></i>
                            <a href="report.html"
                                class="ml-1 text-sm font-medium text-gray-700 hover:text-yanmar-red md:ml-2">NCR
                                Reports</a>
                        </div>
                    </li>
                    <li aria-current="page">
                        <div class="flex items-center">
                            <i class="fas fa-chevron-right text-gray-400 text-xs"></i>
                            <span class="ml-1 text-sm font-medium text-gray-500 md:ml-2" id="breadcrumbNCR">NC-25-09-001
                            </span>
                        </div>
                    </li>
                </ol>
            </nav>

            <!-- Page Header -->
            <div class="mb-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800" id="pageTitle">NCR Inspection</h2>
                        <p class="text-gray-600 mt-1" id="pageSubtitle">Review and process Non-Conformance Report</p>
                    </div>
                    <div class="flex items-center space-x-3">
                        <div class="bg-white px-4 py-2 rounded-lg shadow-sm border">
                            <span class="text-sm text-gray-500">NCR ID:</span>
                            <span class="font-semibold text-blue-600 ml-2" id="ncrIdDisplay">#NCR-001</span>
                        </div>
                        <div class="bg-white px-4 py-2 rounded-lg shadow-sm border">
                            <span class="text-sm text-gray-500">Status:</span>
                            <span class="font-semibold text-yellow-600 ml-2" id="ncrStatusDisplay">Under Review</span>
                        </div>
                    </div>
                </div>
            </div>
            <!-- NCR Recipient Information -->
            <div class="bg-white rounded-lg shadow mb-6">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h2 class="text-lg font-medium text-gray-900">NCR Addressed To</h2>
                </div>
                <div class="p-6">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Department</label>
                            <p class="mt-1 text-sm text-gray-900 font-semibold">QUALITY CONTROL DEPT.</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Supplier No.</label>
                            <p class="mt-1 text-sm text-gray-900 font-semibold">1010018</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">PIC Name</label>
                            <p class="mt-1 text-sm text-gray-900 font-semibold">Takeshi Yamamoto</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Email</label>
                            <p class="mt-1 text-sm text-gray-900 font-semibold">takeshi.yamamoto@yanmar.com</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Original Submission Data -->
            <div class="bg-white rounded-lg shadow mb-8">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h2 class="text-lg font-medium text-gray-900">
                        <span
                            class="bg-yanmar-red text-white rounded-full w-6 h-6 inline-flex items-center justify-center text-sm mr-2">1</span>
                        Identification of Problem
                    </h2>
                </div>
                <div class="p-6">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Left Column - Basic Information -->
                        <div class="space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Reporter</label>
                                    <p class="mt-1 text-sm text-gray-900">John Smith</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Department</label>
                                    <p class="mt-1 text-sm text-gray-900">Quality Control</p>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Date Submitted</label>
                                    <p class="mt-1 text-sm text-gray-900">January 15, 2024</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Location</label>
                                    <p class="mt-1 text-sm text-gray-900">Assembly Line A</p>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Part Number</label>
                                    <p class="mt-1 text-sm text-gray-900">YM-ENG-001-2024</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Part Name</label>
                                    <p class="mt-1 text-sm text-gray-900">Engine Block Assembly</p>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Model</label>
                                    <p class="mt-1 text-sm text-gray-900">TNV Series</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Class Part</label>
                                    <p class="mt-1 text-sm text-gray-900">Safety</p>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Defect Qty Found</label>
                                    <p class="mt-1 text-sm text-gray-900">3 units</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Total Defect Ratio</label>
                                    <p class="mt-1 text-sm text-gray-900">0.03% (3/10,000)</p>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Replacement Part</label>
                                    <p class="mt-1 text-sm text-gray-900">
                                        <span
                                            class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                            <i class="fas fa-check mr-1"></i>Yes
                                        </span>
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Right Column - Problem Details -->
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Detail of Problem</label>
                                <div class="mt-1 p-3 bg-red-50 border border-red-200 rounded-lg">
                                    <p class="text-sm text-gray-900">Visible crack approximately 2mm in length found
                                        during routine inspection. The crack appears to be surface-level and located on
                                        the cylinder head mounting surface. This defect may compromise the sealing
                                        integrity and could lead to coolant leakage if not addressed immediately.</p>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Process Flow Description</label>
                                <div class="mt-1 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                                    <p class="text-sm text-blue-900">1. Immediate containment: Quarantine affected batch
                                    </p>
                                    <p class="text-sm text-blue-900">2. Root cause analysis: Investigate machining
                                        process parameters</p>
                                    <p class="text-sm text-blue-900">3. Corrective action: Adjust cutting tool
                                        specifications and inspection frequency</p>
                                    <p class="text-sm text-blue-900">4. Verification: Implement additional quality
                                        checkpoints</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Photos and Evidence -->
            <div class="bg-white rounded-lg shadow mb-8">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h2 class="text-lg font-medium text-gray-900">
                        <span
                            class="bg-yanmar-red text-white rounded-full w-6 h-6 inline-flex items-center justify-center text-sm mr-2">2</span>
                        Photos and Evidence
                    </h2>
                </div>
                <div class="p-6">
                    <div class="space-y-6">
                        <!-- Photo Evidence -->
                        <div>
                            <div class="space-y-4">
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <div class="border border-gray-200 rounded-lg p-2 hover:border-yanmar-red transition-colors cursor-pointer"
                                        onclick="openImageModal('images/baud.png', 'defect_01.jpg')">
                                        <div class="relative group">
                                            <img src="images/baud.png" alt="Image 1"
                                                class="attachment-preview mx-auto rounded w-full aspect-square object-cover">
                                            <div
                                                class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-200 rounded flex items-center justify-center">
                                                <i
                                                    class="fas fa-expand text-white opacity-0 group-hover:opacity-100 transition-opacity text-xl"></i>
                                            </div>
                                            <div class="absolute top-1 right-1 bg-white bg-opacity-90 rounded-full p-1">
                                                <i class="fas fa-camera text-gray-600 text-xs"></i>
                                            </div>
                                        </div>
                                        <div class="mt-2">
                                            <p class="text-xs font-medium text-gray-900 truncate">defect_01.jpg</p>
                                            <p class="text-xs text-gray-500">2.1 MB</p>
                                        </div>
                                    </div>
                                    <div class="border border-gray-200 rounded-lg p-2 hover:border-yanmar-red transition-colors cursor-pointer"
                                        onclick="openImageModal('images/baud-2.png', 'defect_02.jpg')">
                                        <div class="relative group">
                                            <img src="images/baud-2.png" alt="Image 2"
                                                class="attachment-preview mx-auto rounded w-full aspect-square object-cover">
                                            <div
                                                class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-200 rounded flex items-center justify-center">
                                                <i
                                                    class="fas fa-expand text-white opacity-0 group-hover:opacity-100 transition-opacity text-xl"></i>
                                            </div>
                                            <div class="absolute top-1 right-1 bg-white bg-opacity-90 rounded-full p-1">
                                                <i class="fas fa-camera text-gray-600 text-xs"></i>
                                            </div>
                                        </div>
                                        <div class="mt-2">
                                            <p class="text-xs font-medium text-gray-900 truncate">defect_02.jpg</p>
                                            <p class="text-xs text-gray-500">1.8 MB</p>
                                        </div>
                                    </div>
                                    <div class="border border-gray-200 rounded-lg p-2 hover:border-yanmar-red transition-colors cursor-pointer"
                                        onclick="openVideoModal('inspection.mp4')">
                                        <div class="relative group">
                                            <div
                                                class="attachment-preview mx-auto bg-gray-100 rounded flex items-center justify-center w-full aspect-square">
                                                <i
                                                    class="fas fa-play text-gray-500 text-2xl group-hover:text-yanmar-red transition-colors"></i>
                                            </div>
                                            <div
                                                class="absolute top-1 right-1 bg-black bg-opacity-75 text-white text-xs px-1 py-0.5 rounded">
                                                <i class="fas fa-video mr-1"></i>MP4
                                            </div>
                                            <div
                                                class="absolute bottom-1 left-1 bg-black bg-opacity-75 text-white text-xs px-1 py-0.5 rounded">
                                                2:45
                                            </div>
                                        </div>
                                        <div class="mt-2">
                                            <p class="text-xs font-medium text-gray-900 truncate">inspection.mp4</p>
                                            <p class="text-xs text-gray-500">15.2 MB</p>
                                        </div>
                                    </div>
                                    <div
                                        class="border border-gray-200 rounded-lg p-2 border-dashed border-gray-300 flex items-center justify-center cursor-pointer hover:border-yanmar-red transition-colors">
                                        <div class="text-center">
                                            <i class="fas fa-plus text-gray-400 text-xl mb-2"></i>
                                            <p class="text-xs text-gray-500">Add more</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Voice Note -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-3">Voice Note</label>
                        </div>
                        <div class="border border-gray-200 rounded-lg p-3">
                            <div class="flex items-center space-x-2">
                                <i class="fas fa-microphone text-gray-400"></i>
                                <div class="flex-1">
                                    <div class="flex items-center space-x-2">
                                        <button id="playVoiceNote" class="text-yanmar-red hover:text-yanmar-dark">
                                            <i class="fas fa-play"></i>
                                        </button>
                                        <div class="flex-1 bg-gray-200 rounded-full h-2">
                                            <div class="bg-yanmar-red h-2 rounded-full" style="width: 0%">
                                            </div>
                                        </div>
                                        <span class="text-xs text-gray-500">0:00 / 0:45</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Supporting Documents -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-3">Supporting Documents</label>
                            <div class="space-y-3">
                                <div class="border border-gray-200 rounded-lg p-4 hover:border-yanmar-red transition-colors cursor-pointer"
                                    onclick="openDocumentModal('quality_report.pdf')">
                                    <div class="flex items-center space-x-3">
                                        <div class="flex-shrink-0">
                                            <div
                                                class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center">
                                                <i class="fas fa-file-pdf text-red-600 text-xl"></i>
                                            </div>
                                        </div>
                                        <div class="flex-1">
                                            <p class="text-sm font-medium text-gray-900">Quality Control Report</p>
                                            <p class="text-xs text-gray-500">quality_report.pdf • 2.4 MB • Uploaded: Jan
                                                15, 2024</p>
                                            <p class="text-xs text-gray-600 mt-1">Detailed inspection measurements and
                                                specifications</p>
                                        </div>
                                        <div class="flex-shrink-0">
                                            <i class="fas fa-download text-gray-400 hover:text-yanmar-red"></i>
                                        </div>
                                    </div>
                                </div>

                                <div class="border border-gray-200 rounded-lg p-4 hover:border-yanmar-red transition-colors cursor-pointer"
                                    onclick="openDocumentModal('process_specification.xlsx')">
                                    <div class="flex items-center space-x-3">
                                        <div class="flex-shrink-0">
                                            <div
                                                class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                                                <i class="fas fa-file-excel text-green-600 text-xl"></i>
                                            </div>
                                        </div>
                                        <div class="flex-1">
                                            <p class="text-sm font-medium text-gray-900">Process Specification Sheet</p>
                                            <p class="text-xs text-gray-500">process_specification.xlsx • 1.1 MB •
                                                Uploaded: Jan 15, 2024</p>
                                            <p class="text-xs text-gray-600 mt-1">Manufacturing process parameters and
                                                tolerances</p>
                                        </div>
                                        <div class="flex-shrink-0">
                                            <i class="fas fa-download text-gray-400 hover:text-yanmar-red"></i>
                                        </div>
                                    </div>
                                </div>

                                <div class="border border-gray-200 rounded-lg p-4 hover:border-yanmar-red transition-colors cursor-pointer"
                                    onclick="openDocumentModal('supplier_certificate.pdf')">
                                    <div class="flex items-center space-x-3">
                                        <div class="flex-shrink-0">
                                            <div
                                                class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                                <i class="fas fa-certificate text-blue-600 text-xl"></i>
                                            </div>
                                        </div>
                                        <div class="flex-1">
                                            <p class="text-sm font-medium text-gray-900">Material Certificate</p>
                                            <p class="text-xs text-gray-500">supplier_certificate.pdf • 890 KB •
                                                Uploaded: Jan 15, 2024</p>
                                            <p class="text-xs text-gray-600 mt-1">Raw material certification and test
                                                results</p>
                                        </div>
                                        <div class="flex-shrink-0">
                                            <i class="fas fa-download text-gray-400 hover:text-yanmar-red"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Phase 3: Temporary Action -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 mb-8">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h2 class="text-lg font-medium text-gray-900">
                        <span
                            class="bg-yanmar-red text-white rounded-full w-6 h-6 inline-flex items-center justify-center text-sm mr-2">3</span>
                        Temporary Action: QC Product Sort / Rework stock at Yadin
                    </h2>
                </div>
                <div class="p-6">
                    <div class="space-y-6">
                        <!-- Action Taken -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Action Taken</label>
                            <div class="bg-gray-50 border border-gray-200 rounded-md p-4">
                                <p class="text-sm font-semibold text-gray-900">Sort/rework stock at YADIN</p>
                            </div>
                        </div>

                        <!-- Identification at part/process -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Identification at
                                part/process</label>
                            <div class="bg-gray-50 border border-gray-200 rounded-md p-4">
                                <p class="text-sm text-gray-700 leading-relaxed">
                                    All affected products must be segregated and sorted to prevent further distribution
                                    of defective parts. Quality Control team will conduct immediate inspection and
                                    rework processes at Yadin facility. The process begins with immediate segregation
                                    where all suspected defective parts are isolated from production line and inventory
                                    to ensure containment. Following segregation, a comprehensive quality inspection is
                                    conducted using standardized QC procedures to assess the full scope of the defect.
                                    Once inspection is complete, necessary rework procedures are executed to bring parts
                                    back to specification at the Yadin facility. All inspection results and rework
                                    activities are thoroughly documented for traceability and future reference. Finally,
                                    a complete re-inspection and quality verification is performed before returning
                                    parts to the production flow to ensure all defects have been properly addressed.
                                </p>
                            </div>
                        </div>

                        <!-- Lot Production -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-3">Lot Production Timeline</label>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <!-- Day 1 - Rework -->
                                <div
                                    class="bg-white border border-orange-200 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-200">
                                    <div class="p-4">
                                        <div class="flex items-center justify-between mb-2">
                                            <div class="flex items-center">
                                                <div class="w-3 h-3 bg-orange-500 rounded-full mr-3"></div>
                                                <span class="text-sm font-medium text-gray-900">24/09/2025</span>
                                            </div>
                                            <span
                                                class="px-3 py-1 bg-orange-100 text-orange-800 text-xs font-medium rounded-full">
                                                <i class="fas fa-tools mr-1"></i>Rework
                                            </span>
                                        </div>
                                        <p class="text-xs text-gray-600">Quality rework process initiated</p>
                                    </div>
                                </div>

                                <!-- Day 2 - OK -->
                                <div
                                    class="bg-white border border-green-200 rounded-lg shadow-sm hover:shadow-md transition-shadow duration-200">
                                    <div class="p-4">
                                        <div class="flex items-center justify-between mb-2">
                                            <div class="flex items-center">
                                                <div class="w-3 h-3 bg-green-500 rounded-full mr-3"></div>
                                                <span class="text-sm font-medium text-gray-900">25/09/2025</span>
                                            </div>
                                            <span
                                                class="px-3 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full">
                                                <i class="fas fa-check-circle mr-1"></i>OK
                                            </span>
                                        </div>
                                        <p class="text-xs text-gray-600">Quality verification completed</p>
                                    </div>
                                </div>
                            </div>


                        </div>


                    </div>
                </div>
            </div>

            <!-- Phase 4: Flow Process -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 mb-8">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h2 class="text-lg font-medium text-gray-900">
                        <span
                            class="bg-yanmar-red text-white rounded-full w-6 h-6 inline-flex items-center justify-center text-sm mr-2">4</span>
                        Flow Process
                    </h2>
                </div>
                <div class="p-6">
                    <div class="space-y-6">
                        <!-- Process Flow Description -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Process Flow Overview</label>
                            <div class="bg-gray-50 border border-gray-200 rounded-md p-4">
                                <p class="text-sm text-gray-700 leading-relaxed">
                                    The NCR flow process begins with the identification and documentation of the quality
                                    issue by the reporting department. Once documented, the NCR is immediately escalated
                                    to the Quality Control Department where it undergoes initial assessment and
                                    temporary action implementation. The affected products are segregated and sorted at
                                    the Yadin facility to prevent further distribution while comprehensive quality
                                    inspection procedures are conducted. Following the inspection phase, necessary
                                    rework procedures are executed to bring all parts back to specification standards.
                                    All inspection results and rework activities are thoroughly documented for complete
                                    traceability and future reference. The process concludes with a final re-inspection
                                    and quality verification step before returning the corrected parts to the production
                                    flow, ensuring all identified defects have been properly addressed and resolved.
                                </p>
                            </div>
                        </div>

                    </div>
                </div>
            </div>


            <!-- Phase 5: Problem Analysis -->
            <div class="bg-white rounded-lg shadow mb-8">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h2 class="text-lg font-medium text-gray-900">
                        <span
                            class="bg-yanmar-red text-white rounded-full w-6 h-6 inline-flex items-center justify-center text-sm mr-2">5</span>
                        Problem Analysis
                    </h2>
                </div>
                <div class="p-6">
                    <div class="space-y-8">
                        <!-- Why Occurs Section -->
                        <div>
                            <div class="flex items-center mb-4">
                                <h3 class="text-lg font-semibold text-gray-900">Why Occurs?</h3>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                <!-- MAN -->
                                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                                    <h4 class="font-semibold text-gray-900 mb-3">MAN</h4>
                                    <div class="space-y-2">
                                        <p class="text-sm text-gray-700">Operator tidak mengikuti standar prosedur
                                            welding dengan benar, kurang training mengenai parameter welding yang
                                            optimal.</p>
                                        <p class="text-sm text-gray-700">Supervisor tidak melakukan checking berkala
                                            terhadap hasil welding operator.</p>
                                    </div>
                                </div>

                                <!-- MACHINE -->
                                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                                    <h4 class="font-semibold text-gray-900 mb-3">MACHINE</h4>
                                    <div class="space-y-2">
                                        <p class="text-sm text-gray-700">Welding machine tidak dikalibrasi secara rutin,
                                            electrode welding sudah aus dan perlu diganti.</p>
                                        <p class="text-sm text-gray-700">Maintenance schedule tidak diikuti dengan
                                            konsisten.</p>
                                    </div>
                                </div>

                                <!-- METHOD -->
                                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                                    <h4 class="font-semibold text-gray-900 mb-3">METHOD</h4>
                                    <div class="space-y-2">
                                        <p class="text-sm text-gray-700">Parameter welding (ampere, timing, pressure)
                                            tidak sesuai dengan spesifikasi untuk material thickness yang digunakan.</p>
                                        <p class="text-sm text-gray-700">Work instruction tidak detail mengenai setting
                                            welding machine untuk berbagai jenis material.</p>
                                    </div>
                                </div>

                                <!-- MATERIAL -->
                                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                                    <h4 class="font-semibold text-gray-900 mb-3">MATERIAL</h4>
                                    <p class="text-sm text-gray-700">Kualitas material nut dan base metal tidak sesuai
                                        dengan standar, terdapat coating yang mengganggu proses welding.</p>
                                </div>

                                <!-- ENVIRONMENT -->
                                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                                    <h4 class="font-semibold text-gray-900 mb-3">ENVIRONMENT</h4>
                                    <p class="text-sm text-gray-700">Kondisi ruangan welding terlalu lembab dan kurang
                                        sirkulasi udara yang mempengaruhi kualitas welding.</p>
                                </div>

                                <!-- Root Causes Why Occurs -->
                                <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
                                    <h5 class="font-semibold text-orange-900 mb-2">Root Causes (Why Occurs):</h5>
                                    <p class="text-sm text-orange-800">Kurangnya sistem kontrol kualitas yang konsisten
                                        dalam proses welding, tidak adanya kalibrasi rutin peralatan, dan kurangnya
                                        pelatihan operator mengenai standar welding yang tepat untuk berbagai jenis
                                        material dan kondisi lingkungan kerja.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Why Flow Out Section -->
                        <div class="border-t pt-6">
                            <div class="flex items-center mb-4">
                                <h3 class="text-lg font-semibold text-gray-900">Why Flow Out?</h3>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                <!-- MAN -->
                                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                                    <h4 class="font-semibold text-gray-900 mb-3">MAN</h4>
                                    <p class="text-sm text-gray-700">QC inspector tidak melakukan pemeriksaan menyeluruh
                                        terhadap hasil welding sebelum part dikirim ke tahap berikutnya.</p>
                                </div>

                                <!-- MACHINE -->
                                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                                    <h4 class="font-semibold text-gray-900 mb-3">MACHINE</h4>
                                    <p class="text-sm text-gray-700">Alat inspeksi welding tidak tersedia atau tidak
                                        berfungsi dengan baik untuk mendeteksi kekuatan sambungan welding.</p>
                                </div>

                                <!-- METHOD -->
                                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                                    <h4 class="font-semibold text-gray-900 mb-3">METHOD</h4>
                                    <p class="text-sm text-gray-700">Tidak ada prosedur inspection yang jelas untuk
                                        mengecek kekuatan welding pada tahap quality control.</p>
                                </div>

                                <!-- MATERIAL -->
                                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                                    <h4 class="font-semibold text-gray-900 mb-3">MATERIAL</h4>
                                    <p class="text-sm text-gray-700">Tidak adanya sample test material untuk memvalidasi
                                        kekuatan welding sebelum produksi massal.</p>
                                </div>

                                <!-- ENVIRONMENT -->
                                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                                    <h4 class="font-semibold text-gray-900 mb-3">ENVIRONMENT</h4>
                                    <p class="text-sm text-gray-700">Area quality control tidak memiliki ruang yang
                                        memadai untuk melakukan destructive test pada sample welding.</p>
                                </div>

                                <!-- Root Causes Why Flow Out -->
                                <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                                    <h5 class="font-semibold text-red-900 mb-2">Root Causes (Why Flow Out):</h5>
                                    <p class="text-sm text-red-800">Sistem quality control tidak memiliki mekanisme
                                        pengujian yang memadai untuk mendeteksi kekuatan sambungan welding, tidak adanya
                                        prosedur inspection yang komprehensif, dan kurangnya fasilitas testing yang
                                        diperlukan untuk memvalidasi kualitas welding sebelum produk dikirim.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Phase 6: Permanent Countermeasure -->
            <div class="bg-white rounded-lg shadow mb-8">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h2 class="text-lg font-medium text-gray-900">
                        <span
                            class="bg-yanmar-red text-white rounded-full w-6 h-6 inline-flex items-center justify-center text-sm mr-2">6</span>
                        Permanent Countermeasure
                    </h2>
                </div>
                <div class="p-6">
                    <!-- Countermeasure for Occurs -->
                    <div class="mb-8">
                        <h3 class="text-md font-semibold text-yanmar-dark mb-4">Countermeasure for Occurs</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">No
                                        </th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">
                                            Description</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">PIC
                                        </th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Due
                                            Date</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">
                                            Status</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">
                                            Verification</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <tr>
                                        <td class="px-4 py-3 text-sm text-gray-900">1</td>
                                        <td class="px-4 py-3 text-sm text-gray-900">Re-training operator welding dengan
                                            parameter yang benar</td>
                                        <td class="px-4 py-3 text-sm text-gray-900">Supervisor Welding</td>
                                        <td class="px-4 py-3 text-sm text-gray-900">2024-03-25</td>
                                        <td class="px-4 py-3">
                                            <span
                                                class="px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded-full">Completed</span>
                                        </td>
                                        <td class="px-4 py-3">
                                            <div class="flex items-center">
                                                <button onclick="toggleVerification(this)"
                                                    class="w-6 h-6 bg-green-500 text-white rounded-full flex items-center justify-center hover:bg-green-600 cursor-pointer verification-btn"
                                                    data-verified="true">
                                                    <i class="fas fa-check text-xs"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-3 text-sm text-gray-900">2</td>
                                        <td class="px-4 py-3 text-sm text-gray-900">Update work instruction welding
                                            dengan parameter detail</td>
                                        <td class="px-4 py-3 text-sm text-gray-900">Engineering Dept</td>
                                        <td class="px-4 py-3 text-sm text-gray-900">2024-03-30</td>
                                        <td class="px-4 py-3">
                                            <span
                                                class="px-2 py-1 text-xs font-medium bg-yellow-100 text-yellow-800 rounded-full">In
                                                Progress</span>
                                        </td>
                                        <td class="px-4 py-3">
                                            <div class="flex items-center">
                                                <button onclick="toggleVerification(this)"
                                                    class="w-6 h-6 bg-gray-300 text-white rounded-full flex items-center justify-center hover:bg-gray-400 cursor-pointer verification-btn"
                                                    data-verified="false">
                                                    <i class="fas fa-clock text-xs"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-3 text-sm text-gray-900">3</td>
                                        <td class="px-4 py-3 text-sm text-gray-900">Kalibrasi dan maintenance welding
                                            machine</td>
                                        <td class="px-4 py-3 text-sm text-gray-900">Maintenance Team</td>
                                        <td class="px-4 py-3 text-sm text-gray-900">2024-03-20</td>
                                        <td class="px-4 py-3">
                                            <span
                                                class="px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded-full">Completed</span>
                                        </td>
                                        <td class="px-4 py-3">
                                            <div class="flex items-center">
                                                <button onclick="toggleVerification(this)"
                                                    class="w-6 h-6 bg-green-500 text-white rounded-full flex items-center justify-center hover:bg-green-600 cursor-pointer verification-btn"
                                                    data-verified="true">
                                                    <i class="fas fa-check text-xs"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Countermeasure for Flow Out -->
                    <div>
                        <h3 class="text-md font-semibold text-yanmar-dark mb-4">Countermeasure for Flow Out</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">No
                                        </th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">
                                            Description</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">PIC
                                        </th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Due
                                            Date</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">
                                            Status</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">
                                            Verification</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <tr>
                                        <td class="px-4 py-3 text-sm text-gray-900">1</td>
                                        <td class="px-4 py-3 text-sm text-gray-900">Tambah check point welding strength
                                            test di inspection</td>
                                        <td class="px-4 py-3 text-sm text-gray-900">QC Inspector</td>
                                        <td class="px-4 py-3 text-sm text-gray-900">2024-03-28</td>
                                        <td class="px-4 py-3">
                                            <span
                                                class="px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded-full">Completed</span>
                                        </td>
                                        <td class="px-4 py-3">
                                            <div class="flex items-center">
                                                <button onclick="toggleVerification(this)"
                                                    class="w-6 h-6 bg-green-500 text-white rounded-full flex items-center justify-center hover:bg-green-600 cursor-pointer verification-btn"
                                                    data-verified="true">
                                                    <i class="fas fa-check text-xs"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-3 text-sm text-gray-900">2</td>
                                        <td class="px-4 py-3 text-sm text-gray-900">Implement destructive test untuk
                                            validasi weekly</td>
                                        <td class="px-4 py-3 text-sm text-gray-900">QA Engineer</td>
                                        <td class="px-4 py-3 text-sm text-gray-900">2024-04-01</td>
                                        <td class="px-4 py-3">
                                            <span
                                                class="px-2 py-1 text-xs font-medium bg-red-100 text-red-800 rounded-full">Overdue</span>
                                        </td>
                                        <td class="px-4 py-3">
                                            <div class="flex items-center">
                                                <button onclick="toggleVerification(this)"
                                                    class="w-6 h-6 bg-gray-300 text-white rounded-full flex items-center justify-center hover:bg-gray-400 cursor-pointer verification-btn"
                                                    data-verified="false">
                                                    <i class="fas fa-clock text-xs"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-3 text-sm text-gray-900">3</td>
                                        <td class="px-4 py-3 text-sm text-gray-900">Install warning system pada welding
                                            machine</td>
                                        <td class="px-4 py-3 text-sm text-gray-900">Maintenance Team</td>
                                        <td class="px-4 py-3 text-sm text-gray-900">2024-04-05</td>
                                        <td class="px-4 py-3">
                                            <span
                                                class="px-2 py-1 text-xs font-medium bg-yellow-100 text-yellow-800 rounded-full">In
                                                Progress</span>
                                        </td>
                                        <td class="px-4 py-3">
                                            <div class="flex items-center">
                                                <button onclick="toggleVerification(this)"
                                                    class="w-6 h-6 bg-gray-300 text-white rounded-full flex items-center justify-center hover:bg-gray-400 cursor-pointer verification-btn"
                                                    data-verified="false">
                                                    <i class="fas fa-clock text-xs"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Approval Section -->
            <div class="bg-white rounded-lg shadow mb-8">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h2 class="text-lg font-medium text-gray-900">
                        <span
                            class="bg-yanmar-red text-white rounded-full w-6 h-6 inline-flex items-center justify-center text-sm mr-2">7</span>
                        Approval
                    </h2>
                </div>
                <div class="p-6">
                    <div class="flex items-start gap-8">
                        <!-- YADIN-QC DEPT -->
                        <div>
                            <h3 class="text-sm font-semibold text-yanmar-dark mb-4">YADIN-QC DEPT</h3>
                            <div class="flex gap-4">
                                <div>
                                    <div class="text-xs text-gray-600 font-medium mb-2">Approved By</div>
                                    <div
                                        class="border border-gray-300 rounded-lg w-36 h-24 flex items-center justify-center bg-gray-50">
                                        <button onclick="openApprovalModal('yadin_approve')"
                                            class="text-xs text-gray-600 hover:text-yanmar-red font-medium">
                                            Approve
                                        </button>
                                    </div>
                                </div>
                                <div>
                                    <div class="text-xs text-gray-600 font-medium mb-2">Checked By</div>
                                    <div
                                        class="border border-gray-300 rounded-lg w-36 h-24 flex items-center justify-center bg-gray-50">
                                        <button onclick="openApprovalModal('yadin_check')"
                                            class="text-xs text-gray-600 hover:text-yanmar-red font-medium">
                                            Approve
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Divider Line -->
                        <div class="border-l border-gray-300 h-32 mt-8"></div>

                        <!-- YANMAR POWER TECHNOLOGY -->
                        <div>
                            <h3 class="text-sm font-semibold text-yanmar-dark mb-4">YANMAR POWER TECHNOLOGY</h3>
                            <div class="flex gap-4">
                                <div>
                                    <div class="text-xs text-gray-600 font-medium mb-2">Approved By</div>
                                    <div
                                        class="border border-gray-300 rounded-lg w-36 h-24 flex items-center justify-center bg-gray-50">
                                        <button onclick="openApprovalModal('yanmar_approve')"
                                            class="text-xs text-gray-600 hover:text-yanmar-red font-medium">
                                            Approve
                                        </button>
                                    </div>
                                </div>
                                <div>
                                    <div class="text-xs text-gray-600 font-medium mb-2">Checked By</div>
                                    <div
                                        class="border border-gray-300 rounded-lg w-36 h-24 flex items-center justify-center bg-gray-50">
                                        <button onclick="openApprovalModal('yanmar_check')"
                                            class="text-xs text-gray-600 hover:text-yanmar-red font-medium">
                                            Approve
                                        </button>
                                    </div>
                                </div>
                                <div>
                                    <div class="text-xs text-gray-600 font-medium mb-2">Created By</div>
                                    <div
                                        class="border border-gray-300 rounded-lg w-36 h-24 flex items-center justify-center bg-gray-50">
                                        <button onclick="openApprovalModal('yanmar_create')"
                                            class="text-xs text-gray-600 hover:text-yanmar-red font-medium">
                                            Approve
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Export Options -->
            <div class="bg-white rounded-lg shadow mb-8">
                <div class="p-6">
                    <div class="flex justify-center gap-4">
                        <button onclick="printToPDF()"
                            class="bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg text-sm font-medium flex items-center">
                            <i class="fas fa-file-pdf mr-2"></i>
                            Print to PDF
                        </button>
                        <button onclick="exportToXLS()"
                            class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg text-sm font-medium flex items-center">
                            <i class="fas fa-file-excel mr-2"></i>
                            Export to XLS
                        </button>
                    </div>
                </div>
            </div>

            <!-- Image/Video Modal -->
            <div id="mediaModal"
                class="fixed inset-0 bg-black bg-opacity-75 z-50 hidden flex items-center justify-center p-4">
                <div class="relative max-w-4xl max-h-full w-full">
                    <!-- Close Button -->
                    <button id="closeMediaModal"
                        class="absolute -top-10 right-0 text-white hover:text-yanmar-red text-2xl z-10">
                        <i class="fas fa-times w-8 h-8"></i>
                    </button>

                    <!-- Modal Content -->
                    <div id="mediaContent" class="bg-white rounded-lg overflow-hidden shadow-2xl max-h-full">
                        <!-- Content will be dynamically inserted here -->
                    </div>
                </div>
            </div>

            <!-- Approval Login Modal -->
            <div id="approvalModal"
                class="fixed inset-0 bg-black bg-opacity-75 z-50 hidden flex items-center justify-center p-4">
                <div class="bg-white rounded-lg shadow-2xl max-w-md w-full">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-900" id="approvalModalTitle">NCR Approval</h3>
                    </div>
                    <div class="p-6">
                        <form id="approvalForm">
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                                <input type="text" id="approvalUsername"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yanmar-red"
                                    required>
                            </div>
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                                <input type="password" id="approvalPassword"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yanmar-red"
                                    required>
                            </div>
                            <div class="mb-6">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Comments (Optional)</label>
                                <textarea id="approvalComments" rows="3"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yanmar-red"
                                    placeholder="Add approval comments..."></textarea>
                            </div>
                            <div class="flex justify-end space-x-3">
                                <button type="button" onclick="closeApprovalModal()"
                                    class="px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg">Cancel</button>
                                <button type="submit"
                                    class="px-4 py-2 bg-yanmar-red hover:bg-red-700 text-white rounded-lg">Approve &
                                    Sign</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <script>
                // Get NCR ID from URL parameter
                function getNCRIdFromURL() {
                    const urlParams = new URLSearchParams(window.location.search);
                    const id = urlParams.get('id');
                    return id ? parseInt(id) : 1; // Default to 1 if no ID provided
                }

                // Initialize page with NCR data
                function initializePage() {
                    const ncrId = getNCRIdFromURL();

                    // Update page elements with NCR ID
                    document.getElementById('ncrIdDisplay').textContent = `#NCR-${ncrId.toString().padStart(3, '0')}`;
                    document.getElementById('breadcrumbNCR').textContent = `NCR #${ncrId.toString().padStart(3, '0')} Inspection`;
                    document.getElementById('pageTitle').textContent = `NCR #${ncrId.toString().padStart(3, '0')} Inspection`;
                    document.getElementById('pageSubtitle').textContent = `Review and process Non-Conformance Report #${ncrId.toString().padStart(3, '0')}`;

                    // You could fetch actual NCR data here based on the ID
                    // loadNCRData(ncrId);
                }

                // Initialize page when DOM is loaded
                document.addEventListener('DOMContentLoaded', initializePage);

                // Media Modal Functions
                function openImageModal(imageSrc, fileName) {
                    const modal = document.getElementById('mediaModal');
                    const content = document.getElementById('mediaContent');

                    content.innerHTML = `
                        <div class="p-6">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900">Attachment Preview</h3>
                                    <p class="text-sm text-gray-500">${fileName}</p>
                                </div>
                                <button onclick="downloadAttachment('${imageSrc}', '${fileName}')" class="text-yanmar-red hover:text-yanmar-dark">
                                    <i class="fas fa-download"></i> Download
                                </button>
                            </div>
                            <div class="bg-gray-50 rounded-lg p-4 flex justify-center">
                                <img src="${imageSrc}" alt="${fileName}" class="max-w-full max-h-96 object-contain rounded-lg shadow-sm">
                            </div>
                        </div>
                    `;

                    modal.classList.remove('hidden');
                }

                function openVideoModal(videoSrc) {
                    const modal = document.getElementById('mediaModal');
                    const content = document.getElementById('mediaContent');

                    content.innerHTML = `
                        <div class="p-6">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900">Video Attachment</h3>
                                    <p class="text-sm text-gray-500">${videoSrc}</p>
                                </div>
                            </div>
                            <div class="bg-gray-50 rounded-lg p-4 flex justify-center">
                                <div class="text-center text-gray-500">
                                    <i class="fas fa-play-circle text-6xl mb-4"></i>
                                    <p>Video playback simulation</p>
                                    <p class="text-sm">In production, this would show the actual video player</p>
                                </div>
                            </div>
                        </div>
                    `;

                    modal.classList.remove('hidden');
                }

                function downloadAttachment(src, fileName) {
                    // Simulate download
                    alert(`Downloading ${fileName}...`);
                }

                function openDocumentModal(documentSrc) {
                    const modal = document.getElementById('mediaModal');
                    const content = document.getElementById('mediaContent');

                    const docTypes = {
                        'quality_report.pdf': {
                            title: 'Quality Control Report',
                            icon: 'fas fa-file-pdf text-red-600',
                            size: '2.4 MB',
                            description: 'Detailed inspection measurements and specifications'
                        },
                        'process_specification.xlsx': {
                            title: 'Process Specification Sheet',
                            icon: 'fas fa-file-excel text-green-600',
                            size: '1.1 MB',
                            description: 'Manufacturing process parameters and tolerances'
                        },
                        'supplier_certificate.pdf': {
                            title: 'Material Certificate',
                            icon: 'fas fa-certificate text-blue-600',
                            size: '890 KB',
                            description: 'Raw material certification and test results'
                        }
                    };

                    const doc = docTypes[documentSrc] || {
                        title: 'Document',
                        icon: 'fas fa-file text-gray-600',
                        size: 'Unknown',
                        description: 'Supporting document'
                    };

                    content.innerHTML = `
                        <div class="p-6">
                            <div class="flex items-center justify-between mb-6">
                                <div class="flex items-center space-x-3">
                                    <div class="w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center">
                                        <i class="${doc.icon} text-2xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-semibold text-gray-900">${doc.title}</h3>
                                        <p class="text-sm text-gray-500">${documentSrc} • ${doc.size}</p>
                                    </div>
                                </div>
                                <div class="flex space-x-2">
                                    <button onclick="downloadAttachment('${documentSrc}', '${documentSrc}')" class="inline-flex items-center px-3 py-2 text-sm bg-yanmar-red text-white rounded-md hover:bg-yanmar-dark">
                                        <i class="fas fa-download mr-2"></i>Download
                                    </button>
                                </div>
                            </div>
                            <div class="bg-gray-50 rounded-lg p-6 text-center">
                                <i class="${doc.icon} text-6xl mb-4"></i>
                                <p class="text-gray-600 mb-2">${doc.description}</p>
                                <p class="text-sm text-gray-500">Document preview not available - Click download to view full document</p>
                            </div>
                        </div>
                    `;

                    modal.classList.remove('hidden');
                }

                // Close modal
                document.getElementById('closeMediaModal').addEventListener('click', function () {
                    document.getElementById('mediaModal').classList.add('hidden');
                });

                // Close modal when clicking outside
                document.getElementById('mediaModal').addEventListener('click', function (e) {
                    if (e.target === this) {
                        this.classList.add('hidden');
                    }
                });

                // Sample supplier database
                const suppliers = [
                    { id: 1, name: "ABC Manufacturing Co.", contact: "John Smith", email: "john@abc-mfg.com", phone: "+1-555-0101" },
                    { id: 2, name: "XYZ Components Ltd.", contact: "Sarah Johnson", email: "sarah@xyz-components.com", phone: "+1-555-0102" },
                    { id: 3, name: "Global Parts Solutions", contact: "Mike Chen", email: "mike@globalparts.com", phone: "+1-555-0103" },
                    { id: 4, name: "Premium Steel Works", contact: "Anna Rodriguez", email: "anna@premiumsteel.com", phone: "+1-555-0104" },
                    { id: 5, name: "Tech Assembly Inc.", contact: "David Kim", email: "david@techassembly.com", phone: "+1-555-0105" }
                ];

                // Phase 1 Logic
                const ncrValidRadios = document.querySelectorAll('input[name="ncr_valid"]');
                const statusClassification = document.getElementById('statusClassification');
                const rejectionReason = document.getElementById('rejectionReason');
                const proceedBtn = document.getElementById('proceedToPhase2');

                ncrValidRadios.forEach(radio => {
                    radio.addEventListener('change', function () {
                        if (this.value === 'yes') {
                            statusClassification.classList.remove('hidden');
                            rejectionReason.classList.add('hidden');
                        } else {
                            statusClassification.classList.add('hidden');
                            rejectionReason.classList.remove('hidden');
                            proceedBtn.disabled = false;
                        }
                    });
                });

                const statusRadios = document.querySelectorAll('input[name="status_classification"]');
                statusRadios.forEach(radio => {
                    radio.addEventListener('change', function () {
                        proceedBtn.disabled = false;
                    });
                });

                // Enhanced Phase 2 UX
                // Priority selection handler for internal department
                const departmentRadios = document.querySelectorAll('input[name="department"]');
                const forwardToDeptBtn = document.getElementById('forwardToDepartment');
                const actionSummary = document.getElementById('actionSummary');
                const departmentPriorityFilter = document.getElementById('departmentPriorityFilter');

                function updateInternalSummary() {
                    const selectedDept = document.querySelector('input[name="department"]:checked');
                    const selectedPriority = departmentPriorityFilter ? departmentPriorityFilter.value : '';

                    if (selectedDept && selectedPriority) {
                        const deptNames = {
                            'production': 'Production Department',
                            'engineering': 'Engineering Department',
                            'maintenance': 'Maintenance Department',
                            'procurement': 'Procurement Department'
                        };

                        const priorityInfo = {
                            'critical': { name: 'Critical', time: '0-4 hours' },
                            'high': { name: 'High', time: 'Within 24 hours' },
                            'medium': { name: 'Medium', time: 'Within 3 days' },
                            'low': { name: 'Low', time: 'Within 1 week' }
                        };

                        document.getElementById('summaryDepartment').textContent = deptNames[selectedDept.value];
                        document.getElementById('summaryPriority').textContent = priorityInfo[selectedPriority].name;
                        document.getElementById('summaryResponse').textContent = priorityInfo[selectedPriority].time;

                        actionSummary.classList.remove('hidden');
                        forwardToDeptBtn.disabled = false;
                    } else {
                        actionSummary.classList.add('hidden');
                        forwardToDeptBtn.disabled = true;
                    }
                }

                // Add event listener for department priority dropdown
                if (departmentPriorityFilter) {
                    departmentPriorityFilter.addEventListener('change', updateInternalSummary);
                }

                departmentRadios.forEach(radio => {
                    radio.addEventListener('change', updateInternalSummary);
                });

                // Enhanced supplier selection for external
                const forwardToSupplierBtn = document.getElementById('forwardToSupplier');
                const supplierSummary = document.getElementById('supplierSummary');
                const supplierPriorityFilter = document.getElementById('supplierPriorityFilter');

                function updateSupplierSummary() {
                    const selectedPriority = supplierPriorityFilter ? supplierPriorityFilter.value : '';

                    if (selectedSupplier && selectedPriority) {
                        const priorityInfo = {
                            'critical': { name: 'Critical', time: '0-4 hours' },
                            'high': { name: 'High', time: 'Within 24 hours' },
                            'medium': { name: 'Medium', time: 'Within 3 days' },
                            'low': { name: 'Low', time: 'Within 1 week' }
                        };

                        document.getElementById('summarySupplierName').textContent = selectedSupplier.name;
                        document.getElementById('summarySupplierContact').textContent = `${selectedSupplier.contact} (${selectedSupplier.email})`;
                        document.getElementById('summarySupplierPriority').textContent = priorityInfo[selectedPriority].name;
                        document.getElementById('summarySupplierResponse').textContent = priorityInfo[selectedPriority].time;

                        supplierSummary.classList.remove('hidden');
                        forwardToSupplierBtn.disabled = false;
                    } else {
                        supplierSummary.classList.add('hidden');
                        forwardToSupplierBtn.disabled = true;
                    }
                }

                // Add event listener for supplier priority dropdown
                if (supplierPriorityFilter) {
                    supplierPriorityFilter.addEventListener('change', updateSupplierSummary);
                }

                // Phase 2 Logic
                proceedBtn.addEventListener('click', function () {
                    const selectedStatus = document.querySelector('input[name="status_classification"]:checked');
                    const ncrValid = document.querySelector('input[name="ncr_valid"]:checked');

                    document.getElementById('phase1').classList.remove('active');

                    if (ncrValid && ncrValid.value === 'no') {
                        // Handle rejection case
                        alert('NCR has been rejected. Notification sent to submitter.');
                        return;
                    }

                    if (selectedStatus) {
                        if (selectedStatus.value === 'external') {
                            // Show external, hide internal
                            document.getElementById('phase2External').classList.remove('hidden');
                            document.getElementById('phase2Internal').classList.add('hidden');
                            document.getElementById('phase2External').classList.add('active');
                        } else {
                            // Show internal, hide external
                            document.getElementById('phase2Internal').classList.remove('hidden');
                            document.getElementById('phase2External').classList.add('hidden');
                            document.getElementById('phase2Internal').classList.add('active');
                        }
                    }
                });

                // Supplier Search Logic
                const supplierSearch = document.getElementById('supplierSearch');
                const supplierDropdown = document.getElementById('supplierDropdown');
                const selectedSupplierDiv = document.getElementById('selectedSupplier');
                let selectedSupplier = null;

                supplierSearch.addEventListener('input', function () {
                    const query = this.value.toLowerCase();

                    if (query.length < 2) {
                        supplierDropdown.classList.add('hidden');
                        return;
                    }

                    const filteredSuppliers = suppliers.filter(supplier =>
                        supplier.name.toLowerCase().includes(query) ||
                        supplier.contact.toLowerCase().includes(query)
                    );

                    supplierDropdown.innerHTML = '';

                    if (filteredSuppliers.length > 0) {
                        filteredSuppliers.forEach(supplier => {
                            const div = document.createElement('div');
                            div.className = 'supplier-item p-3 cursor-pointer border-b border-gray-200 last:border-b-0';
                            div.innerHTML = `
                        <div class="font-medium text-gray-900">${supplier.name}</div>
                        <div class="text-sm text-gray-500">${supplier.contact} • ${supplier.email}</div>
                    `;
                            div.addEventListener('click', () => selectSupplier(supplier));
                            supplierDropdown.appendChild(div);
                        });
                        supplierDropdown.classList.remove('hidden');
                    } else {
                        supplierDropdown.classList.add('hidden');
                    }
                });

                function selectSupplier(supplier) {
                    selectedSupplier = supplier;
                    supplierSearch.value = supplier.name;
                    supplierDropdown.classList.add('hidden');

                    document.getElementById('supplierName').textContent = supplier.name;
                    document.getElementById('supplierDetails').textContent = `${supplier.contact} • ${supplier.email} • ${supplier.phone}`;
                    selectedSupplierDiv.classList.remove('hidden');

                    // Update supplier summary
                    updateSupplierSummary();
                }

                document.getElementById('removeSupplier').addEventListener('click', function () {
                    selectedSupplier = null;
                    supplierSearch.value = '';
                    selectedSupplierDiv.classList.add('hidden');
                    if (supplierPriorityFilter) supplierPriorityFilter.value = '';
                    updateSupplierSummary();
                });

                // Add New Supplier Modal
                const supplierModal = document.getElementById('supplierModal');
                document.getElementById('addNewSupplier').addEventListener('click', function () {
                    supplierModal.classList.remove('hidden');
                    supplierModal.classList.add('flex');
                });

                document.getElementById('cancelSupplier').addEventListener('click', function () {
                    supplierModal.classList.add('hidden');
                    supplierModal.classList.remove('flex');
                });

                document.getElementById('saveSupplier').addEventListener('click', function () {
                    // Here you would typically save to database
                    alert('New supplier added successfully!');
                    supplierModal.classList.add('hidden');
                    supplierModal.classList.remove('flex');
                });

                // Voice note player simulation
                document.getElementById('playVoiceNote').addEventListener('click', function () {
                    const icon = this.querySelector('i');
                    const progressBar = this.parentElement.querySelector('.bg-yanmar-red');

                    if (icon.classList.contains('fa-play')) {
                        icon.classList.remove('fa-play');
                        icon.classList.add('fa-pause');

                        // Simulate playing
                        let progress = 0;
                        const interval = setInterval(() => {
                            progress += 2;
                            progressBar.style.width = progress + '%';

                            if (progress >= 100) {
                                clearInterval(interval);
                                icon.classList.remove('fa-pause');
                                icon.classList.add('fa-play');
                                progressBar.style.width = '0%';
                            }
                        }, 100);
                    }
                });

                // Hide dropdown when clicking outside
                document.addEventListener('click', function (e) {
                    if (!supplierSearch.contains(e.target) && !supplierDropdown.contains(e.target)) {
                        supplierDropdown.classList.add('hidden');
                    }
                });

                // Toggle verification status
                function toggleVerification(button) {
                    const isVerified = button.getAttribute('data-verified') === 'true';
                    const icon = button.querySelector('i');

                    if (isVerified) {
                        // Change to unverified state (gray with clock icon)
                        button.setAttribute('data-verified', 'false');
                        button.className = 'w-6 h-6 bg-gray-300 text-white rounded-full flex items-center justify-center hover:bg-gray-400 cursor-pointer verification-btn';
                        icon.className = 'fas fa-clock text-xs';
                    } else {
                        // Change to verified state (green with check icon)
                        button.setAttribute('data-verified', 'true');
                        button.className = 'w-6 h-6 bg-green-500 text-white rounded-full flex items-center justify-center hover:bg-green-600 cursor-pointer verification-btn';
                        icon.className = 'fas fa-check text-xs';
                    }
                }

                // Approval System Variables
                let currentApprovalType = '';
                const approvalUsers = {
                    'yadin_approve': { role: 'QC Manager', department: 'YADIN-QC DEPT' },
                    'yadin_check': { role: 'QC Supervisor', department: 'YADIN-QC DEPT' },
                    'yanmar_approve': { role: 'Production Manager', department: 'YANMAR POWER TECHNOLOGY' },
                    'yanmar_check': { role: 'Quality Director', department: 'YANMAR POWER TECHNOLOGY' },
                    'yanmar_create': { role: 'Document Controller', department: 'YANMAR POWER TECHNOLOGY' }
                };

                // Dummy user credentials (in production, this would be server-side)
                const userCredentials = {
                    'qc.manager': { password: 'qc123', name: 'Sato Tanaka', role: 'QC Manager' },
                    'qc.supervisor': { password: 'qc456', name: 'Hiroshi Yamada', role: 'QC Supervisor' },
                    'prod.manager': { password: 'pm789', name: 'Kenji Matsui', role: 'Production Manager' },
                    'quality.dir': { password: 'qd101', name: 'Akira Suzuki', role: 'Quality Director' },
                    'doc.controller': { password: 'dc202', name: 'Yuki Tanaka', role: 'Document Controller' }
                };

                // Simple approval without login (demo version)
                function openApprovalModal(approvalType) {
                    // Get dummy data for demo - Indonesian names
                    const demoUsers = {
                        'yadin_approve': { name: 'Budi Santoso', dept: 'QC Manager' },
                        'yadin_check': { name: 'Andi Prasetyo', dept: 'QC Supervisor' },
                        'yanmar_approve': { name: 'Sari Wijaya', dept: 'Production Manager' },
                        'yanmar_check': { name: 'Doni Kurniawan', dept: 'Quality Director' },
                        'yanmar_create': { name: 'Maya Sari', dept: 'Document Controller' }
                    };

                    const userInfo = demoUsers[approvalType];
                    createDigitalSignature(approvalType, userInfo.name, userInfo.dept);
                }

                // Close approval modal
                function closeApprovalModal() {
                    document.getElementById('approvalModal').classList.add('hidden');
                    currentApprovalType = '';
                }

                // Handle approval form submission
                document.getElementById('approvalForm').addEventListener('submit', function (e) {
                    e.preventDefault();

                    const username = document.getElementById('approvalUsername').value;
                    const password = document.getElementById('approvalPassword').value;
                    const comments = document.getElementById('approvalComments').value;

                    // Validate credentials
                    if (userCredentials[username] && userCredentials[username].password === password) {
                        const user = userCredentials[username];
                        const approvalData = approvalUsers[currentApprovalType];

                        // Check if user role matches required role
                        if (user.role === approvalData.role) {
                            // Generate digital signature
                            createDigitalSignature(currentApprovalType, user.name, user.role, comments);
                            closeApprovalModal();
                        } else {
                            alert(`Access denied. This approval requires ${approvalData.role} role.`);
                        }
                    } else {
                        alert('Invalid username or password.');
                    }
                });

                // Create digital signature
                function createDigitalSignature(approvalType, userName, department) {
                    const now = new Date();
                    const dateOnly = now.toLocaleDateString('id-ID', {
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric'
                    });

                    // Find the approval box element
                    const approvalButton = document.querySelector(`button[onclick="openApprovalModal('${approvalType}')"]`);
                    const approvalBox = approvalButton.parentElement;

                    // Change background to green and replace content with bigger box size
                    approvalBox.className = 'border border-green-300 rounded-lg w-36 h-24 flex flex-col items-center justify-center bg-green-100';
                    approvalBox.innerHTML = `
                        <div class="text-center text-xs">
                            <div class="font-medium text-gray-900 mb-1">${userName}</div>
                            <div class="text-gray-600 mb-1">${department}</div>
                            <div class="text-gray-500">${dateOnly}</div>
                        </div>
                    `;
                }

                // Print to PDF function
                function printToPDF() {
                    // Hide export buttons during print
                    const exportSection = document.querySelector('.bg-white.rounded-lg.shadow.mb-8:last-of-type');
                    exportSection.style.display = 'none';

                    // Trigger browser print dialog
                    window.print();

                    // Show export buttons after print
                    setTimeout(() => {
                        exportSection.style.display = 'block';
                    }, 1000);
                }

                // Export to XLS function
                function exportToXLS() {
                    // Get NCR data for export
                    const ncrId = getNCRIdFromURL();
                    const currentDate = new Date().toLocaleDateString('id-ID');

                    // Simulate XLS export
                    alert(`Exporting NCR #${ncrId.toString().padStart(3, '0')} to Excel...\\n\\nFile will be downloaded as: NCR-${ncrId.toString().padStart(3, '0')}-${currentDate}.xlsx`);

                    // In production, this would generate actual Excel file
                    console.log('XLS Export triggered for NCR:', ncrId);
                }
            </script>
        </div>

    </main>

</body>

</html>