<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yanmar QC Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'yanmar-red': '#DC2626',
                        'yanmar-light': '#FEF2F2',
                        'yanmar-dark': '#991B1B'
                    },
                    animation: {
                        'slide-in': 'slide-in 0.3s ease-out',
                        'slide-out': 'slide-out 0.3s ease-in',
                        'fade-in': 'fade-in 0.2s ease-out'
                    },
                    keyframes: {
                        'slide-in': {
                            '0%': { transform: 'translateX(-100%)' },
                            '100%': { transform: 'translateX(0)' }
                        },
                        'slide-out': {
                            '0%': { transform: 'translateX(0)' },
                            '100%': { transform: 'translateX(-100%)' }
                        },
                        'fade-in': {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        }
                    }
                }
            }
        }
    </script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .sidebar-collapsed {
            width: 4rem;
        }

        .sidebar-expanded {
            width: 16rem;
        }

        .sidebar-transition {
            transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .menu-item-hover:hover {
            background: linear-gradient(90deg, rgba(220, 38, 38, 0.1), transparent);
            border-right: 3px solid #DC2626;
        }

        .tooltip {
            transform: translateX(0.5rem);
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .show-tooltip .tooltip {
            transform: translateX(1rem);
            opacity: 1;
            visibility: visible;
        }

        .menu-text {
            opacity: 0;
            transform: translateX(-10px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .sidebar-expanded .menu-text {
            opacity: 1;
            transform: translateX(0);
        }

        .menu-icon {
            min-width: 1.25rem;
            text-align: center;
        }

        /* Improved icon alignment for collapsed sidebar */
        .sidebar-collapsed nav a {
            justify-content: center;
            /* center icon horizontally */
            padding-left: 0.5rem;
            /* reduce left padding when collapsed */
            padding-right: 0.5rem;
        }

        .sidebar-collapsed .menu-icon {
            margin-right: 0;
            /* remove right margin */
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            font-size: 1.15rem;
            /* slightly larger icon for visibility */
        }

        /* hide the text when collapsed (keeps space clean) */
        .sidebar-collapsed .menu-text {
            display: none !important;
        }

        /* position tooltips just outside the slim sidebar */
        .sidebar-collapsed .tooltip {
            left: 4rem;
            /* hover tooltip appears aligned to collapsed width */
        }

        /* Restore left-aligned layout when expanded */
        .sidebar-expanded nav a {
            justify-content: flex-start;
            /* icon + text aligned to left */
            padding-left: 0.75rem;
        }

        .sidebar-expanded .menu-icon {
            width: auto;
            margin-right: 0.75rem;
            font-size: 1rem;
        }

        .sidebar-expanded .menu-text {
            display: inline-block !important;
            opacity: 1;
            transform: translateX(0);
        }

        /* Attachment preview styling */
        .attachment-preview {
            transition: transform 0.2s ease;
        }

        .attachment-preview:hover {
            transform: scale(1.02);
        }

        /* Priority option styling */
        .priority-option {
            transition: all 0.2s ease;
        }

        .priority-option:hover {
            background-color: #f9fafb;
            border-color: #DC2626;
        }

        .priority-option.selected {
            background-color: #fef2f2;
            border-color: #DC2626;
        }

        /* Phase card animations */
        .phase-card {
            transition: all 0.3s ease;
        }

        .phase-card.active {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            border-color: #DC2626;
        }

        /* Modal animations */
        #mediaModal {
            backdrop-filter: blur(4px);
        }

        /* Smooth transitions for all interactive elements */
        button,
        input,
        select,
        .cursor-pointer {
            transition: all 0.2s ease;
        }

        /* Summary boxes styling */
        #actionSummary,
        #supplierSummary {
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Hover effects for form sections */
        .border:hover {
            border-color: #D1D5DB;
        }

        /* Enhanced focus styles */
        input:focus,
        select:focus,
        textarea:focus {
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
        }
    </style>
    <script src="components/header.js"></script>
    <script src="components/sidebar.js"></script>
</head>

<body class="bg-gray-50 font-sans">

    <!-- Main Content -->
    <main id="mainContent" class="ml-16 pt-16 transition-all duration-100">
        <div class="p-6">
            <!-- Breadcrumb Navigation -->
            <nav class="flex mb-6" aria-label="Breadcrumb">
                <ol class="inline-flex items-center space-x-1 md:space-x-3">
                    <li class="inline-flex items-center">
                        <a href="dashboard.html"
                            class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-yanmar-red">
                            <i class="fas fa-home w-4 h-4 mr-2"></i>
                            Dashboard
                        </a>
                    </li>
                    <li>
                        <div class="flex items-center">
                            <i class="fas fa-chevron-right text-gray-400 text-xs"></i>
                            <a href="report.html"
                                class="ml-1 text-sm font-medium text-gray-700 hover:text-yanmar-red md:ml-2">NCR
                                Reports</a>
                        </div>
                    </li>
                    <li aria-current="page">
                        <div class="flex items-center">
                            <i class="fas fa-chevron-right text-gray-400 text-xs"></i>
                            <span class="ml-1 text-sm font-medium text-gray-500 md:ml-2" id="breadcrumbNCR">NCR
                                Inspection</span>
                        </div>
                    </li>
                </ol>
            </nav>

            <!-- Page Header -->
            <div class="mb-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800" id="pageTitle">NCR Inspection</h2>
                        <p class="text-gray-600 mt-1" id="pageSubtitle">Review and process Non-Conformance Report</p>
                    </div>
                    <div class="flex items-center space-x-3">
                        <div class="bg-white px-4 py-2 rounded-lg shadow-sm border">
                            <span class="text-sm text-gray-500">NCR ID:</span>
                            <span class="font-semibold text-blue-600 ml-2" id="ncrIdDisplay">#NCR-001</span>
                        </div>
                        <div class="bg-white px-4 py-2 rounded-lg shadow-sm border">
                            <span class="text-sm text-gray-500">Status:</span>
                            <span class="font-semibold text-yellow-600 ml-2" id="ncrStatusDisplay">Under Review</span>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Original Submission Data -->
            <div class="bg-white rounded-lg shadow mb-8">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h2 class="text-lg font-medium text-gray-900">
                        <span
                            class="bg-yanmar-red text-white rounded-full w-6 h-6 inline-flex items-center justify-center text-sm mr-2">1</span>
                        Surface defect detected on cylinder head - Visible crack approximately 2mm in length
                    </h2>
                </div>
                <div class="p-6">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Left Column - Basic Information -->
                        <div class="space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Reporter</label>
                                    <p class="mt-1 text-sm text-gray-900">John Smith</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Department</label>
                                    <p class="mt-1 text-sm text-gray-900">Quality Control</p>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Date Submitted</label>
                                    <p class="mt-1 text-sm text-gray-900">January 15, 2024</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Location</label>
                                    <p class="mt-1 text-sm text-gray-900">Assembly Line A</p>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Part Number</label>
                                    <p class="mt-1 text-sm text-gray-900">YM-ENG-001-2024</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Part Name</label>
                                    <p class="mt-1 text-sm text-gray-900">Engine Block Assembly</p>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Model</label>
                                    <p class="mt-1 text-sm text-gray-900">TNV Series</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Class Part</label>
                                    <p class="mt-1 text-sm text-gray-900">Safety</p>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Defect Qty Found</label>
                                    <p class="mt-1 text-sm text-gray-900">3 units</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Total Defect Ratio</label>
                                    <p class="mt-1 text-sm text-gray-900">0.03% (3/10,000)</p>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Replacement Part</label>
                                    <p class="mt-1 text-sm text-gray-900">
                                        <span
                                            class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                            <i class="fas fa-check mr-1"></i>Yes
                                        </span>
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Right Column - Problem Details -->
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Detail of Problem</label>
                                <div class="mt-1 p-3 bg-red-50 border border-red-200 rounded-lg">
                                    <p class="text-sm text-gray-900">Visible crack approximately 2mm in length found
                                        during routine inspection. The crack appears to be surface-level and located on
                                        the cylinder head mounting surface. This defect may compromise the sealing
                                        integrity and could lead to coolant leakage if not addressed immediately.</p>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Process Flow Description</label>
                                <div class="mt-1 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                                    <p class="text-sm text-blue-900">1. Immediate containment: Quarantine affected batch
                                    </p>
                                    <p class="text-sm text-blue-900">2. Root cause analysis: Investigate machining
                                        process parameters</p>
                                    <p class="text-sm text-blue-900">3. Corrective action: Adjust cutting tool
                                        specifications and inspection frequency</p>
                                    <p class="text-sm text-blue-900">4. Verification: Implement additional quality
                                        checkpoints</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Photos and Evidence -->
            <div class="bg-white rounded-lg shadow mb-8">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h2 class="text-lg font-medium text-gray-900">
                        <span
                            class="bg-yanmar-red text-white rounded-full w-6 h-6 inline-flex items-center justify-center text-sm mr-2">2</span>
                        Photos and Evidence
                    </h2>
                </div>
                <div class="p-6">
                    <div class="space-y-6">
                        <!-- Photo Evidence -->
                        <div>
                            <div class="space-y-4">
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <div class="border border-gray-200 rounded-lg p-2 hover:border-yanmar-red transition-colors cursor-pointer"
                                        onclick="openImageModal('images/baud.png', 'defect_01.jpg')">
                                        <div class="relative group">
                                            <img src="images/baud.png" alt="Image 1"
                                                class="attachment-preview mx-auto rounded w-full aspect-square object-cover">
                                            <div
                                                class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-200 rounded flex items-center justify-center">
                                                <i
                                                    class="fas fa-expand text-white opacity-0 group-hover:opacity-100 transition-opacity text-xl"></i>
                                            </div>
                                            <div class="absolute top-1 right-1 bg-white bg-opacity-90 rounded-full p-1">
                                                <i class="fas fa-camera text-gray-600 text-xs"></i>
                                            </div>
                                        </div>
                                        <div class="mt-2">
                                            <p class="text-xs font-medium text-gray-900 truncate">defect_01.jpg</p>
                                            <p class="text-xs text-gray-500">2.1 MB</p>
                                        </div>
                                    </div>
                                    <div class="border border-gray-200 rounded-lg p-2 hover:border-yanmar-red transition-colors cursor-pointer"
                                        onclick="openImageModal('images/baud-2.png', 'defect_02.jpg')">
                                        <div class="relative group">
                                            <img src="images/baud-2.png" alt="Image 2"
                                                class="attachment-preview mx-auto rounded w-full aspect-square object-cover">
                                            <div
                                                class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-200 rounded flex items-center justify-center">
                                                <i
                                                    class="fas fa-expand text-white opacity-0 group-hover:opacity-100 transition-opacity text-xl"></i>
                                            </div>
                                            <div class="absolute top-1 right-1 bg-white bg-opacity-90 rounded-full p-1">
                                                <i class="fas fa-camera text-gray-600 text-xs"></i>
                                            </div>
                                        </div>
                                        <div class="mt-2">
                                            <p class="text-xs font-medium text-gray-900 truncate">defect_02.jpg</p>
                                            <p class="text-xs text-gray-500">1.8 MB</p>
                                        </div>
                                    </div>
                                    <div class="border border-gray-200 rounded-lg p-2 hover:border-yanmar-red transition-colors cursor-pointer"
                                        onclick="openVideoModal('inspection.mp4')">
                                        <div class="relative group">
                                            <div
                                                class="attachment-preview mx-auto bg-gray-100 rounded flex items-center justify-center w-full aspect-square">
                                                <i
                                                    class="fas fa-play text-gray-500 text-2xl group-hover:text-yanmar-red transition-colors"></i>
                                            </div>
                                            <div
                                                class="absolute top-1 right-1 bg-black bg-opacity-75 text-white text-xs px-1 py-0.5 rounded">
                                                <i class="fas fa-video mr-1"></i>MP4
                                            </div>
                                            <div
                                                class="absolute bottom-1 left-1 bg-black bg-opacity-75 text-white text-xs px-1 py-0.5 rounded">
                                                2:45
                                            </div>
                                        </div>
                                        <div class="mt-2">
                                            <p class="text-xs font-medium text-gray-900 truncate">inspection.mp4</p>
                                            <p class="text-xs text-gray-500">15.2 MB</p>
                                        </div>
                                    </div>
                                    <div
                                        class="border border-gray-200 rounded-lg p-2 border-dashed border-gray-300 flex items-center justify-center cursor-pointer hover:border-yanmar-red transition-colors">
                                        <div class="text-center">
                                            <i class="fas fa-plus text-gray-400 text-xl mb-2"></i>
                                            <p class="text-xs text-gray-500">Add more</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Voice Note -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-3">Voice Note</label>
                        </div>
                        <div class="border border-gray-200 rounded-lg p-3">
                            <div class="flex items-center space-x-2">
                                <i class="fas fa-microphone text-gray-400"></i>
                                <div class="flex-1">
                                    <div class="flex items-center space-x-2">
                                        <button id="playVoiceNote" class="text-yanmar-red hover:text-yanmar-dark">
                                            <i class="fas fa-play"></i>
                                        </button>
                                        <div class="flex-1 bg-gray-200 rounded-full h-2">
                                            <div class="bg-yanmar-red h-2 rounded-full" style="width: 0%">
                                            </div>
                                        </div>
                                        <span class="text-xs text-gray-500">0:00 / 0:45</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Supporting Documents -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-3">Supporting Documents</label>
                            <div class="space-y-3">
                                <div class="border border-gray-200 rounded-lg p-4 hover:border-yanmar-red transition-colors cursor-pointer"
                                    onclick="openDocumentModal('quality_report.pdf')">
                                    <div class="flex items-center space-x-3">
                                        <div class="flex-shrink-0">
                                            <div
                                                class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center">
                                                <i class="fas fa-file-pdf text-red-600 text-xl"></i>
                                            </div>
                                        </div>
                                        <div class="flex-1">
                                            <p class="text-sm font-medium text-gray-900">Quality Control Report</p>
                                            <p class="text-xs text-gray-500">quality_report.pdf • 2.4 MB • Uploaded: Jan
                                                15, 2024</p>
                                            <p class="text-xs text-gray-600 mt-1">Detailed inspection measurements and
                                                specifications</p>
                                        </div>
                                        <div class="flex-shrink-0">
                                            <i class="fas fa-download text-gray-400 hover:text-yanmar-red"></i>
                                        </div>
                                    </div>
                                </div>

                                <div class="border border-gray-200 rounded-lg p-4 hover:border-yanmar-red transition-colors cursor-pointer"
                                    onclick="openDocumentModal('process_specification.xlsx')">
                                    <div class="flex items-center space-x-3">
                                        <div class="flex-shrink-0">
                                            <div
                                                class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                                                <i class="fas fa-file-excel text-green-600 text-xl"></i>
                                            </div>
                                        </div>
                                        <div class="flex-1">
                                            <p class="text-sm font-medium text-gray-900">Process Specification Sheet</p>
                                            <p class="text-xs text-gray-500">process_specification.xlsx • 1.1 MB •
                                                Uploaded: Jan 15, 2024</p>
                                            <p class="text-xs text-gray-600 mt-1">Manufacturing process parameters and
                                                tolerances</p>
                                        </div>
                                        <div class="flex-shrink-0">
                                            <i class="fas fa-download text-gray-400 hover:text-yanmar-red"></i>
                                        </div>
                                    </div>
                                </div>

                                <div class="border border-gray-200 rounded-lg p-4 hover:border-yanmar-red transition-colors cursor-pointer"
                                    onclick="openDocumentModal('supplier_certificate.pdf')">
                                    <div class="flex items-center space-x-3">
                                        <div class="flex-shrink-0">
                                            <div
                                                class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                                <i class="fas fa-certificate text-blue-600 text-xl"></i>
                                            </div>
                                        </div>
                                        <div class="flex-1">
                                            <p class="text-sm font-medium text-gray-900">Material Certificate</p>
                                            <p class="text-xs text-gray-500">supplier_certificate.pdf • 890 KB •
                                                Uploaded: Jan 15, 2024</p>
                                            <p class="text-xs text-gray-600 mt-1">Raw material certification and test
                                                results</p>
                                        </div>
                                        <div class="flex-shrink-0">
                                            <i class="fas fa-download text-gray-400 hover:text-yanmar-red"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Phase 3: NCR Validation & Classification -->
            <div id="phase1" class="bg-white rounded-lg shadow-sm border border-gray-200 mb-8">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h2 class="text-lg font-medium text-gray-900">
                        <span
                            class="bg-yanmar-red text-white rounded-full w-6 h-6 inline-flex items-center justify-center text-sm mr-2">3</span>
                        NCR Validation & Classification
                    </h2>
                </div>
                <div class="p-6">
                    <div class="space-y-6">
                        <!-- NCR Validation -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-3">Is this a valid NCR?</label>
                            <div class="flex space-x-4">
                                <label class="flex items-center">
                                    <input type="radio" name="ncr_valid" value="yes"
                                        class="text-yanmar-red focus:ring-yanmar-red">
                                    <span class="ml-2 text-sm text-gray-700">Yes</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="ncr_valid" value="no"
                                        class="text-yanmar-red focus:ring-yanmar-red">
                                    <span class="ml-2 text-sm text-gray-700">No</span>
                                </label>
                            </div>
                        </div>

                        <!-- Status Classification -->
                        <div id="statusClassification" class="hidden">
                            <label class="block text-sm font-medium text-gray-700 mb-3">Status
                                Classification</label>
                            <div class="space-y-3">
                                <label
                                    class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                                    <input type="radio" name="status_classification" value="external"
                                        class="text-yanmar-red focus:ring-yanmar-red">
                                    <div class="ml-3">
                                        <div class="text-sm font-medium text-gray-900">QC Parts</div>
                                        <div class="text-sm text-gray-500">Sort / Rework stock at Supplier</div>
                                    </div>
                                </label>
                                <label
                                    class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                                    <input type="radio" name="status_classification" value="internal"
                                        class="text-yanmar-red focus:ring-yanmar-red">
                                    <div class="ml-3">
                                        <div class="text-sm font-medium text-gray-900">QC Product</div>
                                        <div class="text-sm text-gray-500">Sort / Rework stock at Yadin
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Rejection Reason (if NCR is invalid) -->
                        <div id="rejectionReason" class="hidden">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Rejection Reason</label>
                            <textarea
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yanmar-red focus:border-yanmar-red"
                                rows="3" placeholder="Please provide reason for NCR rejection..."></textarea>
                        </div>

                        <div class="flex justify-end">
                            <button id="proceedToPhase2"
                                class="px-6 py-2 bg-yanmar-red text-white rounded-md hover:bg-yanmar-dark focus:outline-none focus:ring-2 focus:ring-yanmar-red disabled:opacity-50 disabled:cursor-not-allowed"
                                disabled>
                                Proceed to Phase 2
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Phase 4: External Supplier Assignment -->
            <div id="phase2External" class="bg-white rounded-lg shadow-sm border border-gray-200 mb-8 hidden">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h2 class="text-lg font-medium text-gray-900">
                        <span
                            class="bg-yanmar-red text-white rounded-full w-6 h-6 inline-flex items-center justify-center text-sm mr-2">4</span>
                        External Supplier Assignment
                    </h2>
                </div>
                <div class="p-6">
                    <div class="space-y-6">
                        <!-- Supplier Search -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Search Supplier</label>
                            <div class="relative">
                                <input type="text" id="supplierSearch"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yanmar-red focus:border-yanmar-red"
                                    placeholder="Type supplier name or ID...">
                                <div id="supplierDropdown"
                                    class="absolute z-10 w-full bg-white border border-gray-300 rounded-md shadow-lg mt-1 hidden max-h-60 overflow-auto">
                                    <!-- Supplier results will be populated here -->
                                </div>
                            </div>
                        </div>

                        <!-- Selected Supplier -->
                        <div id="selectedSupplier" class="hidden">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Selected Supplier</label>
                            <div class="bg-gray-50 border border-gray-200 rounded-md p-4">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <h4 class="font-medium text-gray-900" id="supplierName"></h4>
                                        <p class="text-sm text-gray-500" id="supplierDetails"></p>
                                    </div>
                                    <button id="removeSupplier" class="text-red-600 hover:text-red-800">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Add New Supplier -->
                        <div class="border-t pt-6">
                            <button id="addNewSupplier"
                                class="text-yanmar-red hover:text-yanmar-dark text-sm font-medium">
                                <i class="fas fa-plus mr-1"></i> Add New Supplier to Database
                            </button>
                        </div>

                        <!-- Priority Level -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Priority Level</label>
                            <div class="relative">
                                <select id="supplierPriorityFilter"
                                    class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-yanmar-red focus:border-transparent bg-white appearance-none cursor-pointer">
                                    <option value="">Select Priority Level</option>
                                    <option value="critical">Critical - Immediate action required (0-4 hours)</option>
                                    <option value="high">High - Urgent attention needed (Within 24 hours)</option>
                                    <option value="medium">Medium - Standard processing time (Within 3 days)</option>
                                    <option value="low">Low - Non-critical issue (Within 1 week)</option>
                                </select>
                                <div class="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none">
                                    <i class="fas fa-chevron-down text-gray-400 text-xs"></i>
                                </div>
                            </div>
                        </div>

                        <!-- Temporary Action -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Temporary Action</label>
                            <textarea
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yanmar-red focus:border-yanmar-red"
                                rows="3"
                                placeholder="Immediate containment actions or temporary measures..."></textarea>
                        </div>

                        <!-- Message/Remarks -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Message to Supplier</label>
                            <textarea
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yanmar-red focus:border-yanmar-red"
                                rows="4"
                                placeholder="Additional message or instructions for the supplier..."></textarea>
                        </div>

                        <!-- Supplier Summary -->
                        <div id="supplierSummary" class="bg-green-50 border border-green-200 rounded-lg p-4 hidden">
                            <h4 class="text-sm font-medium text-green-900 mb-2">Supplier Assignment Summary</h4>
                            <div class="text-sm text-green-800 space-y-1">
                                <div>Supplier: <span id="summarySupplierName" class="font-medium"></span></div>
                                <div>Contact: <span id="summarySupplierContact" class="font-medium"></span></div>
                                <div>Priority: <span id="summarySupplierPriority" class="font-medium"></span></div>
                                <div>Expected Response: <span id="summarySupplierResponse" class="font-medium"></span>
                                </div>
                                <div>Expected Action: Quality review and corrective action plan</div>
                            </div>
                        </div>

                        <div class="flex justify-end space-x-3">
                            <button id="saveDraftExternal"
                                class="px-6 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50">
                                <i class="fas fa-save mr-2"></i>Save Draft
                            </button>
                            <button id="forwardToSupplier"
                                class="px-6 py-2 bg-yanmar-red text-white rounded-md hover:bg-yanmar-dark disabled:opacity-50"
                                disabled>
                                <i class="fas fa-paper-plane mr-2"></i>Forward to Supplier
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Phase 4: Internal Department Assignment -->
            <div id="phase2Internal" class="bg-white rounded-lg shadow-sm border border-gray-200 mb-8 hidden">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h2 class="text-lg font-medium text-gray-900">
                        <span
                            class="bg-yanmar-red text-white rounded-full w-6 h-6 inline-flex items-center justify-center text-sm mr-2">4</span>
                        Internal Department Assignment
                    </h2>
                </div>
                <div class="p-6">
                    <div class="space-y-6">
                        <!-- Department Selection -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-3">Select Department</label>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                <label
                                    class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                                    <input type="radio" name="department" value="production"
                                        class="text-yanmar-red focus:ring-yanmar-red">
                                    <div class="ml-3">
                                        <div class="text-sm font-medium text-gray-900">Production Department</div>
                                        <div class="text-xs text-gray-500">Manufacturing & Assembly</div>
                                    </div>
                                </label>
                                <label
                                    class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                                    <input type="radio" name="department" value="engineering"
                                        class="text-yanmar-red focus:ring-yanmar-red">
                                    <div class="ml-3">
                                        <div class="text-sm font-medium text-gray-900">Engineering Department</div>
                                        <div class="text-xs text-gray-500">Design & Development</div>
                                    </div>
                                </label>
                                <label
                                    class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                                    <input type="radio" name="department" value="maintenance"
                                        class="text-yanmar-red focus:ring-yanmar-red">
                                    <div class="ml-3">
                                        <div class="text-sm font-medium text-gray-900">Maintenance Department</div>
                                        <div class="text-xs text-gray-500">Equipment & Facility</div>
                                    </div>
                                </label>
                                <label
                                    class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer">
                                    <input type="radio" name="department" value="procurement"
                                        class="text-yanmar-red focus:ring-yanmar-red">
                                    <div class="ml-3">
                                        <div class="text-sm font-medium text-gray-900">Procurement Department</div>
                                        <div class="text-xs text-gray-500">Purchasing & Supply Chain</div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Priority Level -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Priority Level</label>
                            <div class="relative">
                                <select id="departmentPriorityFilter"
                                    class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-yanmar-red focus:border-transparent bg-white appearance-none cursor-pointer">
                                    <option value="">Select Priority Level</option>
                                    <option value="critical">Critical - Immediate action required (0-4 hours)</option>
                                    <option value="high">High - Urgent attention needed (Within 24 hours)</option>
                                    <option value="medium">Medium - Standard processing time (Within 3 days)</option>
                                    <option value="low">Low - Non-critical issue (Within 1 week)</option>
                                </select>
                                <div class="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none">
                                    <i class="fas fa-chevron-down text-gray-400 text-xs"></i>
                                </div>
                            </div>
                        </div>

                        <!-- Temporary Action-->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Temporary Action</label>
                            <textarea
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yanmar-red focus:border-yanmar-red"
                                rows="4"
                                placeholder="Provide specific instructions or requirements for the assigned department..."></textarea>
                        </div>

                        <!-- Action Summary -->
                        <div id="actionSummary" class="bg-blue-50 border border-blue-200 rounded-lg p-4 hidden">
                            <h4 class="text-sm font-medium text-blue-900 mb-2">Action Summary</h4>
                            <div class="text-sm text-blue-800 space-y-1">
                                <div>Department: <span id="summaryDepartment" class="font-medium"></span></div>
                                <div>Priority: <span id="summaryPriority" class="font-medium"></span></div>
                                <div>Expected Response: <span id="summaryResponse" class="font-medium"></span></div>
                            </div>
                        </div>

                        <div class="flex justify-end space-x-3">
                            <button id="saveDraftInternal"
                                class="px-6 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 disabled:opacity-50">
                                <i class="fas fa-save mr-2"></i>Save Draft
                            </button>
                            <button id="forwardToDepartment"
                                class="px-6 py-2 bg-yanmar-red text-white rounded-md hover:bg-yanmar-dark disabled:opacity-50"
                                disabled>
                                <i class="fas fa-paper-plane mr-2"></i>Forward to Department
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add New Supplier Modal -->
        <div id="supplierModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center z-50">
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">Add New Supplier</h3>
                </div>
                <div class="p-6 space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Supplier Name</label>
                        <input type="text"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yanmar-red">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Contact Person</label>
                        <input type="text"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yanmar-red">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                        <input type="email"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yanmar-red">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Phone</label>
                        <input type="tel"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-yanmar-red">
                    </div>
                </div>
                <div class="px-6 py-4 border-t border-gray-200 flex justify-end space-x-3">
                    <button id="cancelSupplier"
                        class="px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50">
                        Cancel
                    </button>
                    <button id="saveSupplier"
                        class="px-4 py-2 bg-yanmar-red text-white rounded-md hover:bg-yanmar-dark">
                        Add Supplier
                    </button>
                </div>
            </div>
        </div>

        <!-- Image/Video Modal -->
        <div id="mediaModal"
            class="fixed inset-0 bg-black bg-opacity-75 z-50 hidden flex items-center justify-center p-4">
            <div class="relative max-w-4xl max-h-full w-full">
                <!-- Close Button -->
                <button id="closeMediaModal"
                    class="absolute -top-10 right-0 text-white hover:text-yanmar-red text-2xl z-10">
                    <i class="fas fa-times w-8 h-8"></i>
                </button>

                <!-- Modal Content -->
                <div id="mediaContent" class="bg-white rounded-lg overflow-hidden shadow-2xl max-h-full">
                    <!-- Content will be dynamically inserted here -->
                </div>
            </div>
        </div>

        <script>
            // Get NCR ID from URL parameter
            function getNCRIdFromURL() {
                const urlParams = new URLSearchParams(window.location.search);
                const id = urlParams.get('id');
                return id ? parseInt(id) : 1; // Default to 1 if no ID provided
            }

            // Initialize page with NCR data
            function initializePage() {
                const ncrId = getNCRIdFromURL();

                // Update page elements with NCR ID
                document.getElementById('ncrIdDisplay').textContent = `#NCR-${ncrId.toString().padStart(3, '0')}`;
                document.getElementById('breadcrumbNCR').textContent = `NCR #${ncrId.toString().padStart(3, '0')} Inspection`;
                document.getElementById('pageTitle').textContent = `NCR #${ncrId.toString().padStart(3, '0')} Inspection`;
                document.getElementById('pageSubtitle').textContent = `Review and process Non-Conformance Report #${ncrId.toString().padStart(3, '0')}`;

                // You could fetch actual NCR data here based on the ID
                // loadNCRData(ncrId);
            }

            // Initialize page when DOM is loaded
            document.addEventListener('DOMContentLoaded', initializePage);

            // Media Modal Functions
            function openImageModal(imageSrc, fileName) {
                const modal = document.getElementById('mediaModal');
                const content = document.getElementById('mediaContent');

                content.innerHTML = `
                        <div class="p-6">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900">Attachment Preview</h3>
                                    <p class="text-sm text-gray-500">${fileName}</p>
                                </div>
                                <button onclick="downloadAttachment('${imageSrc}', '${fileName}')" class="text-yanmar-red hover:text-yanmar-dark">
                                    <i class="fas fa-download"></i> Download
                                </button>
                            </div>
                            <div class="bg-gray-50 rounded-lg p-4 flex justify-center">
                                <img src="${imageSrc}" alt="${fileName}" class="max-w-full max-h-96 object-contain rounded-lg shadow-sm">
                            </div>
                        </div>
                    `;

                modal.classList.remove('hidden');
            }

            function openVideoModal(videoSrc) {
                const modal = document.getElementById('mediaModal');
                const content = document.getElementById('mediaContent');

                content.innerHTML = `
                        <div class="p-6">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900">Video Attachment</h3>
                                    <p class="text-sm text-gray-500">${videoSrc}</p>
                                </div>
                            </div>
                            <div class="bg-gray-50 rounded-lg p-4 flex justify-center">
                                <div class="text-center text-gray-500">
                                    <i class="fas fa-play-circle text-6xl mb-4"></i>
                                    <p>Video playback simulation</p>
                                    <p class="text-sm">In production, this would show the actual video player</p>
                                </div>
                            </div>
                        </div>
                    `;

                modal.classList.remove('hidden');
            }

            function downloadAttachment(src, fileName) {
                // Simulate download
                alert(`Downloading ${fileName}...`);
            }

            function openDocumentModal(documentSrc) {
                const modal = document.getElementById('mediaModal');
                const content = document.getElementById('mediaContent');

                const docTypes = {
                    'quality_report.pdf': {
                        title: 'Quality Control Report',
                        icon: 'fas fa-file-pdf text-red-600',
                        size: '2.4 MB',
                        description: 'Detailed inspection measurements and specifications'
                    },
                    'process_specification.xlsx': {
                        title: 'Process Specification Sheet',
                        icon: 'fas fa-file-excel text-green-600',
                        size: '1.1 MB',
                        description: 'Manufacturing process parameters and tolerances'
                    },
                    'supplier_certificate.pdf': {
                        title: 'Material Certificate',
                        icon: 'fas fa-certificate text-blue-600',
                        size: '890 KB',
                        description: 'Raw material certification and test results'
                    }
                };

                const doc = docTypes[documentSrc] || {
                    title: 'Document',
                    icon: 'fas fa-file text-gray-600',
                    size: 'Unknown',
                    description: 'Supporting document'
                };

                content.innerHTML = `
                        <div class="p-6">
                            <div class="flex items-center justify-between mb-6">
                                <div class="flex items-center space-x-3">
                                    <div class="w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center">
                                        <i class="${doc.icon} text-2xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-semibold text-gray-900">${doc.title}</h3>
                                        <p class="text-sm text-gray-500">${documentSrc} • ${doc.size}</p>
                                    </div>
                                </div>
                                <div class="flex space-x-2">
                                    <button onclick="downloadAttachment('${documentSrc}', '${documentSrc}')" class="inline-flex items-center px-3 py-2 text-sm bg-yanmar-red text-white rounded-md hover:bg-yanmar-dark">
                                        <i class="fas fa-download mr-2"></i>Download
                                    </button>
                                </div>
                            </div>
                            <div class="bg-gray-50 rounded-lg p-6 text-center">
                                <i class="${doc.icon} text-6xl mb-4"></i>
                                <p class="text-gray-600 mb-2">${doc.description}</p>
                                <p class="text-sm text-gray-500">Document preview not available - Click download to view full document</p>
                            </div>
                        </div>
                    `;

                modal.classList.remove('hidden');
            }

            // Close modal
            document.getElementById('closeMediaModal').addEventListener('click', function () {
                document.getElementById('mediaModal').classList.add('hidden');
            });

            // Close modal when clicking outside
            document.getElementById('mediaModal').addEventListener('click', function (e) {
                if (e.target === this) {
                    this.classList.add('hidden');
                }
            });

            // Sample supplier database
            const suppliers = [
                { id: 1, name: "ABC Manufacturing Co.", contact: "John Smith", email: "john@abc-mfg.com", phone: "+1-555-0101" },
                { id: 2, name: "XYZ Components Ltd.", contact: "Sarah Johnson", email: "sarah@xyz-components.com", phone: "+1-555-0102" },
                { id: 3, name: "Global Parts Solutions", contact: "Mike Chen", email: "mike@globalparts.com", phone: "+1-555-0103" },
                { id: 4, name: "Premium Steel Works", contact: "Anna Rodriguez", email: "anna@premiumsteel.com", phone: "+1-555-0104" },
                { id: 5, name: "Tech Assembly Inc.", contact: "David Kim", email: "david@techassembly.com", phone: "+1-555-0105" }
            ];

            // Phase 1 Logic
            const ncrValidRadios = document.querySelectorAll('input[name="ncr_valid"]');
            const statusClassification = document.getElementById('statusClassification');
            const rejectionReason = document.getElementById('rejectionReason');
            const proceedBtn = document.getElementById('proceedToPhase2');

            ncrValidRadios.forEach(radio => {
                radio.addEventListener('change', function () {
                    if (this.value === 'yes') {
                        statusClassification.classList.remove('hidden');
                        rejectionReason.classList.add('hidden');
                    } else {
                        statusClassification.classList.add('hidden');
                        rejectionReason.classList.remove('hidden');
                        proceedBtn.disabled = false;
                    }
                });
            });

            const statusRadios = document.querySelectorAll('input[name="status_classification"]');
            statusRadios.forEach(radio => {
                radio.addEventListener('change', function () {
                    proceedBtn.disabled = false;
                });
            });

            // Enhanced Phase 2 UX
            // Priority selection handler for internal department
            const departmentRadios = document.querySelectorAll('input[name="department"]');
            const forwardToDeptBtn = document.getElementById('forwardToDepartment');
            const actionSummary = document.getElementById('actionSummary');
            const departmentPriorityFilter = document.getElementById('departmentPriorityFilter');

            function updateInternalSummary() {
                const selectedDept = document.querySelector('input[name="department"]:checked');
                const selectedPriority = departmentPriorityFilter ? departmentPriorityFilter.value : '';

                if (selectedDept && selectedPriority) {
                    const deptNames = {
                        'production': 'Production Department',
                        'engineering': 'Engineering Department',
                        'maintenance': 'Maintenance Department',
                        'procurement': 'Procurement Department'
                    };

                    const priorityInfo = {
                        'critical': { name: 'Critical', time: '0-4 hours' },
                        'high': { name: 'High', time: 'Within 24 hours' },
                        'medium': { name: 'Medium', time: 'Within 3 days' },
                        'low': { name: 'Low', time: 'Within 1 week' }
                    };

                    document.getElementById('summaryDepartment').textContent = deptNames[selectedDept.value];
                    document.getElementById('summaryPriority').textContent = priorityInfo[selectedPriority].name;
                    document.getElementById('summaryResponse').textContent = priorityInfo[selectedPriority].time;

                    actionSummary.classList.remove('hidden');
                    forwardToDeptBtn.disabled = false;
                } else {
                    actionSummary.classList.add('hidden');
                    forwardToDeptBtn.disabled = true;
                }
            }

            // Add event listener for department priority dropdown
            if (departmentPriorityFilter) {
                departmentPriorityFilter.addEventListener('change', updateInternalSummary);
            }

            departmentRadios.forEach(radio => {
                radio.addEventListener('change', updateInternalSummary);
            });

            // Enhanced supplier selection for external
            const forwardToSupplierBtn = document.getElementById('forwardToSupplier');
            const supplierSummary = document.getElementById('supplierSummary');
            const supplierPriorityFilter = document.getElementById('supplierPriorityFilter');

            function updateSupplierSummary() {
                const selectedPriority = supplierPriorityFilter ? supplierPriorityFilter.value : '';

                if (selectedSupplier && selectedPriority) {
                    const priorityInfo = {
                        'critical': { name: 'Critical', time: '0-4 hours' },
                        'high': { name: 'High', time: 'Within 24 hours' },
                        'medium': { name: 'Medium', time: 'Within 3 days' },
                        'low': { name: 'Low', time: 'Within 1 week' }
                    };

                    document.getElementById('summarySupplierName').textContent = selectedSupplier.name;
                    document.getElementById('summarySupplierContact').textContent = `${selectedSupplier.contact} (${selectedSupplier.email})`;
                    document.getElementById('summarySupplierPriority').textContent = priorityInfo[selectedPriority].name;
                    document.getElementById('summarySupplierResponse').textContent = priorityInfo[selectedPriority].time;

                    supplierSummary.classList.remove('hidden');
                    forwardToSupplierBtn.disabled = false;
                } else {
                    supplierSummary.classList.add('hidden');
                    forwardToSupplierBtn.disabled = true;
                }
            }

            // Add event listener for supplier priority dropdown
            if (supplierPriorityFilter) {
                supplierPriorityFilter.addEventListener('change', updateSupplierSummary);
            }

            // Phase 2 Logic
            proceedBtn.addEventListener('click', function () {
                const selectedStatus = document.querySelector('input[name="status_classification"]:checked');
                const ncrValid = document.querySelector('input[name="ncr_valid"]:checked');

                document.getElementById('phase1').classList.remove('active');

                if (ncrValid && ncrValid.value === 'no') {
                    // Handle rejection case
                    alert('NCR has been rejected. Notification sent to submitter.');
                    return;
                }

                if (selectedStatus) {
                    if (selectedStatus.value === 'external') {
                        // Show external, hide internal
                        document.getElementById('phase2External').classList.remove('hidden');
                        document.getElementById('phase2Internal').classList.add('hidden');
                        document.getElementById('phase2External').classList.add('active');
                    } else {
                        // Show internal, hide external
                        document.getElementById('phase2Internal').classList.remove('hidden');
                        document.getElementById('phase2External').classList.add('hidden');
                        document.getElementById('phase2Internal').classList.add('active');
                    }
                }
            });

            // Supplier Search Logic
            const supplierSearch = document.getElementById('supplierSearch');
            const supplierDropdown = document.getElementById('supplierDropdown');
            const selectedSupplierDiv = document.getElementById('selectedSupplier');
            let selectedSupplier = null;

            supplierSearch.addEventListener('input', function () {
                const query = this.value.toLowerCase();

                if (query.length < 2) {
                    supplierDropdown.classList.add('hidden');
                    return;
                }

                const filteredSuppliers = suppliers.filter(supplier =>
                    supplier.name.toLowerCase().includes(query) ||
                    supplier.contact.toLowerCase().includes(query)
                );

                supplierDropdown.innerHTML = '';

                if (filteredSuppliers.length > 0) {
                    filteredSuppliers.forEach(supplier => {
                        const div = document.createElement('div');
                        div.className = 'supplier-item p-3 cursor-pointer border-b border-gray-200 last:border-b-0';
                        div.innerHTML = `
                        <div class="font-medium text-gray-900">${supplier.name}</div>
                        <div class="text-sm text-gray-500">${supplier.contact} • ${supplier.email}</div>
                    `;
                        div.addEventListener('click', () => selectSupplier(supplier));
                        supplierDropdown.appendChild(div);
                    });
                    supplierDropdown.classList.remove('hidden');
                } else {
                    supplierDropdown.classList.add('hidden');
                }
            });

            function selectSupplier(supplier) {
                selectedSupplier = supplier;
                supplierSearch.value = supplier.name;
                supplierDropdown.classList.add('hidden');

                document.getElementById('supplierName').textContent = supplier.name;
                document.getElementById('supplierDetails').textContent = `${supplier.contact} • ${supplier.email} • ${supplier.phone}`;
                selectedSupplierDiv.classList.remove('hidden');

                // Update supplier summary
                updateSupplierSummary();
            }

            document.getElementById('removeSupplier').addEventListener('click', function () {
                selectedSupplier = null;
                supplierSearch.value = '';
                selectedSupplierDiv.classList.add('hidden');
                if (supplierPriorityFilter) supplierPriorityFilter.value = '';
                updateSupplierSummary();
            });

            // Add New Supplier Modal
            const supplierModal = document.getElementById('supplierModal');
            document.getElementById('addNewSupplier').addEventListener('click', function () {
                supplierModal.classList.remove('hidden');
                supplierModal.classList.add('flex');
            });

            document.getElementById('cancelSupplier').addEventListener('click', function () {
                supplierModal.classList.add('hidden');
                supplierModal.classList.remove('flex');
            });

            document.getElementById('saveSupplier').addEventListener('click', function () {
                // Here you would typically save to database
                alert('New supplier added successfully!');
                supplierModal.classList.add('hidden');
                supplierModal.classList.remove('flex');
            });

            // Voice note player simulation
            document.getElementById('playVoiceNote').addEventListener('click', function () {
                const icon = this.querySelector('i');
                const progressBar = this.parentElement.querySelector('.bg-yanmar-red');

                if (icon.classList.contains('fa-play')) {
                    icon.classList.remove('fa-play');
                    icon.classList.add('fa-pause');

                    // Simulate playing
                    let progress = 0;
                    const interval = setInterval(() => {
                        progress += 2;
                        progressBar.style.width = progress + '%';

                        if (progress >= 100) {
                            clearInterval(interval);
                            icon.classList.remove('fa-pause');
                            icon.classList.add('fa-play');
                            progressBar.style.width = '0%';
                        }
                    }, 100);
                }
            });

            // Hide dropdown when clicking outside
            document.addEventListener('click', function (e) {
                if (!supplierSearch.contains(e.target) && !supplierDropdown.contains(e.target)) {
                    supplierDropdown.classList.add('hidden');
                }
            });        </script>
        </div>

    </main>

</body>

</html>