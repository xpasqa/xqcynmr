<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yanmar QC Dashboard - Buat NCR</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="components/header.js"></script>
    <script src="components/sidebar.js"></script>
</head>

<!-- Main Content -->

<body class="bg-gray-50 font-sans">
    <main id="mainContent" class="ml-16 pt-16 transition-all duration-100">
        <div class="p-6">

            <!-- Page Header -->
            <div class="mb-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">Create NCR</h2>
                    </div>

                </div>
            </div>

            <!-- NCR Form -->
            <div class="bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden">
                <form class="p-6 space-y-6" method="post" enctype="multipart/form-data" id="ncrForm">

                    <!-- NCR Info Section -->
                    <div class="mb-8">
                        <h4 class="text-base font-semibold text-gray-800 mb-6 flex items-center">
                            <svg class="w-5 h-5 text-gray-600 mr-2" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            NCR Information
                        </h4>

                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 lg:gap-6">
                            <!-- NO NCR (Auto-generated) -->
                            <div>
                                <label class="block text-base font-medium text-gray-700 mb-2">No.NCR</label>
                                <input type="text" name="no_ncr" id="noNCR" readonly
                                    class="w-full px-4 py-4 text-base bg-gray-100 border border-slate-300 rounded-lg text-gray-600 cursor-not-allowed"
                                    placeholder="Auto-generated..." />
                                <p class="text-sm text-gray-500 mt-1">Auto-generated by system</p>
                            </div>

                            <!-- Tanggal (Auto-generated) -->
                            <div>
                                <label class="block text-base font-medium text-gray-700 mb-2">Date</label>
                                <input type="text" name="tanggal" id="tanggal" readonly
                                    class="w-full px-4 py-4 text-base bg-gray-100 border border-slate-300 rounded-lg text-gray-600 cursor-not-allowed" />
                                <p class="text-sm text-gray-500 mt-1">Auto-generated today's date</p>
                            </div>

                            <!-- Sender Department -->
                            <div>
                                <label class="block text-base font-medium text-gray-700 mb-2">Sender Department</label>
                                <input type="text" name="sender_department" value="Machine Shop" readonly
                                    class="w-full px-4 py-4 text-base bg-gray-100 border border-slate-300 rounded-lg text-gray-600 cursor-not-allowed" />
                                <p class="text-sm text-gray-500 mt-1">Department information</p>
                            </div>
                        </div>
                    </div>

                    <!-- Judul Laporan Section -->
                    <div class="mb-8">
                        <div>
                            <label class="block text-base font-medium text-gray-700 mb-2">Report Title *</label>
                            <input type="text" name="judul_laporan" required
                                class="w-full px-4 py-4 text-base bg-white border border-slate-300 rounded-lg focus:ring-2 focus:ring-yanmar-red focus:border-transparent transition-all duration-200"
                                placeholder="Enter report title" />
                        </div>
                    </div>

                    <!-- Data Parts Section -->
                    <div class="mb-8">
                        <h4 class="text-base font-semibold text-gray-800 mb-6 flex items-center">
                            <svg class="w-5 h-5 text-gray-600 mr-2" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                            </svg>
                            Data Parts
                        </h4>

                        <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4 lg:gap-6">
                            <!-- Part No -->
                            <div>
                                <label class="block text-base font-medium text-gray-700 mb-2">Part Number *</label>
                                <input type="text" name="part_no" required
                                    class="w-full px-4 py-4 text-base bg-white border border-slate-300 rounded-lg focus:ring-2 focus:ring-yanmar-red focus:border-transparent transition-all duration-200"
                                    placeholder="Enter part number" />
                            </div>

                            <!-- Part Name -->
                            <div>
                                <label class="block text-base font-medium text-gray-700 mb-2">Part Name *</label>
                                <input type="text" name="part_name" required
                                    class="w-full px-4 py-4 text-base bg-white border border-slate-300 rounded-lg focus:ring-2 focus:ring-yanmar-red focus:border-transparent transition-all duration-200"
                                    placeholder="Enter part name" />
                            </div>

                            <!-- Model -->
                            <div>
                                <label class="block text-base font-medium text-gray-700 mb-2">Model *</label>
                                <input type="text" name="model" required
                                    class="w-full px-4 py-4 text-base bg-white border border-slate-300 rounded-lg focus:ring-2 focus:ring-yanmar-red focus:border-transparent transition-all duration-200"
                                    placeholder="Enter model" />
                            </div>

                            <!-- Engine NO -->
                            <div>
                                <label class="block text-base font-medium text-gray-700 mb-2">Engine Number *</label>
                                <input type="text" name="engine_no" required
                                    class="w-full px-4 py-4 text-base bg-white border border-slate-300 rounded-lg focus:ring-2 focus:ring-yanmar-red focus:border-transparent transition-all duration-200"
                                    placeholder="Enter engine number" />
                            </div>

                            <!-- Class Part -->
                            <div>
                                <label class="block text-base font-medium text-gray-700 mb-2">Class Part *</label>
                                <div class="relative">
                                    <select name="class_part" required
                                        class="w-full px-4 py-4 text-base bg-white border border-slate-300 rounded-lg focus:ring-2 focus:ring-yanmar-red focus:border-transparent transition-all duration-200 appearance-none cursor-pointer">
                                        <option value="" disabled selected>Select class part</option>
                                        <option value="safety">Safety</option>
                                        <option value="function">Function</option>
                                        <option value="general">General</option>
                                    </select>
                                    <div class="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none">
                                        <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor"
                                            viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M19 9l-7 7-7-7" />
                                        </svg>
                                    </div>
                                </div>
                            </div>

                            <!-- Location -->
                            <div>
                                <label class="block text-base font-medium text-gray-700 mb-2">Location *</label>
                                <input type="text" name="location" required
                                    class="w-full px-4 py-4 text-base bg-white border border-slate-300 rounded-lg focus:ring-2 focus:ring-yanmar-red focus:border-transparent transition-all duration-200"
                                    placeholder="Enter location" />
                            </div>
                        </div>
                    </div>

                    <!-- Problem Section -->
                    <div class="mb-8">
                        <h4 class="text-base font-semibold text-gray-800 mb-6 flex items-center">
                            <svg class="w-5 h-5 text-gray-600 mr-2" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.082 16.5c-.77.833.192 2.5 1.732 2.5z" />
                            </svg>
                            Problem Statement
                        </h4>

                        <!-- Problem Statement -->
                        <div class="mb-6">
                            <label class="block text-base font-medium text-gray-700 mb-2">Problem Statement *</label>
                            <textarea name="problem_statement" rows="4" required
                                class="w-full px-4 py-4 text-base bg-white border border-slate-300 rounded-lg focus:ring-2 focus:ring-yanmar-red focus:border-transparent transition-all duration-200"
                                placeholder="Describe the problem found"></textarea>
                        </div>
                    </div>

                    <!-- Upload Section -->
                    <div class="mb-8">
                        <h4 class="text-base font-semibold text-gray-800 mb-6 flex items-center">
                            <svg class="w-5 h-5 text-gray-600 mr-2" fill="none" stroke="currentColor"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                            </svg>
                            Upload Media
                        </h4>

                        <div class="space-y-6">
                            <!-- Voice Notes -->
                            <div>
                                <label class="block text-base font-medium text-gray-700 mb-2">Voice Notes</label>
                                <div
                                    class="flex items-center space-x-4 p-6 bg-white border border-slate-300 rounded-lg">
                                    <button type="button" id="recordBtn"
                                        class="relative flex items-center justify-center w-16 h-16 bg-yanmar-red hover:bg-yanmar-dark rounded-full transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105">
                                        <svg id="micIcon" class="w-8 h-8 text-white transition-transform duration-300"
                                            fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M12 2a3 3 0 00-3 3v6a3 3 0 006 0V5a3 3 0 00-3-3z" />
                                            <path
                                                d="M19 10v1a7 7 0 01-14 0v-1a1 1 0 012 0v1a5 5 0 0010 0v-1a1 1 0 012 0z" />
                                            <path d="M12 18.25a1 1 0 01-1-1v-1.5a1 1 0 012 0v1.5a1 1 0 01-1 1z" />
                                            <path d="M8 20.75h8a1 1 0 010 2H8a1 1 0 010-2z" />
                                        </svg>
                                        <!-- Recording pulse animation -->
                                        <div id="recordingPulse"
                                            class="absolute inset-0 rounded-full bg-yanmar-red opacity-0 animate-ping">
                                        </div>
                                    </button>
                                    <div class="flex-1">
                                        <div class="flex items-center space-x-3">
                                            <div id="waveform" class="hidden flex items-center space-x-1">
                                                <div class="w-1 h-4 bg-yanmar-red rounded-full animate-bounce"
                                                    style="animation-delay: 0s"></div>
                                                <div class="w-1 h-6 bg-yanmar-red rounded-full animate-bounce"
                                                    style="animation-delay: 0.1s"></div>
                                                <div class="w-1 h-3 bg-yanmar-red rounded-full animate-bounce"
                                                    style="animation-delay: 0.2s"></div>
                                                <div class="w-1 h-5 bg-yanmar-red rounded-full animate-bounce"
                                                    style="animation-delay: 0.3s"></div>
                                                <div class="w-1 h-7 bg-yanmar-red rounded-full animate-bounce"
                                                    style="animation-delay: 0.4s"></div>
                                                <div class="w-1 h-4 bg-yanmar-red rounded-full animate-bounce"
                                                    style="animation-delay: 0.5s"></div>
                                                <div class="w-1 h-6 bg-yanmar-red rounded-full animate-bounce"
                                                    style="animation-delay: 0.6s"></div>
                                                <div class="w-1 h-3 bg-yanmar-red rounded-full animate-bounce"
                                                    style="animation-delay: 0.7s"></div>
                                            </div>
                                            <span id="recordingStatus"
                                                class="text-base text-slate-600 font-medium">Click microphone to start
                                                recording</span>
                                        </div>
                                        <div id="recordingTimer" class="text-sm text-yanmar-red font-mono hidden mt-1">
                                            00:00</div>
                                    </div>
                                    <div class="hidden" id="voiceControls">
                                        <button type="button" id="stopRecording"
                                            class="px-4 py-2 text-sm bg-slate-200 text-slate-700 rounded-lg hover:bg-slate-300 transition-colors mr-2">
                                            Stop
                                        </button>
                                        <button type="button" id="playRecording"
                                            class="px-4 py-2 text-sm bg-yanmar-red text-white rounded-lg hover:bg-yanmar-dark transition-colors">
                                            Play
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Upload Image & Video in 1 row -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Upload Image -->
                                <div>
                                    <label class="block text-base font-medium text-gray-700 mb-2">Upload Image</label>
                                    <div class="border-2 border-dashed border-slate-300 rounded-lg p-4 hover:border-yanmar-red transition-colors min-h-32"
                                        id="imageDropzone">
                                        <input type="file" name="images" multiple accept="image/*" class="hidden"
                                            id="imageUpload">

                                        <!-- Upload Prompt (shown when empty) -->
                                        <div id="imageUploadPrompt" class="text-center">
                                            <label for="imageUpload" class="cursor-pointer block">
                                                <svg class="w-8 h-8 text-slate-400 mx-auto mb-2" fill="none"
                                                    stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                                </svg>
                                                <p class="text-base text-slate-600">Click to upload image</p>
                                                <p class="text-sm text-slate-400">PNG, JPG max 10MB</p>
                                            </label>
                                        </div>

                                        <!-- Image Thumbnails -->
                                        <div id="imageThumbnails" class="grid grid-cols-2 gap-3 hidden"></div>

                                        <!-- Add More Button -->
                                        <div id="addMoreImages" class="hidden mt-2">
                                            <label for="imageUpload"
                                                class="cursor-pointer inline-flex items-center px-3 py-1 text-xs bg-yanmar-red text-white rounded-full hover:bg-yanmar-dark transition-colors">
                                                <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2" d="M12 4v16m8-8H4" />
                                                </svg>
                                                Add More
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <!-- Upload Video -->
                                <div>
                                    <label class="block text-base font-medium text-gray-700 mb-2">Upload Video</label>
                                    <div class="border-2 border-dashed border-slate-300 rounded-lg p-4 hover:border-yanmar-red transition-colors min-h-32"
                                        id="videoDropzone">
                                        <input type="file" name="videos" multiple accept="video/*" class="hidden"
                                            id="videoUpload">

                                        <!-- Upload Prompt (shown when empty) -->
                                        <div id="videoUploadPrompt" class="text-center">
                                            <label for="videoUpload" class="cursor-pointer block">
                                                <svg class="w-8 h-8 text-slate-400 mx-auto mb-2" fill="none"
                                                    stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
                                                </svg>
                                                <p class="text-base text-slate-600">Click to upload video</p>
                                                <p class="text-sm text-slate-400">MP4, MOV max 50MB</p>
                                            </label>
                                        </div>

                                        <!-- Video Thumbnails -->
                                        <div id="videoThumbnails" class="grid grid-cols-1 gap-4 hidden"></div>

                                        <!-- Add More Button -->
                                        <div id="addMoreVideos" class="hidden mt-2">
                                            <label for="videoUpload"
                                                class="cursor-pointer inline-flex items-center px-3 py-1 text-xs bg-yanmar-red text-white rounded-full hover:bg-yanmar-dark transition-colors">
                                                <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2" d="M12 4v16m8-8H4" />
                                                </svg>
                                                Add More
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex flex-col sm:flex-row gap-4 pt-6 border-t border-slate-200">
                        <button type="button"
                            class="flex-1 bg-slate-200 text-slate-700 py-4 px-8 rounded-lg font-semibold text-base hover:bg-slate-300 transition-all duration-200 flex items-center justify-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3-3m0 0l-3 3m3-3v12" />
                            </svg>
                            Save Draft
                        </button>

                        <button type="submit"
                            class="flex-1 bg-gradient-to-r from-yanmar-red to-red-600 text-white py-4 px-8 rounded-lg font-semibold text-base hover:from-red-600 hover:to-yanmar-red transform hover:scale-[1.02] transition-all duration-200 flex items-center justify-center shadow-lg">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                            </svg>
                            Submit
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Image & Video Modal -->
        <div id="mediaModal"
            class="fixed inset-0 bg-black bg-opacity-75 z-50 hidden flex items-center justify-center p-4">
            <div class="relative max-w-4xl max-h-full w-full">
                <!-- Close Button -->
                <button id="closeModal" class="absolute -top-10 right-0 text-white hover:text-yanmar-red text-2xl z-10">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>

                <!-- Modal Content -->
                <div id="modalContent" class="bg-white rounded-lg overflow-hidden shadow-2xl">
                    <!-- Content will be dynamically inserted here -->
                </div>
            </div>
        </div>

        <!-- JavaScript -->
        <script>
            // Auto-generate NO NCR and Date
            document.addEventListener('DOMContentLoaded', function () {
                // Generate NCR Number
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');

                // Format: NCR-YYYYMMDD-HHMM
                const ncrNumber = `NCR-${year}${month}${day}-${hours}${minutes}`;
                document.getElementById('noNCR').value = ncrNumber;

                // Set current date with time
                const seconds = String(now.getSeconds()).padStart(2, '0');
                const options = {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    timeZone: 'Asia/Jakarta'
                };
                const dateString = now.toLocaleDateString('en-US', options);
                const timeString = `${hours}:${minutes}:${seconds}`;
                const currentDateTime = `${dateString}, ${timeString}`;
                document.getElementById('tanggal').value = currentDateTime;
            });

            // Voice Recording Functionality
            let isRecording = false;
            let mediaRecorder;
            let recordingTimer;
            let startTime;

            const recordBtn = document.getElementById('recordBtn');
            const micIcon = document.getElementById('micIcon');
            const waveform = document.getElementById('waveform');
            const recordingStatus = document.getElementById('recordingStatus');
            const recordingTimerEl = document.getElementById('recordingTimer');

            recordBtn.addEventListener('click', toggleRecording);

            async function toggleRecording() {
                if (!isRecording) {
                    startRecording();
                } else {
                    stopRecording();
                }
            }

            async function startRecording() {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream);

                    mediaRecorder.start();
                    isRecording = true;

                    // Update UI with enhanced animations
                    recordBtn.classList.remove('bg-yanmar-red', 'hover:bg-yanmar-dark', 'hover:scale-105');
                    recordBtn.classList.add('bg-red-600', 'scale-110', 'animate-pulse');

                    // Show pulse animation
                    const pulse = document.getElementById('recordingPulse');
                    pulse.classList.remove('opacity-0');
                    pulse.classList.add('opacity-75');

                    // Rotate mic icon
                    micIcon.classList.add('rotate-12');

                    waveform.classList.remove('hidden');
                    recordingStatus.textContent = 'Recording...';
                    recordingTimerEl.classList.remove('hidden');

                    // Start timer
                    startTime = Date.now();
                    recordingTimer = setInterval(updateTimer, 100);

                } catch (err) {
                    console.error('Error accessing microphone:', err);
                    alert('Cannot access microphone. Please check permissions.');
                }
            }

            function stopRecording() {
                if (mediaRecorder && isRecording) {
                    mediaRecorder.stop();
                    isRecording = false;

                    // Stop all tracks
                    mediaRecorder.stream.getTracks().forEach(track => track.stop());

                    // Update UI with animations
                    recordBtn.classList.remove('bg-red-600', 'animate-pulse', 'scale-110');
                    recordBtn.classList.add('bg-yanmar-red', 'hover:bg-yanmar-dark', 'hover:scale-105');

                    // Hide pulse animation
                    const pulse = document.getElementById('recordingPulse');
                    pulse.classList.remove('opacity-75');
                    pulse.classList.add('opacity-0');

                    // Reset mic icon rotation
                    micIcon.classList.remove('rotate-12');

                    waveform.classList.add('hidden');
                    recordingStatus.textContent = 'Recording saved';

                    // Stop timer
                    clearInterval(recordingTimer);

                    setTimeout(() => {
                        recordingStatus.textContent = 'Click microphone to start recording';
                        recordingTimerEl.classList.add('hidden');
                    }, 2000);
                }
            }

            function updateTimer() {
                if (isRecording) {
                    const elapsed = Date.now() - startTime;
                    const minutes = Math.floor(elapsed / 60000);
                    const seconds = Math.floor((elapsed % 60000) / 1000);
                    recordingTimerEl.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }
            }

            // Image Upload Preview
            const imageUpload = document.getElementById('imageUpload');
            const imageThumbnails = document.getElementById('imageThumbnails');
            const imageUploadPrompt = document.getElementById('imageUploadPrompt');
            const addMoreImages = document.getElementById('addMoreImages');
            let uploadedImages = [];

            imageUpload.addEventListener('change', function (e) {
                const newFiles = Array.from(e.target.files);

                // Add new files to existing array
                newFiles.forEach(file => {
                    if (file.type.startsWith('image/')) {
                        uploadedImages.push(file);
                    }
                });

                displayImageThumbnails();
            });

            function displayImageThumbnails() {
                imageThumbnails.innerHTML = '';

                if (uploadedImages.length > 0) {
                    // Hide upload prompt and show thumbnails
                    imageUploadPrompt.classList.add('hidden');
                    imageThumbnails.classList.remove('hidden');
                    addMoreImages.classList.remove('hidden');

                    uploadedImages.forEach((file, index) => {
                        const reader = new FileReader();
                        reader.onload = function (e) {
                            const thumbnailDiv = document.createElement('div');
                            thumbnailDiv.className = 'relative group cursor-pointer';
                            thumbnailDiv.innerHTML = `
                                <div class="aspect-square bg-slate-100 rounded-lg overflow-hidden border-2 border-slate-200 hover:border-yanmar-red transition-colors shadow-sm">
                                    <img src="${e.target.result}" alt="Thumbnail ${index + 1}" class="w-full h-full object-cover" />
                                    <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-40 transition-all duration-200 flex items-center justify-center">
                                        <svg class="w-6 h-6 text-white opacity-0 group-hover:opacity-100 transition-opacity" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                        </svg>
                                    </div>
                                    <button class="absolute top-2 right-2 w-6 h-6 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-600 flex items-center justify-center shadow-lg" onclick="removeImage(${index})">
                                        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                        </svg>
                                    </button>
                                </div>
                            `;

                            // Add click event to show in modal
                            thumbnailDiv.onclick = function (event) {
                                if (event.target.tagName !== 'BUTTON' && !event.target.closest('button')) {
                                    showImageModal(e.target.result, `Image ${index + 1}`, file.name);
                                }
                            };

                            imageThumbnails.appendChild(thumbnailDiv);
                        };
                        reader.readAsDataURL(file);
                    });
                } else {
                    // Show upload prompt and hide thumbnails
                    imageUploadPrompt.classList.remove('hidden');
                    imageThumbnails.classList.add('hidden');
                    addMoreImages.classList.add('hidden');
                }
            }

            // Video Upload Preview
            const videoUpload = document.getElementById('videoUpload');
            const videoThumbnails = document.getElementById('videoThumbnails');
            const videoUploadPrompt = document.getElementById('videoUploadPrompt');
            const addMoreVideos = document.getElementById('addMoreVideos');
            let uploadedVideos = [];

            videoUpload.addEventListener('change', function (e) {
                const newFiles = Array.from(e.target.files);

                // Add new files to existing array
                newFiles.forEach(file => {
                    if (file.type.startsWith('video/')) {
                        uploadedVideos.push(file);
                    }
                });

                displayVideoThumbnails();
            });

            function displayVideoThumbnails() {
                videoThumbnails.innerHTML = '';

                if (uploadedVideos.length > 0) {
                    // Hide upload prompt and show thumbnails
                    videoUploadPrompt.classList.add('hidden');
                    videoThumbnails.classList.remove('hidden');
                    addMoreVideos.classList.remove('hidden');

                    uploadedVideos.forEach((file, index) => {
                        const video = document.createElement('video');
                        video.src = URL.createObjectURL(file);
                        video.load();

                        video.onloadedmetadata = function () {
                            // Create thumbnail canvas
                            const canvas = document.createElement('canvas');
                            const ctx = canvas.getContext('2d');
                            canvas.width = 200;
                            canvas.height = 150;

                            video.currentTime = 1; // Seek to 1 second for thumbnail
                            video.onseeked = function () {
                                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

                                const thumbnailDiv = document.createElement('div');
                                thumbnailDiv.className = 'relative group cursor-pointer';
                                thumbnailDiv.innerHTML = `
                                    <div class="relative bg-slate-100 rounded-lg overflow-hidden border-2 border-slate-200 hover:border-yanmar-red transition-colors shadow-sm">
                                        <img src="${canvas.toDataURL()}" alt="Video Thumbnail ${index + 1}" class="w-full h-32 sm:h-24 object-cover" />
                                        <div class="absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center">
                                            <div class="w-12 h-12 sm:w-10 sm:h-10 bg-white bg-opacity-90 rounded-full flex items-center justify-center group-hover:bg-yanmar-red group-hover:text-white transition-colors shadow-lg">
                                                <svg class="w-6 h-6 sm:w-5 sm:h-5 ml-0.5" fill="currentColor" viewBox="0 0 24 24">
                                                    <path d="M8 5v14l11-7z"/>
                                                </svg>
                                            </div>
                                        </div>
                                        <div class="absolute bottom-2 left-2 bg-black bg-opacity-75 text-white text-xs px-2 py-1 rounded">
                                            ${formatDuration(video.duration)}
                                        </div>
                                        <button class="absolute top-2 right-2 w-6 h-6 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-600 flex items-center justify-center shadow-lg" onclick="removeVideo(${index})">
                                            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                            </svg>
                                        </button>
                                    </div>
                                    <div class="mt-2 text-xs text-slate-500 truncate font-medium">${file.name}</div>
                                `;

                                // Add click event to show in modal
                                thumbnailDiv.onclick = function (event) {
                                    if (event.target.tagName !== 'BUTTON' && !event.target.closest('button')) {
                                        showVideoModal(video.src, file.name);
                                    }
                                };

                                videoThumbnails.appendChild(thumbnailDiv);
                            };
                        };
                    });
                } else {
                    // Show upload prompt and hide thumbnails
                    videoUploadPrompt.classList.remove('hidden');
                    videoThumbnails.classList.add('hidden');
                    addMoreVideos.classList.add('hidden');
                }
            }

            // Modal Functions
            const modal = document.getElementById('mediaModal');
            const modalContent = document.getElementById('modalContent');
            const closeModal = document.getElementById('closeModal');

            function showImageModal(src, title, filename = '') {
                modalContent.innerHTML = `
                    <div class="p-6">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <h3 class="text-base font-semibold text-gray-800">${title}</h3>
                                ${filename ? `<p class="text-sm text-slate-500 mt-1">${filename}</p>` : ''}
                            </div>
                        </div>
                        <div class="bg-slate-50 rounded-lg p-4">
                            <img src="${src}" alt="${title}" class="w-full max-h-96 object-contain rounded-lg mx-auto" />
                        </div>
                    </div>
                `;
                modal.classList.remove('hidden');
            }

            function showVideoModal(src, title) {
                modalContent.innerHTML = `
                    <div class="p-6">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <h3 class="text-base font-semibold text-gray-800">Video Preview</h3>
                                <p class="text-sm text-slate-500 mt-1">${title}</p>
                            </div>
                        </div>
                        <div class="bg-slate-50 rounded-lg p-4">
                            <video src="${src}" controls class="w-full max-h-96 rounded-lg mx-auto" preload="metadata">
                                Browser tidak mendukung video playback.
                            </video>
                        </div>
                    </div>
                `;
                modal.classList.remove('hidden');
            }

            // Close modal events
            closeModal.onclick = function () {
                modal.classList.add('hidden');
                // Stop any playing videos
                const videos = modalContent.querySelectorAll('video');
                videos.forEach(video => {
                    video.pause();
                    video.currentTime = 0;
                });
            };

            modal.onclick = function (e) {
                if (e.target === modal) {
                    closeModal.onclick();
                }
            };

            // Utility functions
            function formatDuration(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            }

            function removeImage(index) {
                // Remove from uploaded images array
                uploadedImages.splice(index, 1);

                // Refresh thumbnails display
                displayImageThumbnails();

                // Clear input to allow re-selecting same files
                imageUpload.value = '';
            }

            function removeVideo(index) {
                // Remove from uploaded videos array
                uploadedVideos.splice(index, 1);

                // Refresh thumbnails display
                displayVideoThumbnails();

                // Clear input to allow re-selecting same files
                videoUpload.value = '';
            }

            // Form Validation and Submit
            const form = document.getElementById('ncrForm');
            form.addEventListener('submit', function (e) {
                e.preventDefault();

                // Simple validation check
                const requiredFields = form.querySelectorAll('[required]');
                let isValid = true;

                requiredFields.forEach(field => {
                    if (!field.value.trim()) {
                        field.classList.add('border-red-500');
                        isValid = false;
                    } else {
                        field.classList.remove('border-red-500');
                    }
                });

                if (isValid) {
                    // Show success message
                    const successMsg = document.createElement('div');
                    successMsg.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
                    successMsg.textContent = 'NCR berhasil dibuat!';
                    document.body.appendChild(successMsg);

                    setTimeout(() => {
                        successMsg.remove();
                        // Redirect to dashboard or NCR list
                        window.location.href = 'dashboard.html';
                    }, 2000);

                } else {
                    // Show error message
                    const errorMsg = document.createElement('div');
                    errorMsg.className = 'fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
                    errorMsg.textContent = 'Mohon lengkapi semua field yang wajib diisi.';
                    document.body.appendChild(errorMsg);

                    setTimeout(() => {
                        errorMsg.remove();
                    }, 3000);
                }
            });
        </script>
    </main>

</body>

</html>