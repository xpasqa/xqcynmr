<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yanmar QC Dashboard - Admin NCR Reply Review</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Flatpickr CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <!-- Flatpickr JS -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <style>
        /* Toggle section styling */
        .toggle-container {
            margin-bottom: 2rem !important;
        }

        Uploaded Evidence .toggle-section {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .toggle-section.collapsed {
            margin-bottom: 0 !important;
        }

        /* Ensure proper spacing for collapsed state */
        .toggle-container:has(.collapsed) {
            margin-bottom: 2rem !important;
        }

        /* Read-only form styling */
        .read-only {
            background-color: #f9fafb !important;
            border-color: #d1d5db !important;
            color: #6b7280 !important;
        }
    </style>
    <script src="components/header.js"></script>
    <script src="components/sidebar.js"></script>
</head>

<body class="bg-gray-50 font-sans">
    <!-- Main Content -->
    <main id="mainContent" class="ml-16 pt-16 transition-all duration-100">
        <div class="p-6">

            <!-- Page Header -->
            <div class="mb-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">NCR Vendor Reply - Admin Review</h2>
                        <p class="text-gray-600 mt-1">Review and verify vendor response for NCR #2024-001</p>
                    </div>
                    <div class="flex items-center space-x-3">
                        <div class="bg-white px-4 py-2 rounded-lg shadow-sm border">
                            <span class="text-base text-gray-500">Status:</span>
                            <span class="text-base font-medium text-yellow-600 ml-2">Pending Admin Review</span>
                        </div>
                        <div class="bg-white px-4 py-2 rounded-lg shadow-sm border">
                            <span class="text-base text-gray-500">Submitted:</span>
                            <span class="text-base font-medium text-gray-800 ml-2">Dec 15, 2024</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Company Information (Read-only) -->
            <div class="bg-white rounded-lg shadow border border-gray-200 overflow-hidden mb-6">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">Vendor Information</h3>
                </div>
                <div class="p-6 bg-gray-50">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <span class="text-sm font-medium text-gray-700">Company:</span>
                            <p class="text-gray-900">PT. Besi Kuat Manufacturing</p>
                        </div>
                        <div>
                            <span class="text-sm font-medium text-gray-700">PIC:</span>
                            <p class="text-gray-900">Ahmad Wijaya</p>
                        </div>
                        <div>
                            <span class="text-sm font-medium text-gray-700">Contact:</span>
                            <p class="text-gray-900">021-5432167 | ahmad@besikuat.co.id</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Vendor Reply Form (Read-only) -->
            <div class="bg-white rounded-lg shadow border border-gray-200 overflow-hidden mb-6">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">Vendor Reply</h3>
                    <p class="text-sm text-gray-500">Temporary action and response details</p>
                </div>
                <div class="p-6">
                    <form id="reportForm">
                        <!-- Temporary Action -->
                        <div class="mb-6">
                            <label class="block text-base font-medium text-gray-700 mb-2">Action Taken</label>
                            <textarea name="temporaryAction" readonly
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg read-only resize-none text-base"
                                rows="4">We have immediately stopped production line and conducted thorough inspection of all products in the same batch. Found that the issue was caused by incorrect calibration of measurement equipment. We have recalibrated all equipment and implemented additional quality checks.</textarea>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div>
                                <label class="block text-base font-medium text-gray-700 mb-2">Date Start</label>
                                <input type="date" name="dateStart" value="2024-12-10" readonly
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg read-only text-base">
                            </div>
                            <div>
                                <label class="block text-base font-medium text-gray-700 mb-2">Date Good Lot</label>
                                <input type="date" name="dateGoodLot" value="2024-12-12" readonly
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg read-only text-base">
                            </div>
                        </div>

                        <!-- Images and Videos (Evidence) -->
                        <div class="mb-6">
                            <label class="block text-base font-medium text-gray-700 mb-3">Uploaded Evidence</label>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <div class="border border-gray-300 rounded-lg p-2 bg-gray-50 cursor-pointer"
                                    onclick="openModal('images/baud.png', 'image')">
                                    <img src="images/baud.png" alt="Evidence 1"
                                        class="w-full h-40 object-cover rounded">
                                    <p class="text-xs text-gray-600 mt-1">Equipment calibration.jpg</p>
                                </div>
                                <div class="border border-gray-300 rounded-lg p-2 bg-gray-50 cursor-pointer"
                                    onclick="openModal('images/baud-2.png', 'image')">
                                    <img src="images/baud-2.png" alt="Evidence 2"
                                        class="w-full h-40 object-cover rounded">
                                    <p class="text-xs text-gray-600 mt-1">Quality check process.jpg</p>
                                </div>
                                <div class="border border-gray-300 rounded-lg p-2 bg-gray-50 cursor-pointer"
                                    onclick="openModal('images/video.mp4', 'video')">
                                    <video src="images/videos.mp4" class="w-full h-40 object-cover rounded" muted>
                                        <source src="images/video.mp4" type="video/mp4">
                                    </video>
                                    <p class="text-xs text-gray-600 mt-1">Inspection process.mp4</p>
                                </div>
                            </div>
                        </div>
                    </form>

                    <!-- Advanced Analysis Checkbox (Disabled) -->
                    <div class="mb-8">
                        <div class="flex items-center space-x-3">
                            <input type="checkbox" id="enableAdvancedAnalysis" checked disabled
                                class="w-4 h-4 text-red-600 border-gray-300 rounded focus:ring-red-500">
                            <label for="enableAdvancedAnalysis" class="text-base font-medium text-gray-500">
                                Detailed analysis completed (Process Flow, Problem Analysis & Countermeasures)
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Detail Analysis Title -->
            <div id="detailAnalysisTitle" class="mb-6">
                <h3 class="text-xl font-bold text-gray-800 mb-2">Detail Analysis</h3>
                <p class="text-gray-600">Vendor's detailed analysis including process flow, problem analysis, and
                    countermeasures.</p>
            </div>

            <!-- Advanced Analysis Section -->
            <div id="advancedAnalysisSection">
                <!-- Process Flow -->
                <div class="bg-white rounded-lg shadow mb-8 toggle-container">
                    <div class="px-6 py-4 border-b border-gray-200 cursor-pointer hover:bg-gray-50 transition-colors"
                        onclick="toggleSection('processFlowSection')">
                        <div class="flex items-center justify-between">
                            <h2 class="text-lg font-medium text-gray-900">Process Flow</h2>
                            <i id="processFlowIcon"
                                class="fas fa-chevron-up text-gray-500 transition-transform duration-200"></i>
                        </div>
                    </div>
                    <div id="processFlowSection"
                        class="p-6 overflow-hidden transition-all duration-300 ease-in-out toggle-section">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Process Flow</label>
                            <textarea readonly
                                class="w-full px-3 py-2 border border-gray-300 rounded-md read-only text-sm resize-none"
                                rows="4">1. Raw material received and stored in warehouse
2. Material inspection conducted by QC team
3. Material released to production floor
4. Manufacturing process started with machine calibration
5. In-process quality checks at 3 checkpoints
6. Final inspection before packaging
7. Product shipped to customer</textarea>
                        </div>
                    </div>
                </div>

                <!-- Problem Analysis: Why Occurs -->
                <div class="bg-white rounded-lg shadow mb-8 toggle-container">
                    <div class="px-6 py-4 border-b border-gray-200 cursor-pointer hover:bg-gray-50 transition-colors"
                        onclick="toggleSection('whyOccursSection')">
                        <div class="flex items-center justify-between">
                            <h2 class="text-lg font-medium text-gray-900">Problem Analysis: Why Occurs?</h2>
                            <i id="whyOccursIcon"
                                class="fas fa-chevron-up text-gray-500 transition-transform duration-200"></i>
                        </div>
                    </div>
                    <div id="whyOccursSection"
                        class="p-6 overflow-hidden transition-all duration-300 ease-in-out toggle-section">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                                <h4 class="font-semibold text-gray-900 mb-3">MAN</h4>
                                <textarea readonly
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md read-only text-sm"
                                    rows="3">Operator was not properly trained on new calibration procedure. Training records show gap in equipment calibration training.</textarea>
                            </div>
                            <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                                <h4 class="font-semibold text-gray-900 mb-3">METHOD</h4>
                                <textarea readonly
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md read-only text-sm"
                                    rows="3">Calibration procedure was outdated and did not reflect recent equipment updates. Standard operating procedure needs revision.</textarea>
                            </div>
                            <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                                <h4 class="font-semibold text-gray-900 mb-3">MATERIAL</h4>
                                <textarea readonly
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md read-only text-sm"
                                    rows="3">Calibration standards were not properly maintained. Reference materials showed deviation from certified values.</textarea>
                            </div>
                            <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                                <h4 class="font-semibold text-gray-900 mb-3">MACHINE</h4>
                                <textarea readonly
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md read-only text-sm"
                                    rows="3">Measurement equipment drift beyond acceptable limits. Calibration due date was exceeded by 2 weeks.</textarea>
                            </div>
                            <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                                <h4 class="font-semibold text-gray-900 mb-3">ENVIRONMENT</h4>
                                <textarea readonly
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md read-only text-sm"
                                    rows="3">Temperature and humidity not controlled in calibration area. Environmental conditions affected measurement accuracy.</textarea>
                            </div>
                            <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                                <h4 class="font-semibold text-gray-900 mb-3">ROOT CAUSE</h4>
                                <textarea readonly
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md read-only text-sm"
                                    rows="3">Lack of proper calibration management system. No systematic tracking of calibration schedules and training requirements.</textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Problem Analysis: Why Flow Out -->
                <div class="bg-white rounded-lg shadow mb-8 toggle-container">
                    <div class="px-6 py-4 border-b border-gray-200 cursor-pointer hover:bg-gray-50 transition-colors"
                        onclick="toggleSection('whyFlowOutSection')">
                        <div class="flex items-center justify-between">
                            <h2 class="text-lg font-medium text-gray-900">Problem Analysis: Why Flow Out?</h2>
                            <i id="whyFlowOutIcon"
                                class="fas fa-chevron-up text-gray-500 transition-transform duration-200"></i>
                        </div>
                    </div>
                    <div id="whyFlowOutSection"
                        class="p-6 overflow-hidden transition-all duration-300 ease-in-out toggle-section">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                                <h4 class="font-semibold text-gray-900 mb-3">MAN</h4>
                                <textarea readonly
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md read-only text-sm"
                                    rows="3">Inspector failed to detect measurement deviation during final inspection. Inspector was not aware of calibration issue.</textarea>
                            </div>
                            <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                                <h4 class="font-semibold text-gray-900 mb-3">METHOD</h4>
                                <textarea readonly
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md read-only text-sm"
                                    rows="3">Inspection procedure did not include verification of measurement accuracy. No cross-check with alternative measurement method.</textarea>
                            </div>
                            <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                                <h4 class="font-semibold text-gray-900 mb-3">MATERIAL</h4>
                                <textarea readonly
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md read-only text-sm"
                                    rows="3">Inspection standards not updated to reflect latest specification changes. Reference samples were outdated.</textarea>
                            </div>
                            <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                                <h4 class="font-semibold text-gray-900 mb-3">MACHINE</h4>
                                <textarea readonly
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md read-only text-sm"
                                    rows="3">Inspection equipment also had calibration issues. No independent verification system in place.</textarea>
                            </div>
                            <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                                <h4 class="font-semibold text-gray-900 mb-3">ENVIRONMENT</h4>
                                <textarea readonly
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md read-only text-sm"
                                    rows="3">Inspection area conditions not optimized. Poor lighting and noise distractions affected inspection quality.</textarea>
                            </div>
                            <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                                <h4 class="font-semibold text-gray-900 mb-3">ROOT CAUSE</h4>
                                <textarea readonly
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md read-only text-sm"
                                    rows="3">Inadequate quality assurance system. No systematic verification of measurement systems and inspection processes.</textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Countermeasure for Occurs Section (Admin can verify) -->
                <div class="bg-white rounded-lg shadow mb-8 toggle-container">
                    <div class="px-6 py-4 border-b border-gray-200 cursor-pointer hover:bg-gray-50 transition-colors"
                        onclick="toggleSection('countermeasureSection')">
                        <div class="flex items-center justify-between">
                            <h2 class="text-lg font-medium text-gray-900">Countermeasure for Occurs</h2>
                            <i id="countermeasureIcon"
                                class="fas fa-chevron-up text-gray-500 transition-transform duration-200"></i>
                        </div>
                    </div>
                    <div id="countermeasureSection"
                        class="p-6 overflow-hidden transition-all duration-300 ease-in-out toggle-section">
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">No
                                        </th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">
                                            Description</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">PIC
                                        </th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Due
                                            Date</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">
                                            Status</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">
                                            Evidence</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">
                                            Verification</th>
                                    </tr>
                                </thead>
                                <tbody id="countermeasureTableBody" class="bg-white divide-y divide-gray-200">
                                    <!-- Sample data -->
                                    <tr>
                                        <td class="px-4 py-3 text-sm text-gray-900">1</td>
                                        <td class="px-4 py-3 text-sm text-gray-900">Implement calibration management
                                            system with automated alerts</td>
                                        <td class="px-4 py-3 text-sm text-gray-900">Ahmad Wijaya</td>
                                        <td class="px-4 py-3 text-sm text-gray-900">2024-12-20</td>
                                        <td class="px-4 py-3">
                                            <span
                                                class="px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full">In
                                                Progress</span>
                                        </td>
                                        <td class="px-4 py-3">
                                            <div class="flex items-center flex-wrap">
                                                <img src="images/baud.png" alt="Evidence 1"
                                                     class="w-8 h-8 object-cover rounded border cursor-pointer hover:opacity-75 transition-opacity mr-1"
                                                     onclick="openModal('images/baud.png', 'image')">
                                                <img src="images/baud-2.png" alt="Evidence 2"
                                                     class="w-8 h-8 object-cover rounded border cursor-pointer hover:opacity-75 transition-opacity mr-1"
                                                     onclick="openModal('images/baud-2.png', 'image')">
                                            </div>
                                        </td>
                                        <td class="px-4 py-3">
                                            <button onclick="toggleVerification(this, 1)"
                                                class="w-6 h-6 bg-yellow-500 text-white rounded-full flex items-center justify-center hover:bg-yellow-600 transition-colors cursor-pointer">
                                                <i class="fas fa-clock text-xs"></i>
                                            </button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-3 text-sm text-gray-900">2</td>
                                        <td class="px-4 py-3 text-sm text-gray-900">Conduct training for all operators
                                            on new calibration procedure</td>
                                        <td class="px-4 py-3 text-sm text-gray-900">Siti Rahma</td>
                                        <td class="px-4 py-3 text-sm text-gray-900">2024-12-18</td>
                                        <td class="px-4 py-3">
                                            <span
                                                class="px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded-full">Done</span>
                                        </td>
                                        <td class="px-4 py-3">
                                            <div class="flex items-center flex-wrap">
                                                <img src="images/baud.png" alt="Training Evidence"
                                                     class="w-8 h-8 object-cover rounded border cursor-pointer hover:opacity-75 transition-opacity mr-1"
                                                     onclick="openModal('images/baud.png', 'image')">
                                            </div>
                                        </td>
                                        <td class="px-4 py-3">
                                            <button onclick="toggleVerification(this, 2)"
                                                class="w-6 h-6 bg-green-500 text-white rounded-full flex items-center justify-center hover:bg-green-600 transition-colors cursor-pointer">
                                                <i class="fas fa-check text-xs"></i>
                                            </button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-3 text-sm text-gray-900">3</td>
                                        <td class="px-4 py-3 text-sm text-gray-900">Update all calibration procedures
                                            and work instructions</td>
                                        <td class="px-4 py-3 text-sm text-gray-900">Budi Santoso</td>
                                        <td class="px-4 py-3 text-sm text-gray-900">2024-12-25</td>
                                        <td class="px-4 py-3">
                                            <span
                                                class="px-2 py-1 text-xs font-medium bg-yellow-100 text-yellow-800 rounded-full">Waiting</span>
                                        </td>
                                        <td class="px-4 py-3">
                                            <div class="flex items-center flex-wrap">
                                                <span class="text-gray-400 text-xs">No evidence</span>
                                            </div>
                                        </td>
                                        <td class="px-4 py-3">
                                            <button onclick="toggleVerification(this, 3)"
                                                class="w-6 h-6 bg-gray-400 text-white rounded-full flex items-center justify-center hover:bg-gray-500 transition-colors cursor-pointer">
                                                <i class="fas fa-clock text-xs"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Countermeasure for Flow Out Section -->
                <div class="bg-white rounded-lg shadow mb-8 toggle-container">
                    <div class="px-6 py-4 border-b border-gray-200 cursor-pointer hover:bg-gray-50 transition-colors"
                        onclick="toggleSection('countermeasureFlowOutSection')">
                        <div class="flex items-center justify-between">
                            <h2 class="text-lg font-medium text-gray-900">Countermeasure for Flow Out</h2>
                            <i id="countermeasureFlowOutIcon"
                                class="fas fa-chevron-up text-gray-500 transition-transform duration-200"></i>
                        </div>
                    </div>
                    <div id="countermeasureFlowOutSection"
                        class="p-6 overflow-hidden transition-all duration-300 ease-in-out toggle-section">
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">No
                                        </th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">
                                            Description</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">PIC
                                        </th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Due
                                            Date</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">
                                            Status</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">
                                            Evidence</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">
                                            Verification</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <!-- Sample data -->
                                    <tr>
                                        <td class="px-4 py-3 text-sm text-gray-900">1</td>
                                        <td class="px-4 py-3 text-sm text-gray-900">Implement independent verification
                                            system for final inspection</td>
                                        <td class="px-4 py-3 text-sm text-gray-900">Dewi Susanti</td>
                                        <td class="px-4 py-3 text-sm text-gray-900">2024-12-22</td>
                                        <td class="px-4 py-3">
                                            <span
                                                class="px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full">In
                                                Progress</span>
                                        </td>
                                        <td class="px-4 py-3">
                                            <div class="flex items-center flex-wrap">
                                                <img src="images/baud-2.png" alt="Verification System Evidence"
                                                     class="w-8 h-8 object-cover rounded border cursor-pointer hover:opacity-75 transition-opacity mr-1"
                                                     onclick="openModal('images/baud-2.png', 'image')">
                                            </div>
                                        </td>
                                        <td class="px-4 py-3">
                                            <button onclick="toggleVerificationFlowOut(this, 1)"
                                                class="w-6 h-6 bg-yellow-500 text-white rounded-full flex items-center justify-center hover:bg-yellow-600 transition-colors cursor-pointer">
                                                <i class="fas fa-clock text-xs"></i>
                                            </button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-3 text-sm text-gray-900">2</td>
                                        <td class="px-4 py-3 text-sm text-gray-900">Improve inspection environment and
                                            lighting conditions</td>
                                        <td class="px-4 py-3 text-sm text-gray-900">Agus Setiawan</td>
                                        <td class="px-4 py-3 text-sm text-gray-900">2024-12-30</td>
                                        <td class="px-4 py-3">
                                            <span
                                                class="px-2 py-1 text-xs font-medium bg-yellow-100 text-yellow-800 rounded-full">Waiting</span>
                                        </td>
                                        <td class="px-4 py-3">
                                            <div class="flex items-center flex-wrap">
                                                <span class="text-gray-400 text-xs">No evidence</span>
                                            </div>
                                        </td>
                                        <td class="px-4 py-3">
                                            <button onclick="toggleVerificationFlowOut(this, 2)"
                                                class="w-6 h-6 bg-gray-400 text-white rounded-full flex items-center justify-center hover:bg-gray-500 transition-colors cursor-pointer">
                                                <i class="fas fa-clock text-xs"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Admin Review & Feedback Section -->
                <div class="bg-white rounded-lg shadow mb-8">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h2 class="text-lg font-medium text-gray-900">Admin Review & Feedback</h2>
                        <p class="text-sm text-gray-500">Provide detailed assessment and improvement recommendations for the vendor response</p>
                    </div>
                    <div class="p-6 space-y-6">
                        <!-- Two Column Layout -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- Countermeasure Assessment -->
                            <div>
                                <label class="block text-base font-medium text-gray-700 mb-2">Countermeasure Assessment</label>
                                <p class="text-sm text-gray-600 mb-3">Identify deficiencies, gaps, or areas of concern in the proposed countermeasures that require vendor attention.</p>
                                <textarea id="countermeasureAssessment"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 text-base"
                                    rows="3"
                                    placeholder="Example: The proposed calibration management system lacks specific implementation timeline and responsible personnel assignments. Evidence documentation is insufficient to demonstrate effectiveness of training programs..."></textarea>
                            </div>

                            <!-- Admin Recommendations -->
                            <div>
                                <label class="block text-base font-medium text-gray-700 mb-2">Administrative Recommendations</label>
                                <p class="text-sm text-gray-600 mb-3">Provide specific, actionable recommendations to strengthen the countermeasure implementation and prevent recurrence.</p>
                                <textarea id="adminRecommendations"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 text-base"
                                    rows="3"
                                    placeholder="Example: Recommend establishing monthly calibration audits with documented verification procedures. Suggest implementing competency assessment framework for operators with quarterly evaluations..."></textarea>
                            </div>
                        </div>

                        <!-- Review Decision -->
                        <div>
                            <label class="block text-base font-medium text-gray-700 mb-2">Review Decision</label>
                            <p class="text-sm text-gray-600 mb-3">Select the appropriate decision based on your assessment of the vendor's countermeasure response.</p>
                            <select id="reviewDecision"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 bg-white text-gray-900 text-base appearance-none bg-no-repeat bg-right bg-[length:16px_16px] pr-8"
                                style="background-image: url('data:image/svg+xml;charset=US-ASCII,<svg xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 4 5&quot;><path fill=&quot;%23666&quot; d=&quot;M2 0L0 2h4zm0 5L0 3h4z&quot;/></svg>');">
                                <option value="">Select Review Decision</option>
                                <option value="approved">✅ Approved - Countermeasures are adequate and comprehensive</option>
                                <option value="approved_with_conditions">⚠️ Conditional Approval - Minor enhancements required</option>
                                <option value="requires_revision">🔄 Requires Revision - Significant improvements needed</option>
                                <option value="rejected">❌ Rejected - Countermeasures inadequate, complete rework required</option>
                                <option value="request_additional_evidence">📋 Request Additional Evidence - Supporting documentation needed</option>
                            </select>
                        </div>

                        <div class="flex justify-between items-center pt-4 border-t border-gray-200">
                            <div class="text-sm text-gray-600">
                                <p>Review feedback will be communicated to the vendor for corrective action implementation.</p>
                            </div>
                            <div class="flex space-x-3">
                                <button type="button" onclick="saveDraftReview()"
                                    class="bg-gray-600 text-white px-6 py-3 rounded-lg hover:bg-gray-700 text-base font-medium">
                                    Save Draft
                                </button>
                                <button type="button" onclick="submitReviewToVendor()"
                                    class="bg-red-600 text-white px-8 py-3 rounded-lg hover:bg-red-700 font-medium text-base">
                                    Submit Review
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Historical Communication Chat -->
            <div class="bg-white rounded-lg shadow mb-8 mt-8">
                <div class="px-6 py-4 border-b border-gray-200 cursor-pointer hover:bg-gray-50 transition-colors"
                    onclick="toggleSection('communicationSection')">
                    <div class="flex items-center justify-between">
                        <div>
                            <h2 class="text-lg font-medium text-gray-900">Historical Communication</h2>
                            <p class="text-sm text-gray-500">Communication history between admin and vendor regarding countermeasure implementations</p>
                        </div>
                        <i id="communicationIcon"
                            class="fas fa-chevron-up text-gray-500 transition-transform duration-200"></i>
                    </div>
                </div>
                <div id="communicationSection"
                    class="p-6 overflow-hidden transition-all duration-300 ease-in-out toggle-section">
                    <div class="space-y-4">
                        <!-- Admin Message -->
                        <div class="flex items-start space-x-3">
                            <div class="flex-shrink-0">
                                <div class="w-8 h-8 bg-red-100 rounded-full flex items-center justify-center">
                                    <i class="fas fa-user-shield text-red-600 text-sm"></i>
                                </div>
                            </div>
                            <div class="flex-1">
                                <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                                    <div class="flex items-center justify-between mb-2">
                                        <h4 class="text-sm font-medium text-red-800">Admin QC</h4>
                                        <span class="text-xs text-red-600">Dec 12, 2024 - 14:30</span>
                                    </div>
                                    <div class="text-sm text-red-700 space-y-2">
                                        <p><strong>Countermeasure Assessment:</strong></p>
                                        <p>The proposed calibration management system lacks specific implementation timeline and responsible personnel assignments. Evidence documentation is insufficient to demonstrate effectiveness of training programs. The countermeasure for equipment calibration does not address the root cause of systematic maintenance failures.</p>

                                        <p class="mt-3"><strong>Administrative Recommendations:</strong></p>
                                        <p>Recommend establishing monthly calibration audits with documented verification procedures. Suggest implementing competency assessment framework for operators with quarterly evaluations. Require detailed implementation schedule with clear milestone deliverables and responsible personnel for each action item.</p>

                                        <div class="mt-3 px-3 py-2 bg-red-100 rounded border">
                                            <p class="text-sm font-medium text-red-800">
                                                <i class="fas fa-times-circle mr-1"></i>
                                                Review Decision: Requires Revision - Significant improvements needed
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Vendor Response -->
                        <div class="flex items-start space-x-3">
                            <div class="flex-shrink-0">
                                <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
                                    <i class="fas fa-building text-green-600 text-sm"></i>
                                </div>
                            </div>
                            <div class="flex-1">
                                <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                                    <div class="flex items-center justify-between mb-2">
                                        <h4 class="text-sm font-medium text-green-800">PT. Besi Kuat Manufacturing</h4>
                                        <span class="text-xs text-green-600">Dec 13, 2024 - 09:15</span>
                                    </div>
                                    <div class="text-sm text-green-700 space-y-2">
                                        <p>Thank you for the detailed feedback. We have revised our countermeasure implementation plan to address all the concerns raised:</p>

                                        <p><strong>Updated Implementation Timeline:</strong></p>
                                        <ul class="list-disc list-inside ml-4 space-y-1">
                                            <li>Week 1-2: Complete calibration system installation with Ahmad Wijaya as lead coordinator</li>
                                            <li>Week 3: Operator competency assessment by certified trainers</li>
                                            <li>Week 4: Monthly audit procedure documentation and approval</li>
                                        </ul>

                                        <p><strong>Additional Evidence Provided:</strong></p>
                                        <ul class="list-disc list-inside ml-4 space-y-1">
                                            <li>Training certificates for all 12 operators (attached)</li>
                                            <li>Calibration equipment purchase orders and delivery schedule</li>
                                            <li>Monthly audit checklist and procedure draft</li>
                                        </ul>

                                        <p>We believe these revisions fully address the root cause analysis and provide the systematic approach requested. Please review and let us know if any further clarification is needed.</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Admin Follow-up Response -->
                        <div class="flex items-start space-x-3">
                            <div class="flex-shrink-0">
                                <div class="w-8 h-8 bg-red-100 rounded-full flex items-center justify-center">
                                    <i class="fas fa-user-shield text-red-600 text-sm"></i>
                                </div>
                            </div>
                            <div class="flex-1">
                                <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                                    <div class="flex items-center justify-between mb-2">
                                        <h4 class="text-sm font-medium text-red-800">Admin QC</h4>
                                        <span class="text-xs text-red-600">Dec 13, 2024 - 16:45</span>
                                    </div>
                                    <div class="text-sm text-red-700 space-y-2">
                                        <p>Excellent improvement in the revised countermeasure plan. The detailed implementation timeline with specific personnel assignments addresses our previous concerns effectively.</p>

                                        <p><strong>Approved Elements:</strong></p>
                                        <ul class="list-disc list-inside ml-4 space-y-1">
                                            <li>✅ Comprehensive training documentation provided</li>
                                            <li>✅ Clear milestone timeline with responsible personnel</li>
                                            <li>✅ Monthly audit procedure meets our systematic requirements</li>
                                            <li>✅ Root cause addressing through preventive measures</li>
                                        </ul>

                                        <p><strong>Next Steps:</strong></p>
                                        <p>Please proceed with implementation as planned. We will schedule verification audits at Week 2 and Week 4 milestones. Submit progress reports weekly during implementation phase.</p>

                                        <div class="mt-3 px-3 py-2 bg-red-100 rounded border">
                                            <p class="text-sm font-medium text-red-800">
                                                <i class="fas fa-check-circle mr-1"></i>
                                                Final Decision: Approved - Countermeasures are adequate and comprehensive
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Add Reply Button -->
                        <div class="flex justify-end mt-6">
                            <button
                                onclick="openReplyModal()"
                                class="bg-red-600 text-white px-6 py-2 rounded-lg text-sm font-medium hover:bg-red-700 transition-colors flex items-center">
                                <i class="fas fa-reply mr-2"></i>
                                Add Reply
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Media Modal -->
    <div id="mediaModal" class="fixed inset-0 bg-black bg-opacity-75 z-50 hidden flex items-center justify-center p-4"
        onclick="closeModal()">
        <div class="relative max-w-4xl max-h-full w-full" onclick="event.stopPropagation()">
            <button onclick="closeModal()"
                class="absolute top-4 right-4 text-white hover:text-gray-300 z-60 text-2xl bg-black bg-opacity-50 rounded-full w-10 h-10 flex items-center justify-center">
                ×
            </button>
            <div id="modalContent"
                class="bg-white rounded-lg overflow-hidden max-h-[90vh] flex items-center justify-center">
                <!-- Content will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Reply Modal -->
    <div id="replyModal" class="fixed inset-0 bg-black bg-opacity-75 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="px-6 py-4 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg font-semibold text-gray-900">Add Reply to Communication</h3>
                    <button onclick="closeReplyModal()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            <div class="p-6">
                <form id="replyForm">
                    <!-- Reply Type Selection -->
                    <div class="mb-6">
                        <label class="block text-base font-medium text-gray-700 mb-3">Reply As</label>
                        <div class="flex space-x-4">
                            <label class="flex items-center">
                                <input type="radio" name="replyType" value="admin" checked class="mr-2 text-red-600 focus:ring-red-500">
                                <span class="text-sm">Admin QC</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="replyType" value="vendor" class="mr-2 text-green-600 focus:ring-green-500">
                                <span class="text-sm">PT. Besi Kuat Manufacturing</span>
                            </label>
                        </div>
                    </div>

                    <!-- Message Content -->
                    <div class="mb-6">
                        <label class="block text-base font-medium text-gray-700 mb-2">Message</label>
                        <textarea
                            id="replyMessage"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 text-base"
                            rows="6"
                            placeholder="Enter your reply message here..."
                            required></textarea>
                    </div>

                    <!-- Priority Selection -->
                    <div class="mb-6">
                        <label class="block text-base font-medium text-gray-700 mb-2">Priority Level</label>
                        <select id="replyPriority" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 text-base">
                            <option value="normal">Normal</option>
                            <option value="high">High Priority</option>
                            <option value="urgent">Urgent</option>
                        </select>
                    </div>

                    <!-- Attachments -->
                    <div class="mb-6">
                        <label class="block text-base font-medium text-gray-700 mb-2">Attachments (Optional)</label>
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-red-400 transition-colors">
                            <i class="fas fa-cloud-upload-alt text-gray-400 text-2xl mb-2"></i>
                            <p class="text-sm text-gray-600">Click to upload files or drag and drop</p>
                            <input type="file" id="replyAttachments" multiple class="hidden">
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex justify-end space-x-3">
                        <button type="button" onclick="closeReplyModal()" class="px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white rounded-lg font-medium">
                            Cancel
                        </button>
                        <button type="button" onclick="saveDraftReply()" class="px-6 py-3 bg-gray-600 hover:bg-gray-700 text-white rounded-lg font-medium">
                            Save Draft
                        </button>
                        <button type="submit" class="px-6 py-3 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium">
                            Send Reply
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // Media Modal Functions
        function openModal(src, type) {
            const modal = document.getElementById('mediaModal');
            const modalContent = document.getElementById('modalContent');

            if (type === 'image') {
                modalContent.innerHTML = `<img src="${src}" alt="Evidence" class="max-w-full max-h-full object-contain">`;
            } else if (type === 'video') {
                modalContent.innerHTML = `
                    <video controls class="max-w-full max-h-full" autoplay>
                        <source src="${src}" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                `;
            }

            modal.classList.remove('hidden');
            modal.classList.add('flex');
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            const modal = document.getElementById('mediaModal');
            const modalContent = document.getElementById('modalContent');

            modal.classList.add('hidden');
            modal.classList.remove('flex');
            modalContent.innerHTML = '';
            document.body.style.overflow = 'auto';
        }

        // Toggle section collapse/expand functionality
        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            const icon = document.getElementById(sectionId.replace('Section', 'Icon'));

            if (section.classList.contains('collapsed')) {
                // Expand
                section.classList.remove('collapsed');
                section.style.maxHeight = section.scrollHeight + 'px';
                section.style.paddingTop = '1.5rem';
                section.style.paddingBottom = '1.5rem';
                section.style.marginBottom = '0';
                icon.classList.remove('fa-chevron-down');
                icon.classList.add('fa-chevron-up');
                icon.style.transform = 'rotate(0deg)';

                // Reset maxHeight after animation
                setTimeout(() => {
                    section.style.maxHeight = 'none';
                }, 300);
            } else {
                // Collapse
                section.classList.add('collapsed');
                section.style.maxHeight = section.scrollHeight + 'px';
                // Force reflow
                section.offsetHeight;
                section.style.maxHeight = '0px';
                section.style.paddingTop = '0';
                section.style.paddingBottom = '0';
                section.style.marginBottom = '0';
                icon.classList.remove('fa-chevron-up');
                icon.classList.add('fa-chevron-down');
                icon.style.transform = 'rotate(180deg)';
            }
        }

        // Verification toggle for Countermeasure for Occurs
        function toggleVerification(button, id) {
            const currentState = button.className;

            if (currentState.includes('bg-green-500')) {
                // Currently verified, set to rejected
                button.className = 'w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600 transition-colors cursor-pointer';
                button.innerHTML = '<i class="fas fa-times text-xs"></i>';
                console.log(`Countermeasure ${id} rejected by admin`);
            } else if (currentState.includes('bg-red-500')) {
                // Currently rejected, set to pending
                button.className = 'w-6 h-6 bg-yellow-500 text-white rounded-full flex items-center justify-center hover:bg-yellow-600 transition-colors cursor-pointer';
                button.innerHTML = '<i class="fas fa-clock text-xs"></i>';
                console.log(`Countermeasure ${id} set to pending verification`);
            } else {
                // Currently pending, set to verified
                button.className = 'w-6 h-6 bg-green-500 text-white rounded-full flex items-center justify-center hover:bg-green-600 transition-colors cursor-pointer';
                button.innerHTML = '<i class="fas fa-check text-xs"></i>';
                console.log(`Countermeasure ${id} verified by admin`);
            }
        }

        // Verification toggle for Countermeasure for Flow Out
        function toggleVerificationFlowOut(button, id) {
            const currentState = button.className;

            if (currentState.includes('bg-green-500')) {
                // Currently verified, set to rejected
                button.className = 'w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600 transition-colors cursor-pointer';
                button.innerHTML = '<i class="fas fa-times text-xs"></i>';
                console.log(`Flow Out Countermeasure ${id} rejected by admin`);
            } else if (currentState.includes('bg-red-500')) {
                // Currently rejected, set to pending
                button.className = 'w-6 h-6 bg-yellow-500 text-white rounded-full flex items-center justify-center hover:bg-yellow-600 transition-colors cursor-pointer';
                button.innerHTML = '<i class="fas fa-clock text-xs"></i>';
                console.log(`Flow Out Countermeasure ${id} set to pending verification`);
            } else {
                // Currently pending, set to verified
                button.className = 'w-6 h-6 bg-green-500 text-white rounded-full flex items-center justify-center hover:bg-green-600 transition-colors cursor-pointer';
                button.innerHTML = '<i class="fas fa-check text-xs"></i>';
                console.log(`Flow Out Countermeasure ${id} verified by admin`);
            }
        }

        // Admin review functions
        function saveDraftReview() {
            const assessment = document.getElementById('countermeasureAssessment').value;
            const recommendations = document.getElementById('adminRecommendations').value;
            const decision = document.getElementById('reviewDecision').value;

            console.log('Saving draft review:', { assessment, recommendations, decision });
            alert('Draft review saved successfully!');
        }

        function submitReviewToVendor() {
            const assessment = document.getElementById('countermeasureAssessment').value;
            const recommendations = document.getElementById('adminRecommendations').value;
            const decision = document.getElementById('reviewDecision').value;

            // Validation
            if (!assessment.trim()) {
                alert('Please provide countermeasure assessment before submitting review.');
                document.getElementById('countermeasureAssessment').focus();
                return;
            }

            if (!recommendations.trim()) {
                alert('Please provide administrative recommendations before submitting review.');
                document.getElementById('adminRecommendations').focus();
                return;
            }

            if (!decision) {
                alert('Please select a review decision before submitting.');
                document.getElementById('reviewDecision').focus();
                return;
            }

            if (confirm('Submit review to vendor? This will formally communicate your assessment and recommendations.')) {
                console.log('Submitting review to vendor:', { assessment, recommendations, decision });
                alert('Review submitted to vendor successfully!');

                // Optional: Clear the form or redirect to next step
                // document.getElementById('countermeasureAssessment').value = '';
                // document.getElementById('adminRecommendations').value = '';
                // document.getElementById('reviewDecision').value = '';
            }
        }

        // Reply Modal Functions
        function openReplyModal() {
            const modal = document.getElementById('replyModal');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            document.body.style.overflow = 'hidden';
        }

        function closeReplyModal() {
            const modal = document.getElementById('replyModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            document.body.style.overflow = 'auto';

            // Clear form
            document.getElementById('replyForm').reset();
        }

        function saveDraftReply() {
            const message = document.getElementById('replyMessage').value;
            const replyType = document.querySelector('input[name="replyType"]:checked').value;
            const priority = document.getElementById('replyPriority').value;

            if (!message.trim()) {
                alert('Please enter a message before saving draft.');
                return;
            }

            console.log('Saving draft reply:', { message, replyType, priority });
            alert('Draft reply saved successfully!');
        }

        // Handle reply form submission
        document.getElementById('replyForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const message = document.getElementById('replyMessage').value;
            const replyType = document.querySelector('input[name="replyType"]:checked').value;
            const priority = document.getElementById('replyPriority').value;

            if (!message.trim()) {
                alert('Please enter a message before sending.');
                return;
            }

            // In production, this would send the reply to the server
            console.log('Sending reply:', { message, replyType, priority });
            alert(`Reply sent successfully as ${replyType === 'admin' ? 'Admin QC' : 'PT. Besi Kuat Manufacturing'}!`);

            closeReplyModal();
        });

        // Initialize page - expand all sections by default for admin view
        document.addEventListener('DOMContentLoaded', function () {
            // Keep all sections expanded for admin review
            console.log('Admin NCR Reply Review page loaded');
        });
    </script>
</body>

</html>